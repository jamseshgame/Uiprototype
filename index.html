<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=1920, height=1920, initial-scale=1.0, user-scalable=no">
<title>Jamsesh</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><radialGradient id='g' cx='35%25' cy='35%25'><stop offset='0%25' stop-color='%23ff4444'/><stop offset='100%25' stop-color='%238b0000'/></radialGradient></defs><polygon points='50,5 61,38 97,38 68,59 79,93 50,72 21,93 32,59 3,38 39,38' fill='url(%23g)'/></svg>">
<link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700;800&family=DM+Sans:wght@400;500;600;700;800&family=Orbitron:wght@400;500;700;800;900&family=Chakra+Petch:wght@400;500;600;700&family=Oswald:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

  button, a, input, select, .nav-item, .topbar-main, .xp-bar-full,
  .play-layout, .play-picker, .content > *, .page > *,
  .play-go-bar, .play-mode-tabs, .play-body, .play-main {
    position: relative;
    z-index: 2;
  }

  :root {
    /* Colour scheme */
    --pink: #c0206a;
    --cyan: #067a96;
    --orange: #c94a08;
    --mint: #16a368;
    --gold: #d48c10;
    --purple: #6535a0;
    --bg-body: #e8e8f0;
    --bg-panel: #f8f8fc;
    --bg-surface: #eeeef4;
    --bg-surface-hover: #e2e2ec;
    --text-primary: #1a1a2e;
    --text-secondary: rgba(26,26,46,0.5);
    --text-muted: rgba(0,0,0,0.45);
    --border-strong: rgba(0,0,0,0.12);
    --border-subtle: rgba(0,0,0,0.06);
    --overlay-light: rgba(0,0,0,0.05);
    --overlay-swap: rgba(0,0,0,0.12);
    --scrollbar-color: rgba(0,0,0,0.15);
    --glow-pink: 0 0 0 3px var(--pink), 0 0 20px var(--pink-40);

    --pad: 32px;
    --panel-gap: 20px;
    --panel-radius: 28px;
    --grid-gap: 16px;
    --pink-15: rgba(219,39,119,0.15);
    --pink-30: rgba(219,39,119,0.3);
    --pink-40: rgba(219,39,119,0.4);
    --pink-50: rgba(219,39,119,0.5);

    /*
      No header row now — full grid height.
      1920 = pad*8 + panel-gap*2 + grid-gap*4 + tile-h*6
    */
    --tile-h: calc((1920px - var(--pad)*8 - var(--panel-gap)*2 - var(--grid-gap)*4) / 6);
    --nav-btn-h: calc(var(--tile-h) / 2);
    --nav-btn-w: calc((1920px - var(--pad)*4 - var(--grid-gap)*6) / 7);
    --navbar-h: calc(var(--nav-btn-h) + var(--pad)*2);
    --topbar-h: var(--navbar-h);
  }

  html { background: var(--bg-body); }

  body {
    height: 1920px;
    overflow: hidden;
    background: var(--bg-body);
    color: var(--text-primary);
    font-family: 'Oswald', sans-serif;
    -webkit-font-smoothing: antialiased;
    display: flex;
    flex-direction: row;
    gap: var(--panel-gap);
  }

  .viewport {
    width: 1920px;
    height: 1920px;
    flex-shrink: 0;
    display: grid;
    grid-template-columns: 1fr;
    grid-template-rows: var(--topbar-h) 1fr var(--navbar-h);
    padding: var(--pad);
    gap: var(--panel-gap);
    position: relative;
  }
  .topbar::after,
  .navbar::after {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background-image: var(--bg-image, none);
    background-size: 1920px 1920px;
    opacity: var(--bg-image-opacity, 0);
    pointer-events: none;
    z-index: 1;
    border-radius: inherit;
  }

  /* ── Top Bar ──────────────────────────────────────── */
  @keyframes bannerScroll {
    0% { transform: translateX(0); }
    100% { transform: translateX(-1920px); }
  }

  .topbar {
    height: var(--topbar-h);
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    background: var(--bg-panel);
    border-radius: var(--panel-radius);
    border: 1px solid var(--border-subtle);
    overflow: hidden;
    position: relative;
    z-index: 0;
  }

  .topbar::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-size: auto;
    background-position: center center;
    background-repeat: repeat-x;
    z-index: 1;
    pointer-events: none;
    animation: bannerScroll 90s linear infinite;
    width: 200%;
  }

  .topbar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5) !important;
    background-image: none !important;
    opacity: 1 !important;
    z-index: 2;
    pointer-events: none;
  }

  .topbar-main {
    flex: 1;
    display: flex;
    align-items: center;
    padding: var(--pad);
    gap: var(--pad);
    min-height: 0;
    position: relative;
    z-index: 3;
  }

  @keyframes frameGlow {
    0%, 100% { border-color: var(--frame-color-1, var(--pink)); }
    50% { border-color: var(--frame-color-2, var(--cyan)); }
  }

  .profile-avatar {
    position: relative;
    align-self: stretch;
    aspect-ratio: 1;
    flex-shrink: 0;
    border-radius: 50%;
    padding: 4px;
    background: transparent;
    border: 4px solid var(--frame-color-1, var(--pink));
    animation: frameGlow 3s ease-in-out infinite;
    box-shadow: 0 0 20px var(--frame-color-1, var(--pink)),
                0 0 40px var(--frame-color-2, var(--cyan));
  }

  .profile-avatar img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
  }

  .profile-avatar .level-badge {
    position: absolute;
    bottom: -4px;
    right: -4px;
    background: var(--pink);
    color: #fff;
    font-size: 14px;
    font-weight: 800;
    width: 26px;
    height: 26px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid var(--bg-panel);
  }

  .profile-info {
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 2px;
  }

  .profile-name {
    font-size: 72px;
    font-weight: 400;
    color: #ffffff;
    line-height: 1;
    white-space: nowrap;
    text-shadow: 0 0 20px rgba(0,0,0,0.9), 0 0 40px rgba(0,0,0,0.7), 0 2px 8px rgba(0,0,0,0.8);
  }

  .xp-text {
    font-size: 36px;
    font-weight: 700;
    color: #ffffff;
    line-height: 1;
    white-space: nowrap;
    text-shadow: 0 0 16px rgba(0,0,0,0.9), 0 0 32px rgba(0,0,0,0.7), 0 2px 6px rgba(0,0,0,0.8);
  }

  .stat-ticker {
    display: grid;
  }

  .stat-ticker .xp-text {
    grid-area: 1 / 1;
    opacity: 0;
    transform: translateY(100%);
    transition: opacity 0.4s ease, transform 0.4s ease;
  }

  .stat-ticker .xp-text.ticker-active {
    opacity: 1;
    transform: translateY(0);
  }

  .stat-ticker .xp-text.ticker-exit {
    opacity: 0;
    transform: translateY(-100%);
  }

  .profile-info-right { text-align: right; align-items: flex-end; padding-right: var(--pad); }

  .topbar-spacer { flex: 1; }

  .xp-bar-full {
    height: 5px;
    background: var(--overlay-light);
    margin: 0;
    flex-shrink: 0;
  }

  .xp-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--pink), var(--cyan));
    transition: width 0.6s ease;
  }

  /* ── 3D Spinning Coin ────────────────────────────── */
  @keyframes coinSpinOnce {
    0%   { transform: rotateY(0deg); }
    100% { transform: rotateY(360deg); }
  }
  @keyframes coinShineOnce {
    0%   { opacity: 0.15; }
    50%  { opacity: 0.5; }
    100% { opacity: 0.15; }
  }

  .coin-scene {
    align-self: stretch;
    aspect-ratio: 1;
    perspective: 600px;
    flex-shrink: 0;
    margin-right: var(--pad);
  }
  .coin-body {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
  }
  .coin-body.spinning {
    animation: coinSpinOnce 2s cubic-bezier(0.22, 1, 0.36, 1) forwards;
  }
  .coin-body.spinning .coin-shine {
    animation: coinShineOnce 2s ease forwards;
  }
  .coin-face {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
  }
  /* Front face — gold with J emblem */
  .coin-front {
    transform: translateZ(12px);
    background:
      radial-gradient(circle at 35% 35%, #fff6b0 0%, transparent 40%),
      radial-gradient(circle at 65% 65%, #8b6914 0%, transparent 50%),
      linear-gradient(160deg, #fde68a 0%, #f59e0b 25%, #d97706 50%, #92400e 75%, #78350f 100%);
    box-shadow:
      inset 0 3px 6px rgba(255,246,176,0.6),
      inset 0 -3px 6px rgba(120,53,15,0.5),
      inset 0 0 0 8px rgba(180,120,20,0.6),
      inset 0 0 0 10px rgba(60,30,5,0.5),
      inset 0 0 0 11px rgba(255,220,100,0.4),
      0 0 16px rgba(245,158,11,0.3);
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .coin-front::after {
    content: 'J';
    font-size: 56px;
    font-weight: 900;
    color: #78350f;
    text-shadow: 0 1px 0 rgba(255,246,176,0.5), 0 -1px 0 rgba(92,64,14,0.3);
    font-family: inherit;
  }
  /* Back face */
  .coin-back {
    background:
      radial-gradient(circle at 35% 35%, #fff6b0 0%, transparent 40%),
      radial-gradient(circle at 65% 65%, #8b6914 0%, transparent 50%),
      linear-gradient(200deg, #fde68a 0%, #f59e0b 25%, #d97706 50%, #92400e 75%, #78350f 100%);
    box-shadow:
      inset 0 3px 6px rgba(255,246,176,0.6),
      inset 0 -3px 6px rgba(120,53,15,0.5),
      inset 0 0 0 8px rgba(180,120,20,0.6),
      inset 0 0 0 10px rgba(60,30,5,0.5),
      inset 0 0 0 11px rgba(255,220,100,0.4);
    transform: rotateY(180deg) translateZ(12px);
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .coin-back::after {
    content: 'S';
    font-size: 56px;
    font-weight: 900;
    color: #78350f;
    text-shadow: 0 1px 0 rgba(255,246,176,0.5);
  }
  /* Coin edge — stacked slices forming a thick cylinder */
  .coin-edge {
    position: absolute;
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
  }
  .coin-edge-slice {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: linear-gradient(180deg, #e8a318 0%, #b07a10 25%, #78350f 50%, #b07a10 75%, #e8a318 100%);
    box-shadow: inset 0 2px 2px rgba(255,230,130,0.3), inset 0 -2px 2px rgba(60,30,5,0.4);
  }
  /* Specular sweep across coin */
  .coin-shine {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: linear-gradient(120deg, transparent 30%, rgba(255,255,255,0.4) 48%, rgba(255,255,255,0.5) 50%, rgba(255,255,255,0.4) 52%, transparent 70%);
    opacity: 0.15;
    pointer-events: none;
    z-index: 2;
  }

  /* ── Main Content ─────────────────────────────────── */
  .content {
    flex: 1;
    overflow: hidden;
    padding: var(--pad);
    background: var(--bg-panel);
    border-radius: var(--panel-radius);
    border: none;
    display: flex;
    flex-direction: column;
    position: relative;
    z-index: 0;
  }

  .content-banner {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-size: auto;
    background-position: center center;
    background-repeat: repeat;
    z-index: 1;
    pointer-events: none;
    animation: bannerScroll 90s linear infinite;
    width: 200%;
  }

  .content-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 2;
    pointer-events: none;
  }

  .page { display: none; flex: 1; flex-direction: column; overflow-y: auto; overflow-x: hidden; position: relative; z-index: 3; }
  .page.active::after {
    background-position: calc(-1 * var(--pad)) calc(-1 * (var(--pad) + var(--topbar-h) + var(--panel-gap)));
  }
  @keyframes pageFadeIn {
    0%   { opacity: 0; transform: translateY(8px); }
    100% { opacity: 1; transform: translateY(0); }
  }
  .page.active { display: flex; animation: pageFadeIn 0.2s ease-out both; }

  .section-title {
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 14px;
  }

  /* ── Side Pagination Panel ────────────────────────── */
  .grid-nav {
    display: none;
    flex-direction: column;
    gap: var(--grid-gap);
    flex-shrink: 0;
    width: 64px;
  }

  .grid-nav-btn {
    flex: 1;
    width: 100%;
    border-radius: calc(var(--panel-radius) / 2);
    border: 1px solid var(--border-strong);
    background: var(--bg-surface);
    color: var(--text-secondary);
    font-size: 22px;
    line-height: 0.7;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 10px 16px;
    transition: background 0.2s, color 0.2s;
    font-family: inherit;
  }

  .grid-nav-btn:hover {
    background: var(--bg-surface-hover);
    color: var(--text-primary);
  }

  .grid-nav-btn:disabled {
    opacity: 0.2;
    cursor: default;
  }

  .grid-nav-btn.active {
    background: var(--cyan);
    color: #fff;
    border-color: var(--cyan);
  }

  .grid-viewport {
    flex: 1;
    overflow: hidden;
    position: relative;
  }

  .grid-track {
    width: 100%;
    transition: transform 0.4s ease;
  }

  .grid-page {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    align-content: start;
    gap: var(--grid-gap);
  }

  .song-tile {
    aspect-ratio: 1;
    border-radius: calc(var(--panel-radius) / 2);
    overflow: hidden;
    cursor: pointer;
    position: relative;
    background: var(--bg-surface);
    border: 2px solid transparent;
    transition: box-shadow 0.15s, filter 0.15s, border-color 0.15s;
  }

  /* Shared hover expand + bouncy transition for all interactive elements */
  .nav-item,
  .play-mode-tab,
  .play-go-btn,
  .play-solo-btn,
  .play-solo-cover-add,
  .play-solo-add,
  .play-bar-btn,
  .back-btn,
  .purchase-btn,
  .song-tile,
  .play-tile,
  .play-coop-tile,
  .space-tile,
  .season-tile,
  .vault-tile,
  .settings-tile,
  .theme-card,
  .solo-popup-option,
  .space-popup-opt,
  .loadout-opt,
  .lb-type-btn,
  .picker-filter,
  .setlist-btn,
  .key,
  .key-wide {
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.25s ease, border-color 0.25s ease, background 0.25s ease, opacity 0.25s ease, filter 0.25s ease;
  }

  .nav-item:hover,
  .play-mode-tab:hover,
  .play-go-btn:hover,
  .play-solo-btn:hover,
  .play-solo-cover-add:hover,
  .play-solo-add:hover,
  .play-bar-btn:hover,
  .back-btn:hover,
  .purchase-btn:hover,
  .song-tile:hover,
  .play-tile:hover,
  .play-coop-tile:hover,
  .space-tile:hover,
  .season-tile:hover,
  .vault-tile:hover,
  .settings-tile:hover,
  .theme-card:hover,
  .solo-popup-option:hover,
  .space-popup-opt:hover,
  .loadout-opt:hover,
  .lb-type-btn:hover,
  .picker-filter:hover,
  .setlist-btn:hover,
  .key:hover,
  .key-wide:hover {
    transform: scale(1.06);
  }

  .nav-item:active,
  .play-mode-tab:active,
  .play-go-btn:active,
  .play-solo-btn:active,
  .play-solo-cover-add:active,
  .play-solo-add:active,
  .play-bar-btn:active,
  .back-btn:active,
  .purchase-btn:active,
  .song-tile:active,
  .play-tile:active,
  .play-coop-tile:active,
  .space-tile:active,
  .season-tile:active,
  .vault-tile:active,
  .settings-tile:active,
  .theme-card:active,
  .solo-popup-option:active,
  .space-popup-opt:active,
  .loadout-opt:active,
  .lb-type-btn:active,
  .picker-filter:active,
  .setlist-btn:active,
  .key:active,
  .key-wide:active {
    transform: scale(0.97);
    transition-duration: 0.08s;
  }

  /* Shared tile hover glow */
  .song-tile:hover,
  .play-tile:hover,
  .play-coop-tile:hover,
  .space-tile:hover,
  .season-tile:hover,
  .play-solo-btn:hover,
  .play-solo-cover-add:hover,
  .play-solo-add:hover,
  .solo-popup-option:hover,
  .space-popup-opt:hover,


  /* Tiles that also reveal on hover */
  .vault-tile:hover,
  .settings-tile:hover,
  .theme-card:hover {
    opacity: 1;
    box-shadow: var(--glow-pink);
    border-color: var(--pink);
  }

  /* Shared selected state */
  .play-tile.selected,
  .play-coop-tile.selected,
  .space-popup-opt.selected,


  .theme-card.selected {
    opacity: 1;
    border-color: var(--pink);
    box-shadow: var(--glow-pink);
  }

  /* Shared tile image zoom on hover */
  .song-tile:hover img,
  .play-tile:hover img,
  .space-tile:hover img,


  .song-tile.active {
    box-shadow: 0 0 0 3px var(--cyan), 0 0 24px rgba(0,200,255,0.5);
    border-color: var(--cyan);
  }

  .song-tile.active img {
    transform: scale(1.05);
  }

  .song-tile img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: transform 0.2s ease;
  }


  .song-tile .tile-info {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 32px 8px 8px;
    background: linear-gradient(0deg, rgba(0,0,0,0.85) 0%, transparent 100%);
  }

  .song-tile .tile-rank {
    position: absolute;
    top: 5px;
    left: 6px;
    font-size: 16px;
    font-weight: 800;
    color: var(--text-muted);
  }

  .song-tile .tile-title {
    font-size: 18px;
    font-weight: 700;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2;
  }

  .song-tile .tile-artist {
    font-size: 16px;
    color: var(--text-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .song-tile .tile-meta {
    display: flex;
    gap: 8px;
    font-size: 14px;
    color: rgba(255,255,255,0.50);
    margin-top: 2px;
    white-space: nowrap;
  }

  /* ── Play Panel ──────────────────────────────────── */
  .play-layout {
    flex: 1;
    display: flex;
    gap: var(--grid-gap);
    min-height: 0;
  }

  .play-panel {
    display: flex;
    flex-direction: column;
    background: var(--bg-surface);
    border: 1px solid var(--border-subtle);
    border-radius: calc(var(--panel-radius) / 2);
    overflow: hidden;
  }

  .play-panel-header {
    padding: var(--pad) var(--pad) 12px;
    font-size: 18px;
    font-weight: 700;
    flex-shrink: 0;
    color: var(--text-secondary);
  }

  /* Panel 1 — Song Picker */
  .play-songs { flex: 2; }

  .play-song-list {
    flex: 1;
    overflow-y: auto;
    padding: 0 var(--pad) var(--pad);
  }

  .play-song-row {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 10px 14px;
    border-radius: calc(var(--panel-radius) / 3);
    cursor: pointer;
    transition: background 0.15s;
  }

  .play-song-row:hover { background: var(--bg-surface-hover); }
  .play-song-row.selected {
    background: var(--pink-15);
    border: 1px solid var(--pink);
  }

  .play-song-art {
    width: 40px;
    height: 40px;
    border-radius: 6px;
    object-fit: cover;
    flex-shrink: 0;
  }

  .play-song-info { flex: 1; min-width: 0; }

  .play-song-title {
    font-size: 18px;
    font-weight: 700;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .play-song-artist {
    font-size: 16px;
    color: var(--text-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .play-song-rank {
    font-size: 16px;
    font-weight: 700;
    color: var(--text-secondary);
    flex-shrink: 0;
  }

  /* Panel 2 — Options */
  .play-opt-label { font-size: 34px; font-weight: 800; }

  /* Panel 3 — Leaderboard */
  .play-leaderboard { flex: 1; }

  .play-lb-list {
    flex: 1;
    overflow: hidden;
    padding: var(--pad);
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .play-lb-row {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 8px;
    min-height: 0;
    min-width: 0;
  }

  .play-lb-pos {
    font-size: 24px;
    font-weight: 800;
    color: var(--text-secondary);
    width: 48px;
    text-align: center;
    flex-shrink: 0;
  }

  .play-lb-row:nth-child(-n+3) .play-lb-pos { color: var(--gold); }

  .play-lb-tile {
    flex: 1;
    min-width: 0;
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 0 16px;
    border-radius: calc(var(--panel-radius) / 3);
    border: 1px solid var(--border-subtle);
    background: var(--bg-surface);
    height: 100%;
    position: relative;
    overflow: hidden;
  }

  .play-lb-avatar {
    height: 70%;
    aspect-ratio: 1;
    border-radius: calc(var(--panel-radius) / 2);
    background: var(--bg-surface-hover);
    flex-shrink: 0;
    object-fit: cover;
  }

  .play-lb-info { flex: 1; min-width: 0; }

  .play-lb-stars {
    display: flex;
    gap: 2px;
    font-size: 16px;
    line-height: 1;
    color: var(--gold);
  }

  .play-lb-name {
    font-size: 17px;
    font-weight: 800;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2;
    color: var(--text-primary);
  }

  .play-lb-score {
    font-size: 17px;
    font-weight: 700;
    color: var(--cyan);
    line-height: 1.2;
  }

  .play-lb-row.lb-you .play-lb-tile {
    border: 2px solid var(--pink);
    box-shadow: 0 0 12px var(--pink-40);
  }

  .play-lb-row.lb-you .play-lb-name { color: var(--pink); }
  .play-lb-row.lb-you .play-lb-pos  { color: var(--pink); }

  /* Shared theme nav underline animation */
  @keyframes navUnderline {
    0%   { width: 0; opacity: 0; }
    100% { width: 70%; opacity: 1; }
  }

  @keyframes plateScrollH {
    0%   { background-position: 0% 50%; }
    100% { background-position: 200% 50%; }
  }

  .plate-holo {
    background: repeating-linear-gradient(
      90deg,
      #ff0080, #ff8c00 14%, #ffff00 28%, #00ff88 42%,
      #00cfff 57%, #8000ff 71%, #ff0080 85%, #ff8c00 100%
    ) !important;
    background-size: 200% 100% !important;
    animation: plateScrollH 3s linear infinite;
  }

  @keyframes plateRadiate {
    0%   { background-size: 100% 100%; }
    50%  { background-size: 350% 350%; }
    100% { background-size: 100% 100%; }
  }

  .plate-radiate {
    background: radial-gradient(
      ellipse at center,
      #ffd700, #daa520 20%, #b8860b 40%, #8b6914 60%, #4a3000 80%, #1a1000
    ) !important;
    background-position: center !important;
    animation: plateRadiate 3s ease-in-out infinite;
  }

  .lb-type-btn {
    width: 100%;
    height: var(--nav-btn-h);
    border-radius: calc(var(--panel-radius) / 2);
    border: 1px solid var(--border-strong);
    background: var(--bg-surface);
    color: var(--text-primary);
    font-size: 30px;
    font-weight: 700;
    cursor: pointer;
    font-family: inherit;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transition: background 0.15s;
  }

  .lb-type-btn:hover { background: var(--bg-surface-hover); }

  /* ── Play Grid Layout ─────────────────────────────── */
  .play-main {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    min-height: 0;
  }

  .play-section-header {
    font-size: 18px;
    font-weight: 700;
    color: var(--text-secondary);
    padding: 0 4px;
    flex-shrink: 0;
  }

  /* ── Mode Tabs ─────────────────────────────────────── */
  .play-mode-tabs {
    display: flex;
    gap: var(--grid-gap);
    flex-shrink: 0;
  }

  .play-mode-tab {
    flex: 1;
    height: var(--nav-btn-h);
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--panel-radius);
    border: 1px solid var(--border-strong);
    background: var(--bg-surface);
    color: var(--text-secondary);
    font-size: 30px;
    font-weight: 700;
    cursor: pointer;
    font-family: inherit;
    transition: background 0.15s, color 0.15s, border-color 0.15s;
  }

  .play-mode-tab:hover {
    background: var(--bg-surface-hover);
    color: var(--text-primary);
  }

  .play-mode-tab.active {
    background: var(--pink-15);
    color: var(--pink);
    border-color: var(--pink);
  }

  /* ── Play Body (song col + right panel) ──────────── */
  .play-body {
    display: flex;
    gap: var(--grid-gap);
    flex: 1;
    min-height: 0;
  }

  .play-song-col {
    display: flex;
    flex-direction: column;
    gap: var(--grid-gap);
    flex-shrink: 0;
    width: var(--tile-h);
    overflow-y: auto;
    min-height: 0;
    max-height: calc((var(--tile-h) - 48px) * 3.1 + var(--grid-gap) * 3);
  }

  .play-song-slot {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
  }

  .play-song-pos {
    font-size: 24px;
    font-weight: 800;
    color: var(--text-secondary);
    width: 36px;
    text-align: center;
    flex-shrink: 0;
  }

  .play-song-slot .play-tile {
    width: calc(var(--tile-h) - 48px);
    aspect-ratio: 1;
    flex-shrink: 0;
  }

  .play-right-panel {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: var(--grid-gap);
    min-height: 0;
    overflow: hidden;
  }

  /* ── Solo Panel (row-based layout) ──────────────── */
  .play-solo-wrapper {
    flex: 1;
    display: flex;
    gap: var(--grid-gap);
    min-height: 0;
  }

  .play-solo-rows {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: var(--grid-gap);
    padding: var(--grid-gap) 0;
    overflow: hidden;
    justify-content: flex-start;
  }

  @keyframes soloSlideDown {
    0%   { opacity: 0; transform: translateY(-100%); }
    100% { opacity: 1; transform: translateY(0); }
  }
  @keyframes soloSlideUp {
    0%   { opacity: 0; transform: translateY(100%); }
    100% { opacity: 1; transform: translateY(0); }
  }
  .play-solo-rows.slide-down {
    animation: soloSlideDown 0.35s cubic-bezier(0.22, 1, 0.36, 1) both;
  }
  .play-solo-rows.slide-up {
    animation: soloSlideUp 0.35s cubic-bezier(0.22, 1, 0.36, 1) both;
  }


  .play-solo-nav {
    display: flex;
    flex-direction: column;
    gap: var(--grid-gap);
    width: 52px;
    flex-shrink: 0;
    padding: var(--grid-gap) 0;
  }

  .play-solo-nav-btn {
    flex: 1;
    width: 100%;
    border-radius: calc(var(--panel-radius) / 2);
    border: 1px solid var(--border-strong);
    background: var(--bg-surface);
    color: var(--text-secondary);
    font-size: 20px;
    line-height: 0.7;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: background 0.2s, color 0.2s;
    font-family: inherit;
    padding: 0;
  }

  .play-solo-nav-btn:hover {
    background: var(--bg-surface-hover);
    color: var(--text-primary);
  }

  .play-solo-nav-btn:disabled {
    opacity: 0.2;
    cursor: default;
  }

  .play-solo-row {
    flex: 0 1 calc((100% - var(--grid-gap) * 2) / 3);
    max-height: calc((100% - var(--grid-gap) * 2) / 3);
    display: flex;
    flex-direction: column;
    min-height: 0;
  }
  .play-solo-row-inner {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: calc(var(--grid-gap) * 2);
    flex: 1;
    min-height: 0;
  }
  .play-solo-row-meta {
    display: flex;
    gap: 8px;
    padding: 2px 0 0 0;
    justify-content: center;
    flex-wrap: nowrap;
    overflow: hidden;
    min-height: 28px;
    flex-shrink: 0;
  }

  .meta-bubble {
    display: inline-flex;
    align-items: center;
    padding: 4px 14px;
    border-radius: 20px;
    font-size: 16px;
    font-weight: 700;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    border: 1px solid rgba(255,255,255,0.12);
    backdrop-filter: blur(12px) saturate(140%);
    -webkit-backdrop-filter: blur(12px) saturate(140%);
    box-shadow: 0 2px 8px rgba(0,0,0,0.08), inset 0 1px 0 rgba(255,255,255,0.20);
  }

  .meta-bubble-title {
    background: rgba(88,72,160,0.18);
    color: #5848a0;
    border-color: rgba(88,72,160,0.20);
    flex: 0 1 auto;
    min-width: 0;
  }

  .meta-bubble-artist {
    background: rgba(200,56,104,0.14);
    color: #c83868;
    border-color: rgba(200,56,104,0.18);
    flex: 0 1 auto;
    min-width: 0;
  }

  .meta-bubble-dur {
    background: rgba(40,152,120,0.15);
    color: #289878;
    border-color: rgba(40,152,120,0.20);
    flex: 0 0 auto;
  }

  .meta-bubble-bpm {
    background: rgba(200,144,48,0.15);
    color: #c89030;
    border-color: rgba(200,144,48,0.20);
    flex: 0 0 auto;
  }

  .play-solo-btn.empty {
    opacity: 0.25;
    pointer-events: none;
  }

  .play-solo-num {
    font-size: 30px;
    font-weight: 800;
    color: var(--text-secondary);
    width: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .play-solo-cover {
    aspect-ratio: 1;
    height: 90%;
    border-radius: calc(var(--panel-radius) / 2);
    overflow: hidden;
    flex-shrink: 0;
    position: relative;
    background: var(--bg-surface);
  }

  .play-solo-cover img {
    width: 100%; height: 100%;
    object-fit: cover;
    display: block;
  }


  .play-solo-cover-add {
    aspect-ratio: 1;
    height: 90%;
    border-radius: calc(var(--panel-radius) / 2);
    overflow: hidden;
    flex-shrink: 0;
    position: relative;
    background: var(--bg-surface);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
    color: var(--text-secondary);
    transition: box-shadow 0.15s, color 0.15s, border-color 0.15s;
    border: 2px solid transparent;
  }

  .play-solo-cover-add:hover {
    color: var(--text-primary);
  }

  .play-solo-btn {
    aspect-ratio: 1;
    height: 90%;
    border-radius: calc(var(--panel-radius) / 2);
    cursor: pointer;
    border: 2px solid transparent;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-family: inherit;
    font-size: 24px;
    font-weight: 800;
    color: #fff;
    transition: box-shadow 0.15s, border-color 0.15s;
    user-select: none;
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
  }



  .play-solo-btn .solo-btn-label {
    position: absolute;
    bottom: 10px;
    right: 12px;
    z-index: 1;
    font-family: 'Oswald', sans-serif;
    font-size: 48px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .play-solo-btn .solo-btn-icon {
    position: absolute;
    bottom: 0;
    right: 0;
    height: 80%;
    opacity: 0.3;
    pointer-events: none;
    object-fit: contain;
  }

  .play-solo-add {
    aspect-ratio: 1;
    height: 90%;
    border-radius: calc(var(--panel-radius) / 2);
    background: var(--bg-surface);
    border: 2px solid transparent;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
    color: var(--text-secondary);
    transition: box-shadow 0.15s, color 0.15s, border-color 0.15s;
  }

  .play-solo-add:hover {
    color: var(--text-primary);
  }

  /* ── Solo Selection Popup ─────────────────────────── */
  /* ── Shared Popup Close Button ──────────────────── */
  .popup-close-btn {
    position: absolute;
    top: 16px;
    right: 16px;
    width: 64px;
    height: 64px;
    border-radius: 50%;
    border: 2px solid var(--border-strong);
    background: var(--bg-surface);
    color: var(--text-primary);
    font-size: 32px;
    font-weight: 700;
    cursor: pointer;
    font-family: inherit;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.15s, transform 0.15s;
    z-index: 10;
    line-height: 1;
  }
  .popup-close-btn:hover {
    background: var(--bg-surface-hover);
    transform: scale(1.1);
  }
  .popup-close-btn:active {
    transform: scale(0.95);
  }

  .solo-popup-overlay {
    display: none;
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.7);
    z-index: 999;
    align-items: center;
    justify-content: center;
  }

  .solo-popup-overlay.active {
    display: flex;
  }

  .solo-popup {
    background: var(--bg-panel);
    border: 2px solid var(--border-strong);
    border-radius: var(--panel-radius);
    padding: 40px 52px;
    width: 1600px;
    max-width: 92%;
    max-height: 95%;
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  .solo-popup-title {
    font-size: 40px;
    font-weight: 800;
    color: var(--text-primary);
    text-align: center;
  }

  .solo-popup-option {
    border-radius: calc(var(--panel-radius) / 2);
    padding: 28px 34px;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    gap: 6px;
    transition: box-shadow 0.15s, border-color 0.15s;
    border: 2px solid transparent;
  }



  .solo-popup-option-label {
    font-size: 38px;
    font-weight: 800;
    color: var(--text-primary);
  }

  .solo-popup-option-desc {
    font-size: 22px;
    font-weight: 500;
    color: var(--text-secondary);
  }

  /* ── Space Popup ──────────────────────────────────── */
  .space-popup {
    background: var(--bg-panel);
    border: 2px solid var(--border-strong);
    border-radius: var(--panel-radius);
    padding: 40px 52px;
    width: 1600px;
    max-width: 92%;
    max-height: 95%;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 24px;
    scrollbar-width: thin;
    scrollbar-color: var(--scrollbar-color) transparent;
  }

  .space-popup-title {
    font-size: 40px;
    font-weight: 800;
    color: var(--text-primary);
    text-align: center;
  }

  .space-popup-category {
    display: flex;
    flex-direction: column;
    gap: 14px;
  }

  .space-popup-cat-label {
    font-size: 24px;
    font-weight: 700;
    color: var(--text-secondary);
    padding: 0 4px;
  }

  .space-popup-cat-options {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--grid-gap);
  }

  .space-popup-opt {
    border-radius: calc(var(--panel-radius) / 2);
    padding: 22px 22px;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    text-align: center;
    background: var(--bg-surface);
    border: 2px solid transparent;
    transition: box-shadow 0.15s, border-color 0.15s;
  }





  .space-popup-opt-label {
    font-size: 32px;
    font-weight: 700;
    color: var(--text-primary);
  }

  .space-popup-opt-desc {
    font-size: 17px;
    font-weight: 500;
    color: var(--text-secondary);
  }

  /* ── Loadout Popup ─────────────────────────────────── */
  .loadout-overlay {
    display: none;
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.7);
    z-index: 999;
    align-items: center;
    justify-content: center;
  }

  .loadout-overlay.active { display: flex; }

  .loadout-popup {
    background: var(--bg-panel);
    border: 2px solid var(--border-strong);
    border-radius: var(--panel-radius);
    padding: 40px 52px;
    width: 1600px;
    max-width: 92%;
    max-height: 95%;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 24px;
    scrollbar-width: thin;
    scrollbar-color: var(--scrollbar-color) transparent;
  }

  .loadout-popup-title {
    font-size: 40px;
    font-weight: 800;
    color: var(--text-primary);
    text-align: center;
    margin: 0;
  }

  .loadout-category {
    display: flex;
    flex-direction: column;
    gap: 14px;
  }

  .loadout-cat-label {
    font-size: 24px;
    font-weight: 700;
    color: var(--text-secondary);
    padding: 0 4px;
  }

  .loadout-cat-options {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--grid-gap);
  }

  .loadout-opt {
    aspect-ratio: 2 / 1;
    border-radius: calc(var(--panel-radius) / 2);
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: center;
    padding: 0 22px;
    gap: 4px;
    border: 2px solid transparent;
    transition: box-shadow 0.15s, border-color 0.15s;
    position: relative;
    overflow: hidden;
  }





  .loadout-opt-label {
    font-size: 28px;
    font-weight: 700;
    color: var(--text-primary);
    position: relative;
    z-index: 1;
  }

  .loadout-opt-desc {
    font-size: 16px;
    font-weight: 500;
    color: var(--text-secondary);
    position: relative;
    z-index: 1;
  }

  .loadout-opt-icon {
    position: absolute;
    right: -10%;
    bottom: -20%;
    height: 130%;
    opacity: 0.25;
    pointer-events: none;
    object-fit: contain;
  }

  .loadout-opt-symbol {
    position: absolute;
    right: 10px;
    bottom: -10%;
    font-size: 96px;
    line-height: 1;
    opacity: 0.15;
    pointer-events: none;
  }

  .loadout-close-btn {
    align-self: center;
    padding: 20px 64px;
    border-radius: calc(var(--panel-radius) / 2);
    border: none;
    background: var(--bg-surface);
    color: var(--text-primary);
    font-size: 34px;
    font-weight: 700;
    cursor: pointer;
    font-family: inherit;
    transition: filter 0.15s;
  }

  .loadout-close-btn:hover { filter: brightness(1.15); }

  /* ── Co-op / Battle Panel ───────────────────────── */
  .play-coop-section-header {
    font-size: 18px;
    font-weight: 700;
    color: var(--text-secondary);
    padding: 0 4px;
    flex-shrink: 0;
  }

  .play-coop-row {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: var(--grid-gap);
    flex-shrink: 0;
  }

  .play-coop-tile {
    border-radius: calc(var(--panel-radius) / 2);
    overflow: hidden;
    cursor: pointer;
    position: relative;
    background: var(--bg-surface);
    border: 2px solid transparent;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: box-shadow 0.15s, border-color 0.15s;
    font-family: inherit;
    padding: 12px 8px;
  }





  .play-coop-tile .play-opt-label {
    font-size: 20px;
    font-weight: 800;
    position: relative;
    z-index: 1;
  }

  .play-coop-tile img {
    position: absolute;
    bottom: 0;
    right: 0;
    height: 80%;
    opacity: 0.3;
    pointer-events: none;
    object-fit: contain;
  }

  /* ── Players Grid ───────────────────────────────── */
  .play-players-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 1fr);
    gap: var(--grid-gap);
    flex: 1;
    min-height: 0;
  }

  .play-nameplate {
    border-radius: calc(var(--panel-radius) / 2);
    overflow: hidden;
    position: relative;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 0 12px;
    background: var(--bg-surface);
    border: 1px solid var(--border-subtle);
  }

  .play-nameplate::after {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5);
    pointer-events: none;
    z-index: 0;
  }

  .play-nameplate.plate-img {
    background-size: cover !important;
    background-position: center !important;
  }

  .play-nameplate > * {
    position: relative;
    z-index: 1;
  }

  .play-np-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--bg-surface-hover);
    flex-shrink: 0;
    object-fit: cover;
  }

  .play-np-info {
    flex: 1;
    min-width: 0;
  }

  .play-np-name {
    font-size: 18px;
    font-weight: 800;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2;
    text-shadow: 0 2px 6px rgba(0,0,0,0.9);
  }

  .play-np-badges {
    display: flex;
    gap: 6px;
    align-items: center;
    margin-top: 2px;
  }

  .play-np-badge {
    font-size: 16px;
    font-weight: 700;
    padding: 2px 5px;
    border-radius: 4px;
    background: rgba(255,255,255,0.12);
    color: var(--text-secondary);
    line-height: 1;
    text-shadow: 0 1px 4px rgba(0,0,0,0.8);
  }

  .play-np-hourglass {
    font-size: 16px;
    color: var(--text-secondary);
    margin-top: 2px;
  }

  .play-go-bar {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 28px;
    flex-shrink: 0;
    padding: var(--panel-gap) 0;
  }

  .play-go-btn {
    padding: 20px 64px;
    border-radius: calc(var(--panel-radius) / 2);
    border: none;
    background: var(--pink);
    color: #fff;
    font-size: 38px;
    font-weight: 800;
    cursor: pointer;
    font-family: inherit;
    transition: transform 0.15s, box-shadow 0.15s;
  }

  .play-go-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 30px var(--pink-50);
  }

  .play-duration {
    font-size: 24px;
    font-weight: 700;
    color: var(--text-secondary);
    min-width: 64px;
    text-align: center;
  }

  .play-tile {
    border-radius: calc(var(--panel-radius) / 2);
    overflow: hidden;
    cursor: pointer;
    position: relative;
    background: var(--bg-surface);
    border: 2px solid transparent;
    aspect-ratio: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: box-shadow 0.15s, filter 0.15s, border-color 0.15s;
  }








  .play-tile img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    position: absolute;
    transition: transform 0.2s ease;
    top: 0; left: 0;
  }



  .play-tile .tile-info {
    position: absolute;
    bottom: 0; left: 0; right: 0;
    padding: 22px 8px 8px;
    background: linear-gradient(0deg, rgba(0,0,0,0.85) 0%, transparent 100%);
  }

  .play-tile .tile-title {
    font-size: 18px;
    font-weight: 700;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .play-tile .tile-artist {
    font-size: 16px;
    color: var(--text-muted);
  }

  .play-add-tile {
    font-size: 48px;
    color: var(--text-secondary);
    transition: transform 0.15s, color 0.15s;
  }

  .play-add-tile:hover { color: var(--text-primary); }

  .setlist-actions {
    position: absolute;
    left: 0; right: 0; bottom: 0;
    display: flex;
    gap: 6px;
    padding: 8px;
    background: linear-gradient(0deg, rgba(0,0,0,0.85) 0%, transparent 100%);
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 3;
  }

  .play-tile:hover .setlist-actions { opacity: 1; }

  .setlist-btn {
    flex: 1;
    padding: 8px 0;
    border-radius: calc(var(--panel-radius) / 3);
    border: none;
    background: rgba(255,255,255,0.15);
    color: #fff;
    font-size: 20px;
    font-weight: 800;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.15s;
    font-family: inherit;
  }

  .setlist-btn:hover {
    background: var(--pink);
  }



  .play-solo-cover:hover .setlist-actions { opacity: 1; }

  .play-picker {
    display: none;
    flex: 1;
    flex-direction: column;
    min-height: 0;
  }

  .play-picker.active { display: flex; }

  .play-picker-body {
    flex: 1;
    display: flex;
    gap: var(--grid-gap);
    min-height: 0;
  }

  .picker-songs-col {
    flex: 3;
    display: flex;
    flex-direction: column;
    gap: calc(var(--grid-gap) * 2);
    min-height: 0;
  }

  .picker-grid-row {
    flex: 1;
    display: flex;
    gap: var(--grid-gap);
    min-height: 0;
  }

  .play-picker-lb {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: var(--grid-gap);
    min-height: 0;
    min-width: 0;
  }

  .song-tile-actions {
    position: absolute;
    left: 0; right: 0; bottom: 0;
    display: flex;
    gap: 6px;
    padding: 8px;
    background: linear-gradient(0deg, rgba(0,0,0,0.85) 0%, transparent 100%);
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 3;
  }

  .song-tile:hover .song-tile-actions { opacity: 1; }

  .song-tile-btn {
    flex: 1;
    padding: 8px 0;
    border-radius: calc(var(--panel-radius) / 3);
    border: none;
    background: rgba(255,255,255,0.15);
    color: #fff;
    font-size: 20px;
    font-weight: 800;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.15s;
    font-family: inherit;
  }

  .song-tile-btn:hover {
    background: var(--pink);
  }

  .picker-setlist {
    display: flex;
    flex-direction: column;
    gap: 6px;
    flex-shrink: 0;
  }

  .picker-setlist-header {
    display: flex;
    align-items: center;
    gap: var(--grid-gap);
  }

  .picker-setlist-header > .play-section-header {
    flex-shrink: 0;
    font-size: 18px;
  }

  .picker-setlist-tiles {
    display: flex;
    gap: var(--grid-gap);
    min-width: 0;
    align-items: center;
  }

  .picker-setlist-nav {
    display: flex;
    justify-content: center;
    gap: var(--grid-gap);
  }

  .picker-setlist-tile {
    flex: 1;
    aspect-ratio: 1;
    border-radius: calc(var(--panel-radius) / 3);
    overflow: hidden;
    position: relative;
    background: var(--pink-15);
    border: 2px solid var(--pink-30);
  }

  .picker-setlist-tile img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .picker-setlist-remove {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(220,38,38,0.85);
    color: #fff;
    font-size: 28px;
    font-weight: 800;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 3;
  }

  .picker-setlist-tile:hover .picker-setlist-remove { opacity: 1; }

  .picker-setlist-tile.picker-setlist-empty {
    border-style: dashed;
    opacity: 0.35;
  }

  .picker-setlist-arrow {
    padding: 4px 20px;
    border-radius: calc(var(--panel-radius) / 3);
    border: none;
    background: var(--bg-surface);
    color: var(--text-secondary);
    font-size: 22px;
    font-weight: 800;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.15s;
    font-family: inherit;
  }

  .picker-setlist-arrow:hover {
    background: var(--bg-surface-hover);
    color: var(--text-primary);
  }

  .picker-setlist-arrow:disabled {
    opacity: 0.25;
    pointer-events: none;
  }

  .picker-filters {
    display: flex;
    gap: calc(var(--grid-gap) * 2);
    flex-shrink: 0;
    align-items: center;
  }

  .picker-filter {
    flex: 1;
    height: var(--nav-btn-h);
    border-radius: calc(var(--panel-radius) / 2);
    border: 1px solid var(--border-strong);
    background: var(--bg-surface);
    color: var(--text-primary);
    font-size: 28px;
    font-weight: 700;
    font-family: inherit;
    cursor: pointer;
    appearance: none;
    -webkit-appearance: none;
    padding: 0 36px 0 18px;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='9'%3E%3Cpath d='M1 1l6 6 6-6' stroke='%23888' stroke-width='2' fill='none'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 16px center;
  }

  .picker-filter:focus {
    outline: none;
    border-color: var(--pink);
    box-shadow: 0 0 0 2px var(--pink-30);
  }

  /* ── Spaces Grid ─────────────────────────────────── */
  .spaces-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    grid-template-rows: repeat(5, 1fr);
    gap: var(--grid-gap);
    flex: 1;
    min-height: 0;
  }

  .space-tile {
    border-radius: calc(var(--panel-radius) / 2);
    overflow: hidden;
    cursor: pointer;
    position: relative;
    background: var(--bg-surface);
    border: 2px solid transparent;
    transition: box-shadow 0.15s, filter 0.15s, border-color 0.15s;
  }



  .space-tile img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: transform 0.2s ease;
  }



  .space-tile .tile-info {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 22px 8px 8px;
    background: linear-gradient(0deg, rgba(0,0,0,0.85) 0%, transparent 100%);
  }

  .space-tile .tile-title {
    font-size: 18px;
    font-weight: 700;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2;
  }

  .space-tile .tile-artist {
    font-size: 16px;
    color: var(--text-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* ── Vault Grid ──────────────────────────────────── */
  .vault-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    grid-template-rows: repeat(5, 1fr);
    gap: var(--grid-gap);
    flex: 1;
    min-height: 0;
  }

  .vault-tile {
    border-radius: calc(var(--panel-radius) / 2);
    overflow: hidden;
    cursor: pointer;
    position: relative;
    background: var(--bg-surface);
    border: 2px solid transparent;
    opacity: 0.55;
    transition: box-shadow 0.15s, filter 0.15s, border-color 0.15s, opacity 0.15s;
  }



  .vault-tile img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: transform 0.3s ease;
  }



  .vault-tile .tile-info {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.5);
  }

  .vault-tile .tile-title {
    font-size: 18px;
    font-weight: 800;
    text-align: center;
    line-height: 1.2;
  }

  .vault-tile .tile-cat {
    font-size: 16px;
    font-weight: 700;
    color: var(--cyan);
    text-align: center;
    margin-bottom: 4px;
  }

  /* ── Bottom Nav ───────────────────────────────────── */
  .navbar {
    height: var(--navbar-h);
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--grid-gap);
    background: var(--bg-panel);
    border-radius: var(--panel-radius);
    border: 1px solid var(--border-subtle);
    padding: 0 var(--pad);
    position: relative;
    overflow: hidden;
    z-index: 0;
  }

  .navbar-banner {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-size: auto;
    background-position: center center;
    background-repeat: repeat-x;
    z-index: 1;
    pointer-events: none;
    animation: bannerScroll 90s linear infinite;
    width: 200%;
  }

  .navbar-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 2;
    pointer-events: none;
  }

  .navbar::after {
    background-position: calc(-1 * var(--pad)) calc(-1 * (1920px - var(--pad) - var(--navbar-h)));
  }

  .nav-item {
    flex: 1;
    height: var(--nav-btn-h);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 4px;
    border-radius: var(--panel-radius);
    cursor: pointer;
    transition: background 0.2s;
    position: relative;
    z-index: 3;
    background: var(--bg-surface);
    border: 1px solid transparent;
  }

  .nav-item:hover {
    background: var(--bg-surface-hover);
  }

  .nav-item.active {
    background: var(--pink-15);
    border-color: var(--pink);
  }

  .nav-icon {
    font-size: 52px;
    line-height: 1;
    color: #ffffff;
    transition: color 0.2s;
    filter: drop-shadow(0 0 8px rgba(0,0,0,0.9)) drop-shadow(0 0 16px rgba(0,0,0,0.7));
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .nav-icon svg {
    width: 48px;
    height: 48px;
    fill: currentColor;
    flex-shrink: 0;
  }

  .nav-item.active .nav-icon { color: #ffffff; }

  .nav-label {
    font-size: 20px;
    font-weight: 700;
    color: #ffffff;
    transition: color 0.2s;
    text-shadow: 0 0 16px rgba(0,0,0,0.9), 0 0 32px rgba(0,0,0,0.7), 0 2px 6px rgba(0,0,0,0.8);
  }

  .nav-item.active .nav-label { color: #ffffff; }

  /* ── Back Button ─────────────────────────────────────── */
  .back-btn {
    width: calc((100% - var(--grid-gap) * 4) / 5);
    height: var(--nav-btn-h);
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    border-radius: calc(var(--panel-radius) / 2);
    border: 1px solid var(--border-strong);
    background: var(--bg-surface);
    color: var(--text-secondary);
    font-size: 30px;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.15s, color 0.15s;
    font-family: inherit;
    margin-bottom: var(--grid-gap);
  }

  .back-btn:hover {
    background: var(--bg-surface-hover);
    color: var(--text-primary);
  }

  /* ── Settings ──────────────────────────────────────── */
  .settings-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    grid-template-rows: repeat(5, 1fr);
    gap: var(--grid-gap);
    flex: 1;
    min-height: 0;
  }

  .settings-tile {
    border-radius: calc(var(--panel-radius) / 2);
    overflow: hidden;
    cursor: pointer;
    position: relative;
    background: var(--bg-surface);
    border: 2px solid transparent;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    opacity: 0.55;
    transition: box-shadow 0.15s, filter 0.15s, border-color 0.15s, opacity 0.15s;
  }



  .settings-tile .tile-info {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.5);
  }

  .settings-tile .tile-title {
    font-size: 26px;
    font-weight: 800;
    text-align: center;
  }

  .career-tile .tile-title {
    font-weight: 400;
  }

  .tile-icon {
    font-size: 48px;
    line-height: 1;
    margin-bottom: 8px;
    color: var(--text-primary);
  }

  /* Theme picker */
  .theme-section {
    display: none;
    flex: 1;
    flex-direction: column;
    gap: var(--grid-gap);
    min-height: 0;
  }

  .theme-section.active { display: flex; }

  .banner-section {
    display: none;
    flex: 1;
    flex-direction: column;
    gap: var(--grid-gap);
    min-height: 0;
  }

  .banner-section.active { display: flex; }

  .banner-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: repeat(3, 1fr);
    gap: var(--grid-gap);
    flex: 1;
    min-height: 0;
  }

  .banner-card {
    border-radius: calc(var(--panel-radius) / 2);
    border: 2px solid transparent;
    cursor: pointer;
    overflow: hidden;
    position: relative;
    opacity: 0.55;
    transition: border-color 0.2s, transform 0.15s, opacity 0.15s;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }

  .banner-card.selected {
    opacity: 1;
    border-color: var(--pink);
    box-shadow: var(--glow-pink);
  }

  .banner-card .tile-info {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.9);
  }

  .banner-card .tile-title {
    font-size: 18px;
    font-weight: 800;
    text-align: center;
    color: #ffffff;
  }

  .banner-card.locked .tile-info {
    background: rgba(0,0,0,0.75);
  }

  .frame-section {
    display: none;
    flex: 1;
    flex-direction: column;
    gap: var(--grid-gap);
    min-height: 0;
  }

  .frame-section.active { display: flex; }

  .frame-grid {
    display: grid;
    grid-template-columns: repeat(5, 200px);
    gap: var(--pad);
    justify-content: center;
    align-content: center;
    flex: 1;
    min-height: 0;
    padding: var(--pad);
  }

  .frame-card {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    border: 5px solid;
    cursor: pointer;
    overflow: hidden;
    position: relative;
    opacity: 0.55;
    transition: border-color 0.2s, transform 0.15s, opacity 0.15s, box-shadow 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-surface);
    animation: frameGlow 3s ease-in-out infinite;
  }

  .frame-card.selected {
    opacity: 1;
    transform: scale(1.05);
  }

  .frame-card .tile-title {
    font-size: 14px;
    font-weight: 800;
    text-align: center;
    color: var(--text-primary);
    padding: 8px;
  }

  .frame-card.locked .tile-title {
    opacity: 0.6;
  }

  .theme-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    grid-template-rows: repeat(5, 1fr);
    gap: var(--grid-gap);
    flex: 1;
    min-height: 0;
  }

  .theme-card {
    border-radius: calc(var(--panel-radius) / 2);
    border: 2px solid transparent;
    cursor: pointer;
    overflow: hidden;
    position: relative;
    opacity: 0.55;
    transition: border-color 0.2s, transform 0.15s, opacity 0.15s;
  }

  .theme-card.selected {
    opacity: 1;
    border-color: var(--pink);
    box-shadow: var(--glow-pink);
  }

  .theme-card .tile-info {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.45);
  }

  .theme-card .tile-title {
    font-size: 18px;
    font-weight: 800;
    text-align: center;
  }

  /* ── Season Grid ──────────────────────────────────────── */
  .season-grid {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    min-height: 0;
  }

  .season-category {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .season-label {
    font-size: 18px;
    font-weight: 700;
    color: var(--text-secondary);
    padding: 0 4px;
  }

  .season-row {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: var(--grid-gap);
  }

  .season-tile {
    aspect-ratio: 1;
    border-radius: calc(var(--panel-radius) / 2);
    overflow: hidden;
    position: relative;
    background: var(--bg-surface);
    border: 2px solid transparent;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: box-shadow 0.15s, border-color 0.15s;
  }



  .season-tile.unlocked {
    border-color: var(--mint);
    background: rgba(52,211,153,0.1);
  }

  .season-tile.unlocked::before {
    content: '\2713';
    position: absolute;
    top: 6px;
    right: 8px;
    font-size: 16px;
    font-weight: 800;
    color: var(--mint);
    z-index: 2;
  }

  .season-tile.locked {
    opacity: 0.45;
  }

  .season-tile.locked::before {
    content: '\1F512';
    position: absolute;
    top: 6px;
    right: 8px;
    font-size: 18px;
    z-index: 2;
  }

  .season-reward {
    font-size: 22px;
    line-height: 1;
    margin-bottom: 3px;
  }

  .season-reward-name {
    font-size: 16px;
    font-weight: 700;
    color: var(--text-primary);
    text-align: center;
    padding: 0 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    width: 100%;
  }

  .season-xp {
    font-size: 16px;
    font-weight: 800;
    color: var(--text-muted);
    margin-top: 2px;
  }

  .season-xp-bar {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: rgba(0,0,0,0.3);
  }

  .season-xp-fill {
    height: 100%;
    background: var(--mint);
    transition: width 0.3s ease;
  }

  /* ── Legal Sections ─────────────────────────────────── */
  .legal-section {
    display: none;
    flex: 1;
    flex-direction: column;
    min-height: 0;
  }

  .legal-section.active { display: flex; }

  /* ── Profile Switcher Section ──────────────────────── */
  .profile-section {
    display: none;
    flex: 1;
    flex-direction: column;
    min-height: 0;
  }

  .profile-section.active { display: flex; }

  .profile-grid {
    display: flex;
    gap: 30px;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    flex: 1;
  }

  .profile-card {
    position: relative;
    cursor: pointer;
    border-radius: calc(var(--panel-radius) / 2);
    border: 3px solid transparent;
    overflow: hidden;
    width: 260px;
    height: 320px;
    transition: border-color 0.15s;
  }

  .profile-card:hover {
    border-color: var(--text-primary);
  }

  .profile-card.active {
    border-color: var(--text-primary);
  }

  .profile-card-avatar {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .profile-card-info {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 20px;
    background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.4) 60%, transparent 100%);
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .profile-card-name {
    font-size: 28px;
    font-weight: 700;
    color: #fff;
  }

  .profile-card-level {
    font-size: 20px;
    color: rgba(255,255,255,0.7);
  }

  .profile-card-add {
    position: relative;
    cursor: pointer;
    border-radius: calc(var(--panel-radius) / 2);
    border: 3px solid transparent;
    overflow: hidden;
    width: 260px;
    height: 320px;
    background: #2a2a2a;
    transition: border-color 0.15s;
  }

  .profile-card-add:hover {
    border-color: var(--text-primary);
  }

  .profile-card-add-silhouette {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .profile-card-add-silhouette svg {
    width: 65%;
    height: 65%;
    opacity: 0.25;
  }

  .profile-card-add-info {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 20px;
    background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.4) 60%, transparent 100%);
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .profile-card-add-label {
    font-size: 28px;
    font-weight: 700;
    color: #fff;
  }

  .profile-card-add-cost {
    font-size: 20px;
    font-weight: 400;
    color: rgba(255,255,255,0.7);
  }

  .legal-content {
    flex: 1;
    overflow-y: auto;
    font-size: 18px;
    line-height: 1.7;
    color: var(--text-secondary);
    scrollbar-width: thin;
    scrollbar-color: var(--scrollbar-color) transparent;
  }

  .legal-content h2 {
    font-size: 24px;
    font-weight: 800;
    color: var(--text-primary);
    margin: 32px 0 12px;
  }

  .legal-content h2:first-child { margin-top: 0; }

  .legal-content h3 {
    font-size: 20px;
    font-weight: 700;
    color: var(--text-primary);
    margin: 20px 0 8px;
  }

  .legal-content p {
    margin: 0 0 14px;
  }

  .legal-content ul {
    margin: 0 0 14px;
    padding-left: 28px;
  }

  .legal-content li {
    margin-bottom: 6px;
  }

  .legal-content .legal-version {
    font-size: 16px;
    color: var(--text-secondary);
    margin-bottom: 24px;
    font-style: italic;
  }

  .legal-content .legal-caps {
    font-weight: 700;
    color: var(--text-primary);
  }

  /* ── Theme Lock Banner ─────────────────────────────── */
  .theme-lock-banner {
    position: absolute;
    bottom: 0; left: 0; right: 0;
    padding: 8px 0;
    background: rgba(0,0,0,0.75);
    color: #fff;
    font-size: 18px;
    font-weight: 800;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    z-index: 2;
  }

  .theme-card.locked .tile-info {
    background: rgba(0,0,0,0.6);
  }

  .theme-card.locked::after {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: repeating-linear-gradient(
      45deg,
      transparent,
      transparent 8px,
      rgba(0,0,0,0.1) 8px,
      rgba(0,0,0,0.1) 10px
    );
    pointer-events: none;
    z-index: 1;
  }

  /* ── Purchase Confirm Popup ────────────────────────── */
  .purchase-overlay {
    display: none;
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.7);
    z-index: 999;
    align-items: center;
    justify-content: center;
  }

  .purchase-overlay.active {
    display: flex;
  }

  .purchase-popup {
    background: var(--bg-panel);
    border: 2px solid var(--border-strong);
    border-radius: var(--panel-radius);
    padding: 40px 52px;
    width: 1600px;
    max-width: 92%;
    max-height: 95%;
    text-align: center;
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  .purchase-preview {
    height: 160px;
    border-radius: calc(var(--panel-radius) / 2);
    overflow: hidden;
  }

  .purchase-title {
    font-size: 40px;
    font-weight: 800;
    color: var(--text-primary);
  }

  .purchase-cost {
    font-size: 32px;
    font-weight: 700;
    color: var(--gold);
  }

  .purchase-balance {
    font-size: 22px;
    color: var(--text-secondary);
  }

  .purchase-balance.insufficient {
    color: #dc2626;
  }

  .purchase-buttons {
    display: flex;
    gap: var(--panel-gap);
    justify-content: center;
    margin-top: 6px;
  }

  .purchase-btn {
    flex: 1;
    max-width: 500px;
    padding: 20px 0;
    border-radius: calc(var(--panel-radius) / 2);
    border: none;
    font-size: 28px;
    font-weight: 800;
    cursor: pointer;
    font-family: inherit;
    transition: filter 0.15s;
  }

  .purchase-btn:hover { filter: brightness(1.15); }

  .purchase-btn-confirm {
    background: var(--pink);
    color: #fff;
  }

  .purchase-btn-confirm:disabled {
    background: var(--bg-surface);
    color: var(--text-secondary);
    cursor: not-allowed;
    filter: none;
  }

  .purchase-btn-cancel {
    background: var(--bg-surface);
    color: var(--text-primary);
  }

  /* ── Save/Load Bar Buttons ─────────────────────────── */
  .play-bar-btn {
    padding: 20px 64px;
    border-radius: calc(var(--panel-radius) / 2);
    border: none;
    background: var(--bg-surface);
    color: var(--text-primary);
    font-size: 38px;
    font-weight: 800;
    cursor: pointer;
    font-family: inherit;
    transition: transform 0.15s, box-shadow 0.15s;
  }
  .play-bar-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 20px rgba(255,255,255,0.1);
  }

  /* ── Save Setlist Overlay ──────────────────────────── */
  .save-overlay {
    display: none;
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.7);
    z-index: 999;
    align-items: center;
    justify-content: center;
  }
  .save-overlay.active { display: flex; }

  .save-popup {
    background: var(--bg-panel);
    border: 2px solid var(--border-strong);
    border-radius: var(--panel-radius);
    padding: 40px 52px;
    width: 1600px;
    max-width: 92%;
    max-height: 95%;
    text-align: center;
    display: flex;
    flex-direction: column;
    gap: 24px;
    justify-content: center;
  }
  .save-popup h2 {
    font-size: 40px;
    font-weight: 800;
    color: var(--text-primary);
    margin: 0;
  }

  .save-input {
    width: 100%;
    padding: 22px 28px;
    border-radius: calc(var(--panel-radius) / 2);
    border: 3px solid var(--border-strong);
    background: var(--bg-surface);
    color: var(--text-primary);
    font-size: 30px;
    font-weight: 600;
    font-family: inherit;
    text-align: center;
    box-sizing: border-box;
    outline: none;
  }
  .save-input:focus {
    border-color: var(--pink);
  }

  .keyboard {
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding: 12px 0;
  }
  .keyboard-row {
    display: flex;
    justify-content: center;
    gap: 10px;
  }
  .key {
    min-width: 80px;
    height: 80px;
    border-radius: calc(var(--panel-radius) / 2);
    border: none;
    background: var(--bg-surface);
    color: var(--text-primary);
    font-size: 34px;
    font-weight: 700;
    cursor: pointer;
    font-family: inherit;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.1s;
  }
  .key:hover { background: var(--border-strong); }
  .key-wide {
    min-width: 160px;
    padding: 0 28px;
    font-size: 24px;
  }

  .save-buttons {
    display: flex;
    gap: var(--panel-gap);
    justify-content: center;
    margin-top: 6px;
  }
  .save-buttons button {
    flex: 1;
    max-width: 400px;
    padding: 20px 0;
    border-radius: calc(var(--panel-radius) / 2);
    border: none;
    font-size: 28px;
    font-weight: 800;
    cursor: pointer;
    font-family: inherit;
    transition: filter 0.15s;
  }
  .save-buttons button:hover { filter: brightness(1.15); }
  .save-btn-confirm { background: var(--pink); color: #fff; }
  .save-btn-cancel { background: var(--bg-surface); color: var(--text-primary); }

  /* ── Load Setlist Overlay ──────────────────────────── */
  .load-overlay {
    display: none;
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.7);
    z-index: 999;
    align-items: center;
    justify-content: center;
  }
  .load-overlay.active { display: flex; }

  .load-popup {
    background: var(--bg-panel);
    border: 2px solid var(--border-strong);
    border-radius: var(--panel-radius);
    padding: 40px 52px;
    width: 1600px;
    max-width: 92%;
    text-align: center;
    display: flex;
    flex-direction: column;
    gap: 24px;
    max-height: 95%;
  }
  .load-popup h2 {
    font-size: 40px;
    font-weight: 800;
    color: var(--text-primary);
    margin: 0;
  }

  .load-list {
    display: flex;
    flex-direction: column;
    gap: var(--grid-gap);
    overflow-y: auto;
    flex: 1;
    min-height: 0;
    padding: 4px;
  }

  .load-item {
    display: flex;
    align-items: center;
    gap: 22px;
    background: var(--bg-surface);
    border-radius: calc(var(--panel-radius) / 2);
    padding: 16px 22px;
    text-align: left;
  }

  .load-art-grid {
    width: 110px;
    height: 110px;
    flex-shrink: 0;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: repeat(2, 1fr);
    gap: 3px;
    border-radius: 12px;
    overflow: hidden;
    background: var(--bg-panel);
  }
  .load-art-grid img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }
  .load-art-grid .art-empty {
    background: var(--bg-surface);
  }

  .load-item-info {
    flex: 1;
    min-width: 0;
  }
  .load-item-info .load-item-name {
    font-size: 28px;
    font-weight: 700;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .load-item-info .load-item-count {
    font-size: 20px;
    color: var(--text-secondary);
    margin-top: 4px;
  }

  .load-item-btn {
    padding: 14px 28px;
    border-radius: calc(var(--panel-radius) / 2);
    border: none;
    font-size: 22px;
    font-weight: 700;
    cursor: pointer;
    font-family: inherit;
    transition: filter 0.15s;
    flex-shrink: 0;
  }
  .load-item-btn:hover { filter: brightness(1.15); }
  .load-item-btn-load { background: var(--pink); color: #fff; }
  .load-item-btn-delete { background: var(--bg-panel); color: var(--text-secondary); }

  .load-empty {
    padding: 60px 0;
    color: var(--text-secondary);
    font-size: 28px;
    font-weight: 600;
  }

  .load-close-btn {
    align-self: center;
    padding: 20px 64px;
    border-radius: calc(var(--panel-radius) / 2);
    border: none;
    background: var(--bg-surface);
    color: var(--text-primary);
    font-size: 34px;
    font-weight: 700;
    cursor: pointer;
    font-family: inherit;
    transition: filter 0.15s;
  }
  .load-close-btn:hover { filter: brightness(1.15); }

  /* ── VR Pointer Fallback ─────────────────────────
     Duplicate hover effects on :active so VR laser
     pointers always produce visual feedback even if
     the WebView does not fire :hover events.
     ──────────────────────────────────────────────── */
  .nav-item:active {
    background: var(--bg-surface-hover);
  }
  .song-tile:active,
  .space-tile:active,
  .vault-tile:active,
  .settings-tile:active,
  .season-tile:active,
  .theme-card:active,
  .play-coop-tile:active,
  .profile-card:active {
    transform: scale(1.06);
    box-shadow: var(--glow-pink);
  }
  .play-go-btn:active {
    transform: scale(1.04);
    filter: brightness(1.15);
  }
  .play-bar-btn:active,
  .play-mode-tab:active,
  .lb-type-btn:active {
    background: var(--bg-surface-hover);
  }
  .grid-nav-btn:active,
  .play-solo-nav-btn:active {
    background: var(--bg-surface-hover);
    transform: scale(1.08);
  }
  .back-btn:active {
    background: var(--bg-surface-hover);
  }
  .solo-popup-option:active,
  .space-popup-opt:active,
  .loadout-opt:active {
    border-color: var(--pink);
    box-shadow: var(--glow-pink);
  }
  .key:active {
    background: var(--border-strong);
  }
  .song-tile-btn:active,
  .setlist-btn:active {
    background: var(--pink);
    color: #fff;
  }
  .picker-filter:active {
    border-color: var(--pink);
  }
  .purchase-btn:active,
  .loadout-close-btn:active,
  .load-close-btn:active,
  .load-item-btn:active {
    filter: brightness(1.15);
  }
  .popup-close-btn:active {
    background: var(--bg-surface-hover);
    transform: scale(0.95);
  }

  /* ============================================
     NEON ARCADE THEME — scoped under .theme-arcade
     ============================================ */

  /* --- Keyframes --- */
  @keyframes arcadeXpSlide {
    0%   { background-position: 0% 50%; }
    100% { background-position: 300% 50%; }
  }
  @keyframes arcadeGlow {
    0%, 100% { box-shadow: 0 0 5px rgba(255,45,120,0.3); }
    50%      { box-shadow: 0 0 20px rgba(255,45,120,0.6); }
  }
  @keyframes arcadeBorderRotate {
    0%   { border-color: #ff2d78; }
    33%  { border-color: #a855f7; }
    66%  { border-color: #00f0ff; }
    100% { border-color: #ff2d78; }
  }

  /* --- Font --- */
  .theme-arcade,
  .theme-arcade .viewport,
  .theme-arcade * {
    font-family: 'Orbitron', sans-serif !important;
  }

  /* --- Glassmorphism panels --- */
  .theme-arcade .topbar {
    background: rgba(18,18,42,0.85) !important;
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border-bottom: 1px solid rgba(255,255,255,0.08);
  }
  .theme-arcade .page {
    background: transparent !important;
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    border: none;
  }
  .theme-arcade .navbar {
    background: rgba(18,18,42,0.90) !important;
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border-top: 1px solid rgba(255,255,255,0.08);
  }

  /* --- Pill-shaped nav items --- */
  .theme-arcade .nav-item {
    border-radius: 999px !important;
    transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-arcade .nav-item:hover {
    background: rgba(255,45,120,0.1);
    transform: scale(1.05);
  }
  .theme-arcade .nav-item.active .nav-icon {
    color: #00f0ff !important;
    text-shadow: 0 0 10px #00f0ff, 0 0 20px rgba(0,240,255,0.3);
  }
  .theme-arcade .nav-item.active .nav-label {
    color: #00f0ff !important;
  }
  .theme-arcade .nav-item.active {
    position: relative;
  }
  .theme-arcade .nav-item.active::after {
    content: '';
    position: absolute;
    bottom: 4px;
    left: 15%;
    width: 70%;
    height: 2px;
    background: #00f0ff;
    box-shadow: 0 0 8px #00f0ff;
    animation: navUnderline 0.3s ease-out forwards;
  }

  /* --- Tabs (play mode, leaderboard) --- */
  .theme-arcade .play-mode-tab,
  .theme-arcade .lb-type-btn {
    border-radius: 999px !important;
    transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
    border: 1px solid transparent;
  }
  .theme-arcade .play-mode-tab:hover,
  .theme-arcade .lb-type-btn:hover {
    transform: scale(1.05);
    border-color: rgba(255,45,120,0.3);
    box-shadow: 0 0 10px rgba(255,45,120,0.2);
  }
  .theme-arcade .play-mode-tab.active,
  .theme-arcade .lb-type-btn.active {
    border-color: #ff2d78 !important;
    box-shadow: 0 0 10px rgba(255,45,120,0.4), 0 0 25px rgba(255,45,120,0.15);
  }

  /* --- Filters / pickers --- */
  .theme-arcade .picker-filter {
    border-radius: 999px !important;
    border: 1px solid transparent;
    transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-arcade .picker-filter:hover {
    transform: scale(1.05);
    border-color: rgba(168,85,247,0.3);
    box-shadow: 0 0 10px rgba(168,85,247,0.2);
  }
  .theme-arcade .picker-filter.active {
    border-color: #a855f7;
    box-shadow: 0 0 10px rgba(168,85,247,0.4), 0 0 25px rgba(168,85,247,0.15);
  }

  /* --- Song / play / content tiles --- */
  .theme-arcade .song-tile,
  .theme-arcade .play-tile,
  .theme-arcade .space-tile,
  .theme-arcade .vault-tile,
  .theme-arcade .settings-tile,
  .theme-arcade .season-tile {
    border: 1px solid rgba(255,255,255,0.06);
    transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-arcade .song-tile:hover,
  .theme-arcade .play-tile:hover,
  .theme-arcade .space-tile:hover,
  .theme-arcade .vault-tile:hover,
  .theme-arcade .settings-tile:hover,
  .theme-arcade .season-tile:hover {
    transform: scale(1.02);
    border-color: rgba(255,45,120,0.4);
    box-shadow: 0 0 0 2px rgba(255,45,120,0.2), 0 0 15px rgba(255,45,120,0.3), 0 0 30px rgba(255,45,120,0.1);
  }

  /* Cover art saturation boost */
  .theme-arcade .song-tile img,
  .theme-arcade .play-tile img {
    filter: saturate(1.1) contrast(1.05);
  }

  /* --- Theme card for Neon Arcade itself --- */
  .theme-arcade .theme-card {
    border: 1px solid rgba(255,255,255,0.06);
    transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-arcade .theme-card:hover {
    transform: scale(1.03);
    border-color: rgba(255,45,120,0.3);
    box-shadow: 0 0 12px rgba(255,45,120,0.25);
  }
  .theme-arcade .theme-card.selected {
    border: 2px solid #ff2d78;
    animation: arcadeBorderRotate 3s linear infinite;
    box-shadow: 0 0 15px rgba(255,45,120,0.4), 0 0 30px rgba(168,85,247,0.2);
  }

  /* --- Solo panel buttons --- */
  .theme-arcade .play-solo-btn,
  .theme-arcade .play-solo-cover-add,
  .theme-arcade .play-solo-add {
    border-radius: calc(var(--panel-radius) / 2) !important;
    border: 1px solid rgba(255,255,255,0.08);
    transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-arcade .play-solo-btn:hover,
  .theme-arcade .play-solo-cover-add:hover,
  .theme-arcade .play-solo-add:hover {
    transform: scale(1.05);
    border-color: rgba(255,45,120,0.4);
    box-shadow: 0 0 0 2px rgba(255,45,120,0.15), 0 0 15px rgba(255,45,120,0.3);
  }

  /* --- Arcade: instrument button colours --- */
  .theme-arcade .play-solo-btn[data-inst="guitar"],
  .theme-arcade .solo-popup-option[data-instrument="guitar"] { background: #cc4a00 !important; }
  .theme-arcade .play-solo-btn[data-inst="keys"],
  .theme-arcade .solo-popup-option[data-instrument="keys"]   { background: #6d28d9 !important; }
  .theme-arcade .play-solo-btn[data-inst="drums"],
  .theme-arcade .solo-popup-option[data-instrument="drums"]  { background: #b91c1c !important; }
  .theme-arcade .play-solo-btn[data-inst="vocals"],
  .theme-arcade .solo-popup-option[data-instrument="vocals"] { background: #9333ea !important; }
  .theme-arcade .play-solo-btn[data-inst="bass"],
  .theme-arcade .solo-popup-option[data-instrument="bass"]   { background: #0e7490 !important; }

  /* --- Arcade: difficulty button colours --- */
  .theme-arcade .play-solo-btn[data-diff="easy"],
  .theme-arcade .solo-popup-option[data-difficulty="easy"]   { background: linear-gradient(135deg, #064e3b, #10b981) !important; }
  .theme-arcade .play-solo-btn[data-diff="medium"],
  .theme-arcade .solo-popup-option[data-difficulty="medium"] { background: linear-gradient(135deg, #92400e, #f59e0b) !important; }
  .theme-arcade .play-solo-btn[data-diff="hard"],
  .theme-arcade .solo-popup-option[data-difficulty="hard"]   { background: linear-gradient(135deg, #9a3412, #f97316) !important; }
  .theme-arcade .play-solo-btn[data-diff="expert"],
  .theme-arcade .solo-popup-option[data-difficulty="expert"] { background: linear-gradient(135deg, #7f1d1d, #ef4444) !important; }

  /* --- Arcade: space & loadout buttons --- */
  .theme-arcade .play-solo-btn[data-role="space"]   { background: #1e1b4b !important; }
  .theme-arcade .play-solo-btn[data-role="loadout"] { background: #1f2937 !important; }

  /* --- Popup overlays --- */
  .theme-arcade .solo-popup-option,
  .theme-arcade .space-popup-opt,
  .theme-arcade .loadout-opt,
  .theme-arcade .play-coop-tile {
    background: rgba(18,18,42,0.9) !important;
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: calc(var(--panel-radius) / 2) !important;
    transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-arcade .solo-popup-option:hover,
  .theme-arcade .space-popup-opt:hover,
  .theme-arcade .loadout-opt:hover,
  .theme-arcade .play-coop-tile:hover {
    transform: scale(1.03);
    border-color: rgba(255,45,120,0.4);
    box-shadow: 0 0 0 2px rgba(255,45,120,0.15), 0 0 15px rgba(255,45,120,0.3), 0 0 30px rgba(255,45,120,0.1);
  }

  /* --- Play Go button --- */
  .theme-arcade .play-go-btn {
    background: linear-gradient(135deg, #ff2d78, #a855f7) !important;
    border: none !important;
    border-radius: 999px !important;
    box-shadow: 0 0 15px rgba(255,45,120,0.5), 0 0 30px rgba(168,85,247,0.3);
    transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
    text-shadow: 0 0 8px rgba(255,255,255,0.3);
  }
  .theme-arcade .play-go-btn:hover {
    transform: scale(1.08);
    box-shadow: 0 0 20px rgba(255,45,120,0.7), 0 0 40px rgba(168,85,247,0.4), 0 0 60px rgba(255,45,120,0.2);
    filter: brightness(1.15);
  }

  /* --- Play bar & back buttons --- */
  .theme-arcade .play-bar-btn,
  .theme-arcade .back-btn,
  .theme-arcade .purchase-btn,
  .theme-arcade .setlist-btn,
  .theme-arcade .song-tile-btn {
    border-radius: 999px !important;
    border: 1px solid rgba(255,255,255,0.08);
    transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-arcade .play-bar-btn:hover,
  .theme-arcade .back-btn:hover,
  .theme-arcade .purchase-btn:hover,
  .theme-arcade .setlist-btn:hover,
  .theme-arcade .song-tile-btn:hover {
    transform: scale(1.05);
    border-color: rgba(255,45,120,0.4);
    box-shadow: 0 0 0 2px rgba(255,45,120,0.15), 0 0 15px rgba(255,45,120,0.3);
  }

  /* --- Go bar --- */
  .theme-arcade .play-go-bar {
    background: rgba(18,18,42,0.90) !important;
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border-top: 1px solid rgba(255,255,255,0.08);
  }

  /* --- XP bar animated gradient --- */
  .theme-arcade .xp-bar-full {
    background: linear-gradient(90deg, #ff2d78, #a855f7, #00f0ff, #ff2d78) !important;
    background-size: 300% 100%;
    animation: arcadeXpSlide 3s linear infinite;
    box-shadow: 0 0 8px rgba(255,45,120,0.4), 0 0 16px rgba(168,85,247,0.2);
    border-radius: 999px;
  }

  /* --- Keyboard keys --- */
  .theme-arcade .key,
  .theme-arcade .key-wide {
    border-radius: calc(var(--panel-radius) / 2) !important;
    border: 1px solid rgba(255,255,255,0.1);
    transition: all 0.15s cubic-bezier(0.34, 1.56, 0.64, 1);
    background: rgba(26,26,62,0.8) !important;
  }
  .theme-arcade .key:hover,
  .theme-arcade .key-wide:hover {
    transform: scale(1.08);
    border-color: rgba(0,240,255,0.4);
    box-shadow: 0 0 8px rgba(0,240,255,0.3);
  }
  .theme-arcade .key:active,
  .theme-arcade .key-wide:active {
    transform: scale(0.95);
    box-shadow: 0 0 12px rgba(255,45,120,0.5);
    border-color: #ff2d78;
  }

  /* --- Leaderboard score glow --- */
  .theme-arcade .lb-score {
    color: #00f0ff !important;
    text-shadow: 0 0 8px rgba(0,240,255,0.4);
  }
  .theme-arcade .lb-star {
    text-shadow: 0 0 8px rgba(245,166,35,0.6);
    animation: arcadeGlow 2s ease-in-out infinite;
  }

  /* --- Scrollbar styling --- */
  .theme-arcade ::-webkit-scrollbar-thumb {
    background: rgba(255,45,120,0.3) !important;
    border-radius: 999px;
  }
  .theme-arcade ::-webkit-scrollbar-thumb:hover {
    background: rgba(255,45,120,0.5) !important;
  }

  /* --- Purchase overlay / popup glass --- */
  .theme-arcade .purchase-overlay .purchase-popup,
  .theme-arcade .solo-overlay .solo-popup,
  .theme-arcade .space-popup,
  .theme-arcade .loadout-popup,
  .theme-arcade .save-popup,
  .theme-arcade .load-popup {
    background: rgba(18,18,42,0.95) !important;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255,255,255,0.1);
    box-shadow: 0 0 30px rgba(255,45,120,0.15), 0 0 60px rgba(168,85,247,0.1);
  }

  /* --- General neon hover for interactive elements --- */
  .theme-arcade button:not(.play-go-btn):not(.nav-item):hover,
  .theme-arcade select:hover {
    box-shadow: 0 0 0 2px rgba(255,45,120,0.15), 0 0 12px rgba(255,45,120,0.2);
  }

  /* --- Active/click pulse --- */
  .theme-arcade button:active,
  .theme-arcade .song-tile:active,
  .theme-arcade .play-tile:active,
  .theme-arcade .space-tile:active {
    transform: scale(0.97) !important;
    transition-duration: 0.1s;
  }

  /* --- Dropdown selects --- */
  .theme-arcade select {
    border-radius: 999px !important;
    border: 1px solid rgba(255,255,255,0.1);
    background: rgba(26,26,62,0.8) !important;
  }

  /* --- Text glow for headings --- */
  .theme-arcade .topbar-title,
  .theme-arcade .page-title {
    text-shadow: 0 0 12px rgba(255,45,120,0.25);
  }

  /* --- Subtle ambient glow on the viewport --- */
  .theme-arcade::after {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: radial-gradient(ellipse at 30% 20%, rgba(255,45,120,0.04) 0%, transparent 60%),
                radial-gradient(ellipse at 70% 80%, rgba(0,240,255,0.03) 0%, transparent 60%);
    pointer-events: none;
    z-index: 1;
  }

  /* ============================================
     HUNTER THEME — K-Pop Demon Hunters pastel
     ============================================ */

  /* --- Keyframes --- */
  @keyframes hunterXpSlide {
    0%   { background-position: 0% 50%; }
    100% { background-position: 300% 50%; }
  }
  @keyframes hunterGlow {
    0%, 100% { box-shadow: 0 0 6px rgba(217,70,168,0.2); }
    50%      { box-shadow: 0 0 18px rgba(217,70,168,0.45); }
  }
  @keyframes hunterBorderRotate {
    0%   { border-color: #d946a8; }
    33%  { border-color: #a78bfa; }
    66%  { border-color: #7dd3fc; }
    100% { border-color: #d946a8; }
  }
  @keyframes hunterShimmer {
    0%   { background-position: -200% 0; }
    100% { background-position: 200% 0; }
  }

  /* --- Font: Chakra Petch (angular K-pop style) --- */
  .theme-hunter,
  .theme-hunter .viewport,
  .theme-hunter * {
    font-family: 'Chakra Petch', sans-serif !important;
  }

  /* --- Dreamy glassmorphism panels --- */
  .theme-hunter .topbar {
    background: rgba(245,240,252,0.82) !important;
    backdrop-filter: blur(18px);
    -webkit-backdrop-filter: blur(18px);
    border-bottom: 1px solid rgba(217,70,168,0.1);
  }
  .theme-hunter .page {
    background: transparent !important;
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    border: none;
  }
  .theme-hunter .navbar {
    background: rgba(245,240,252,0.88) !important;
    backdrop-filter: blur(18px);
    -webkit-backdrop-filter: blur(18px);
    border-top: 1px solid rgba(217,70,168,0.1);
  }

  /* --- Pill-shaped nav items --- */
  .theme-hunter .nav-item {
    border-radius: 999px !important;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-hunter .nav-item:hover {
    background: rgba(217,70,168,0.08);
    transform: scale(1.05);
  }
  .theme-hunter .nav-item.active .nav-icon {
    color: #d946a8 !important;
    text-shadow: 0 0 12px rgba(217,70,168,0.4);
  }
  .theme-hunter .nav-item.active .nav-label {
    color: #d946a8 !important;
  }
  .theme-hunter .nav-item.active {
    position: relative;
  }
  .theme-hunter .nav-item.active::after {
    content: '';
    position: absolute;
    bottom: 4px;
    left: 15%;
    width: 70%;
    height: 2px;
    background: linear-gradient(90deg, #d946a8, #a78bfa);
    box-shadow: 0 0 8px rgba(217,70,168,0.4);
    animation: navUnderline 0.3s ease-out forwards;
  }

  /* --- Tabs (play mode, leaderboard) --- */
  .theme-hunter .play-mode-tab,
  .theme-hunter .lb-type-btn {
    border-radius: 999px !important;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    border: 1px solid transparent;
  }
  .theme-hunter .play-mode-tab:hover,
  .theme-hunter .lb-type-btn:hover {
    transform: scale(1.05);
    border-color: rgba(217,70,168,0.2);
    box-shadow: 0 0 10px rgba(217,70,168,0.12);
  }
  .theme-hunter .play-mode-tab.active,
  .theme-hunter .lb-type-btn.active {
    border-color: #d946a8 !important;
    box-shadow: 0 0 8px rgba(217,70,168,0.25), 0 0 20px rgba(217,70,168,0.1);
  }

  /* --- Filters / pickers --- */
  .theme-hunter .picker-filter {
    border-radius: 999px !important;
    border: 1px solid transparent;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-hunter .picker-filter:hover {
    transform: scale(1.05);
    border-color: rgba(167,139,250,0.25);
    box-shadow: 0 0 10px rgba(167,139,250,0.15);
  }
  .theme-hunter .picker-filter.active {
    border-color: #a78bfa;
    box-shadow: 0 0 8px rgba(167,139,250,0.3), 0 0 20px rgba(167,139,250,0.1);
  }

  /* --- Song / play / content tiles --- */
  .theme-hunter .song-tile,
  .theme-hunter .play-tile,
  .theme-hunter .space-tile,
  .theme-hunter .vault-tile,
  .theme-hunter .settings-tile,
  .theme-hunter .season-tile {
    border: 1px solid rgba(217,70,168,0.06);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-hunter .song-tile:hover,
  .theme-hunter .play-tile:hover,
  .theme-hunter .space-tile:hover,
  .theme-hunter .vault-tile:hover,
  .theme-hunter .settings-tile:hover,
  .theme-hunter .season-tile:hover {
    transform: scale(1.02);
    border-color: rgba(217,70,168,0.25);
    box-shadow: 0 0 0 2px rgba(217,70,168,0.1), 0 0 15px rgba(217,70,168,0.15), 0 0 30px rgba(167,139,250,0.08);
  }

  /* Cover art — slight dreamy boost */
  .theme-hunter .song-tile img,
  .theme-hunter .play-tile img {
    filter: saturate(1.15) brightness(1.03);
  }

  /* --- Theme card for Hunter itself --- */
  .theme-hunter .theme-card {
    border: 1px solid rgba(217,70,168,0.06);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-hunter .theme-card:hover {
    transform: scale(1.03);
    border-color: rgba(217,70,168,0.2);
    box-shadow: 0 0 12px rgba(217,70,168,0.15);
  }
  .theme-hunter .theme-card.selected {
    border: 2px solid #d946a8;
    animation: hunterBorderRotate 4s linear infinite;
    box-shadow: 0 0 12px rgba(217,70,168,0.3), 0 0 25px rgba(167,139,250,0.15);
  }

  /* --- Solo panel buttons --- */
  .theme-hunter .play-solo-btn,
  .theme-hunter .play-solo-cover-add,
  .theme-hunter .play-solo-add {
    border-radius: calc(var(--panel-radius) / 2) !important;
    border: 1px solid rgba(217,70,168,0.08);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-hunter .play-solo-btn:hover,
  .theme-hunter .play-solo-cover-add:hover,
  .theme-hunter .play-solo-add:hover {
    transform: scale(1.05);
    border-color: rgba(217,70,168,0.25);
    box-shadow: 0 0 0 2px rgba(217,70,168,0.08), 0 0 12px rgba(217,70,168,0.2);
  }

  /* --- Hunter: instrument button colours (pastel K-pop) --- */
  .theme-hunter .play-solo-btn[data-inst="guitar"],
  .theme-hunter .solo-popup-option[data-instrument="guitar"] { background: linear-gradient(135deg, #e8457a, #f472b6) !important; }
  .theme-hunter .play-solo-btn[data-inst="keys"],
  .theme-hunter .solo-popup-option[data-instrument="keys"]   { background: linear-gradient(135deg, #7c3aed, #a78bfa) !important; }
  .theme-hunter .play-solo-btn[data-inst="drums"],
  .theme-hunter .solo-popup-option[data-instrument="drums"]  { background: linear-gradient(135deg, #e11d48, #fb7185) !important; }
  .theme-hunter .play-solo-btn[data-inst="vocals"],
  .theme-hunter .solo-popup-option[data-instrument="vocals"] { background: linear-gradient(135deg, #c026d3, #e879f9) !important; }
  .theme-hunter .play-solo-btn[data-inst="bass"],
  .theme-hunter .solo-popup-option[data-instrument="bass"]   { background: linear-gradient(135deg, #0891b2, #67e8f9) !important; }

  /* --- Hunter: difficulty button colours (pastel gradients) --- */
  .theme-hunter .play-solo-btn[data-diff="easy"],
  .theme-hunter .solo-popup-option[data-difficulty="easy"]   { background: linear-gradient(135deg, #059669, #6ee7b7) !important; }
  .theme-hunter .play-solo-btn[data-diff="medium"],
  .theme-hunter .solo-popup-option[data-difficulty="medium"] { background: linear-gradient(135deg, #a78bfa, #c4b5fd) !important; }
  .theme-hunter .play-solo-btn[data-diff="hard"],
  .theme-hunter .solo-popup-option[data-difficulty="hard"]   { background: linear-gradient(135deg, #f472b6, #fda4af) !important; }
  .theme-hunter .play-solo-btn[data-diff="expert"],
  .theme-hunter .solo-popup-option[data-difficulty="expert"] { background: linear-gradient(135deg, #d946a8, #f0abfc) !important; }

  /* --- Hunter: space & loadout buttons --- */
  .theme-hunter .play-solo-btn[data-role="space"]   { background: linear-gradient(135deg, #7dd3fc, #bae6fd) !important; }
  .theme-hunter .play-solo-btn[data-role="loadout"] { background: linear-gradient(135deg, #c4b5fd, #ddd6fe) !important; }

  /* --- Popup overlays --- */
  .theme-hunter .solo-popup-option,
  .theme-hunter .space-popup-opt,
  .theme-hunter .loadout-opt,
  .theme-hunter .play-coop-tile {
    background: rgba(245,240,252,0.92) !important;
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
    border: 1px solid rgba(217,70,168,0.08);
    border-radius: calc(var(--panel-radius) / 2) !important;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-hunter .solo-popup-option:hover,
  .theme-hunter .space-popup-opt:hover,
  .theme-hunter .loadout-opt:hover,
  .theme-hunter .play-coop-tile:hover {
    transform: scale(1.03);
    border-color: rgba(217,70,168,0.25);
    box-shadow: 0 0 0 2px rgba(217,70,168,0.08), 0 0 12px rgba(217,70,168,0.18), 0 0 25px rgba(167,139,250,0.08);
  }

  /* --- Play Go button — pink-to-purple gradient --- */
  .theme-hunter .play-go-btn {
    background: linear-gradient(135deg, #f472b6, #a78bfa) !important;
    border: none !important;
    border-radius: 999px !important;
    box-shadow: 0 0 12px rgba(244,114,182,0.35), 0 0 25px rgba(167,139,250,0.2);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    color: #fff !important;
    text-shadow: 0 0 8px rgba(255,255,255,0.3);
  }
  .theme-hunter .play-go-btn:hover {
    transform: scale(1.08);
    box-shadow: 0 0 18px rgba(244,114,182,0.5), 0 0 35px rgba(167,139,250,0.3), 0 0 50px rgba(125,211,252,0.15);
    filter: brightness(1.08);
  }

  /* --- Play bar & misc buttons --- */
  .theme-hunter .play-bar-btn,
  .theme-hunter .back-btn,
  .theme-hunter .purchase-btn,
  .theme-hunter .setlist-btn,
  .theme-hunter .song-tile-btn {
    border-radius: 999px !important;
    border: 1px solid rgba(217,70,168,0.08);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-hunter .play-bar-btn:hover,
  .theme-hunter .back-btn:hover,
  .theme-hunter .purchase-btn:hover,
  .theme-hunter .setlist-btn:hover,
  .theme-hunter .song-tile-btn:hover {
    transform: scale(1.05);
    border-color: rgba(217,70,168,0.25);
    box-shadow: 0 0 0 2px rgba(217,70,168,0.08), 0 0 12px rgba(217,70,168,0.18);
  }

  /* --- Go bar --- */
  .theme-hunter .play-go-bar {
    background: rgba(245,240,252,0.88) !important;
    backdrop-filter: blur(18px);
    -webkit-backdrop-filter: blur(18px);
    border-top: 1px solid rgba(217,70,168,0.1);
  }

  /* --- XP bar — animated pastel gradient --- */
  .theme-hunter .xp-bar-full {
    background: linear-gradient(90deg, #f472b6, #d946a8, #a78bfa, #7dd3fc, #f472b6) !important;
    background-size: 300% 100%;
    animation: hunterXpSlide 4s linear infinite;
    box-shadow: 0 0 8px rgba(217,70,168,0.3), 0 0 16px rgba(167,139,250,0.15);
    border-radius: 999px;
  }

  /* --- Keyboard keys --- */
  .theme-hunter .key,
  .theme-hunter .key-wide {
    border-radius: calc(var(--panel-radius) / 2) !important;
    border: 1px solid rgba(217,70,168,0.1);
    transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
    background: rgba(232,223,244,0.8) !important;
  }
  .theme-hunter .key:hover,
  .theme-hunter .key-wide:hover {
    transform: scale(1.08);
    border-color: rgba(167,139,250,0.3);
    box-shadow: 0 0 8px rgba(167,139,250,0.2);
  }
  .theme-hunter .key:active,
  .theme-hunter .key-wide:active {
    transform: scale(0.95);
    box-shadow: 0 0 12px rgba(217,70,168,0.35);
    border-color: #d946a8;
  }

  /* --- Leaderboard accents --- */
  .theme-hunter .lb-score {
    color: #a78bfa !important;
    text-shadow: 0 0 8px rgba(167,139,250,0.3);
  }
  .theme-hunter .lb-star {
    text-shadow: 0 0 8px rgba(244,114,182,0.4);
    animation: hunterGlow 2.5s ease-in-out infinite;
  }

  /* --- Scrollbar --- */
  .theme-hunter ::-webkit-scrollbar-thumb {
    background: rgba(217,70,168,0.2) !important;
    border-radius: 999px;
  }
  .theme-hunter ::-webkit-scrollbar-thumb:hover {
    background: rgba(217,70,168,0.35) !important;
  }

  /* --- Popup glass --- */
  .theme-hunter .purchase-overlay .purchase-popup,
  .theme-hunter .solo-overlay .solo-popup,
  .theme-hunter .space-popup,
  .theme-hunter .loadout-popup,
  .theme-hunter .save-popup,
  .theme-hunter .load-popup {
    background: rgba(245,240,252,0.94) !important;
    backdrop-filter: blur(22px);
    -webkit-backdrop-filter: blur(22px);
    border: 1px solid rgba(217,70,168,0.1);
    box-shadow: 0 0 25px rgba(217,70,168,0.1), 0 0 50px rgba(167,139,250,0.06);
  }

  /* --- General hover glow --- */
  .theme-hunter button:not(.play-go-btn):not(.nav-item):hover,
  .theme-hunter select:hover {
    box-shadow: 0 0 0 2px rgba(217,70,168,0.08), 0 0 10px rgba(217,70,168,0.12);
  }

  /* --- Active/click pulse --- */
  .theme-hunter button:active,
  .theme-hunter .song-tile:active,
  .theme-hunter .play-tile:active,
  .theme-hunter .space-tile:active {
    transform: scale(0.97) !important;
    transition-duration: 0.1s;
  }

  /* --- Dropdown selects --- */
  .theme-hunter select {
    border-radius: 999px !important;
    border: 1px solid rgba(217,70,168,0.12);
    background: rgba(232,223,244,0.8) !important;
  }

  /* --- Heading shimmer --- */
  .theme-hunter .topbar-title,
  .theme-hunter .page-title {
    background: linear-gradient(90deg, #d946a8, #a78bfa, #7dd3fc, #a78bfa, #d946a8);
    background-size: 200% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: hunterShimmer 6s linear infinite;
  }

  /* --- Dreamy ambient glow on the viewport --- */
  .theme-hunter::after {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: radial-gradient(ellipse at 25% 15%, rgba(217,70,168,0.06) 0%, transparent 55%),
                radial-gradient(ellipse at 75% 85%, rgba(167,139,250,0.05) 0%, transparent 55%),
                radial-gradient(ellipse at 50% 50%, rgba(125,211,252,0.03) 0%, transparent 60%);
    pointer-events: none;
    z-index: 1;
  }

  /* ============================================
     NEBULA THEME — scoped under .theme-nebula
     Abstract shapes & waves layered on panels
     Palette: deep space navy + purple/teal/coral
     ============================================ */

  /* --- Keyframes --- */
  @keyframes nebulaXpSlide {
    0%   { background-position: 0% 50%; }
    100% { background-position: 300% 50%; }
  }
  @keyframes nebulaGlow {
    0%, 100% { box-shadow: 0 0 6px rgba(124,91,245,0.2); }
    50%      { box-shadow: 0 0 18px rgba(124,91,245,0.5); }
  }
  @keyframes nebulaBorderRotate {
    0%   { border-color: #7c5bf5; }
    33%  { border-color: #14b8a6; }
    66%  { border-color: #ff6b9d; }
    100% { border-color: #7c5bf5; }
  }
  @keyframes nebulaDrift {
    0%   { background-position: 0% 0%; }
    50%  { background-position: 5% 3%; }
    100% { background-position: 0% 0%; }
  }

  /* --- Glassmorphism panels --- */
  .theme-nebula .topbar {
    background: rgba(14,21,40,0.9) !important;
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border-bottom: 1px solid rgba(124,91,245,0.1);
    overflow: hidden;
    position: relative;
  }
  .theme-nebula .page {
    background: transparent !important;
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    border: none;
    overflow: hidden;
    position: relative;
  }
  .theme-nebula .navbar {
    background: rgba(14,21,40,0.92) !important;
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border-top: 1px solid rgba(124,91,245,0.1);
    overflow: hidden;
    position: relative;
  }

  /* ─── Abstract waves & shapes on main page panel ─── */
  .theme-nebula .page::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background:
      /* Wave band 1 — sweeping diagonal, purple */
      linear-gradient(162deg, transparent 12%, rgba(124,91,245,0.1) 13%, rgba(124,91,245,0.07) 26%, transparent 27%),
      /* Wave band 2 — mid diagonal, teal */
      linear-gradient(170deg, transparent 38%, rgba(20,184,166,0.08) 39%, rgba(20,184,166,0.05) 52%, transparent 53%),
      /* Wave band 3 — lower diagonal, coral */
      linear-gradient(166deg, transparent 62%, rgba(255,107,157,0.06) 63%, rgba(255,107,157,0.035) 76%, transparent 77%),
      /* Large blob — top-right, purple */
      radial-gradient(ellipse 55% 45% at 82% 12%, rgba(124,91,245,0.09) 0%, transparent 100%),
      /* Medium blob — bottom-left, teal */
      radial-gradient(ellipse 45% 40% at 12% 78%, rgba(20,184,166,0.07) 0%, transparent 100%),
      /* Small blob — centre, coral */
      radial-gradient(circle 18% at 52% 48%, rgba(255,107,157,0.05) 0%, transparent 100%),
      /* Thin accent line — diagonal, bright purple */
      linear-gradient(155deg, transparent 44%, rgba(124,91,245,0.06) 44.3%, transparent 44.6%),
      /* Thin accent line — counter-diagonal, teal */
      linear-gradient(200deg, transparent 58%, rgba(20,184,166,0.04) 58.3%, transparent 58.6%);
    pointer-events: none;
    z-index: 1;
    border-radius: inherit;
    animation: nebulaDrift 20s ease-in-out infinite;
  }

  /* ─── Abstract shapes on topbar ─── */
  .theme-nebula .topbar::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background:
      radial-gradient(ellipse 50% 150% at 18% 50%, rgba(124,91,245,0.1) 0%, transparent 100%),
      radial-gradient(ellipse 35% 120% at 88% 50%, rgba(20,184,166,0.06) 0%, transparent 100%),
      linear-gradient(90deg, transparent 30%, rgba(255,107,157,0.03) 55%, transparent 80%);
    pointer-events: none;
    z-index: 1;
    border-radius: inherit;
  }

  /* ─── Abstract shapes on navbar ─── */
  .theme-nebula .navbar::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background:
      radial-gradient(ellipse 45% 130% at 75% 50%, rgba(124,91,245,0.07) 0%, transparent 100%),
      radial-gradient(ellipse 35% 120% at 25% 50%, rgba(255,107,157,0.05) 0%, transparent 100%);
    pointer-events: none;
    z-index: 1;
    border-radius: inherit;
  }

  /* --- Pill-shaped nav items --- */
  .theme-nebula .nav-item {
    border-radius: 999px !important;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-nebula .nav-item:hover {
    background: rgba(124,91,245,0.1);
    transform: scale(1.05);
  }
  .theme-nebula .nav-item.active .nav-icon {
    color: #14b8a6 !important;
    text-shadow: 0 0 12px rgba(20,184,166,0.5);
  }
  .theme-nebula .nav-item.active .nav-label {
    color: #14b8a6 !important;
  }
  .theme-nebula .nav-item.active {
    position: relative;
  }
  .theme-nebula .nav-item.active::after {
    content: '';
    position: absolute;
    bottom: 4px;
    left: 15%;
    width: 70%;
    height: 2px;
    background: linear-gradient(90deg, #7c5bf5, #14b8a6);
    box-shadow: 0 0 8px rgba(20,184,166,0.4);
    animation: navUnderline 0.3s ease-out forwards;
  }

  /* --- Tabs (play mode, leaderboard) --- */
  .theme-nebula .play-mode-tab,
  .theme-nebula .lb-type-btn {
    border-radius: 999px !important;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    border: 1px solid transparent;
  }
  .theme-nebula .play-mode-tab:hover,
  .theme-nebula .lb-type-btn:hover {
    transform: scale(1.05);
    border-color: rgba(124,91,245,0.2);
    box-shadow: 0 0 10px rgba(124,91,245,0.15);
  }
  .theme-nebula .play-mode-tab.active,
  .theme-nebula .lb-type-btn.active {
    border-color: #7c5bf5 !important;
    box-shadow: 0 0 8px rgba(124,91,245,0.3), 0 0 20px rgba(124,91,245,0.12);
  }

  /* --- Filters / pickers --- */
  .theme-nebula .picker-filter {
    border-radius: 999px !important;
    border: 1px solid transparent;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-nebula .picker-filter:hover {
    transform: scale(1.05);
    border-color: rgba(20,184,166,0.25);
    box-shadow: 0 0 10px rgba(20,184,166,0.15);
  }
  .theme-nebula .picker-filter.active {
    border-color: #14b8a6;
    box-shadow: 0 0 8px rgba(20,184,166,0.3), 0 0 20px rgba(20,184,166,0.12);
  }

  /* --- Song / play / content tiles --- */
  .theme-nebula .song-tile,
  .theme-nebula .play-tile,
  .theme-nebula .space-tile,
  .theme-nebula .vault-tile,
  .theme-nebula .settings-tile,
  .theme-nebula .season-tile {
    border: 1px solid rgba(124,91,245,0.06);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-nebula .song-tile:hover,
  .theme-nebula .play-tile:hover,
  .theme-nebula .space-tile:hover,
  .theme-nebula .vault-tile:hover,
  .theme-nebula .settings-tile:hover,
  .theme-nebula .season-tile:hover {
    transform: scale(1.02);
    border-color: rgba(124,91,245,0.3);
    box-shadow: 0 0 0 2px rgba(124,91,245,0.1), 0 0 15px rgba(124,91,245,0.2), 0 0 30px rgba(20,184,166,0.08);
  }

  /* Cover art — cosmic saturation boost */
  .theme-nebula .song-tile img,
  .theme-nebula .play-tile img {
    filter: saturate(1.12) contrast(1.04);
  }

  /* --- Theme card for Nebula itself --- */
  .theme-nebula .theme-card {
    border: 1px solid rgba(124,91,245,0.06);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-nebula .theme-card:hover {
    transform: scale(1.03);
    border-color: rgba(124,91,245,0.25);
    box-shadow: 0 0 12px rgba(124,91,245,0.2);
  }
  .theme-nebula .theme-card.selected {
    border: 2px solid #7c5bf5;
    animation: nebulaBorderRotate 4s linear infinite;
    box-shadow: 0 0 12px rgba(124,91,245,0.35), 0 0 25px rgba(20,184,166,0.15);
  }

  /* --- Solo panel buttons --- */
  .theme-nebula .play-solo-btn,
  .theme-nebula .play-solo-cover-add,
  .theme-nebula .play-solo-add {
    border-radius: calc(var(--panel-radius) / 2) !important;
    border: 1px solid rgba(124,91,245,0.08);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-nebula .play-solo-btn:hover,
  .theme-nebula .play-solo-cover-add:hover,
  .theme-nebula .play-solo-add:hover {
    transform: scale(1.05);
    border-color: rgba(124,91,245,0.3);
    box-shadow: 0 0 0 2px rgba(124,91,245,0.1), 0 0 12px rgba(124,91,245,0.25);
  }

  /* --- Nebula: instrument colours (deep cosmic tones) --- */
  .theme-nebula .play-solo-btn[data-inst="guitar"],
  .theme-nebula .solo-popup-option[data-instrument="guitar"] { background: linear-gradient(135deg, #b45309, #d97706) !important; }
  .theme-nebula .play-solo-btn[data-inst="keys"],
  .theme-nebula .solo-popup-option[data-instrument="keys"]   { background: linear-gradient(135deg, #4338ca, #6366f1) !important; }
  .theme-nebula .play-solo-btn[data-inst="drums"],
  .theme-nebula .solo-popup-option[data-instrument="drums"]  { background: linear-gradient(135deg, #991b1b, #dc2626) !important; }
  .theme-nebula .play-solo-btn[data-inst="vocals"],
  .theme-nebula .solo-popup-option[data-instrument="vocals"] { background: linear-gradient(135deg, #7e22ce, #a855f7) !important; }
  .theme-nebula .play-solo-btn[data-inst="bass"],
  .theme-nebula .solo-popup-option[data-instrument="bass"]   { background: linear-gradient(135deg, #0e7490, #14b8a6) !important; }

  /* --- Nebula: difficulty colours --- */
  .theme-nebula .play-solo-btn[data-diff="easy"],
  .theme-nebula .solo-popup-option[data-difficulty="easy"]   { background: linear-gradient(135deg, #047857, #10b981) !important; }
  .theme-nebula .play-solo-btn[data-diff="medium"],
  .theme-nebula .solo-popup-option[data-difficulty="medium"] { background: linear-gradient(135deg, #a16207, #eab308) !important; }
  .theme-nebula .play-solo-btn[data-diff="hard"],
  .theme-nebula .solo-popup-option[data-difficulty="hard"]   { background: linear-gradient(135deg, #c2410c, #f97316) !important; }
  .theme-nebula .play-solo-btn[data-diff="expert"],
  .theme-nebula .solo-popup-option[data-difficulty="expert"] { background: linear-gradient(135deg, #b91c1c, #ef4444) !important; }

  /* --- Nebula: space & loadout buttons --- */
  .theme-nebula .play-solo-btn[data-role="space"]   { background: linear-gradient(135deg, #1e1b4b, #4338ca) !important; }
  .theme-nebula .play-solo-btn[data-role="loadout"] { background: linear-gradient(135deg, #134e4a, #14b8a6) !important; }

  /* --- Popup overlays --- */
  .theme-nebula .solo-popup-option,
  .theme-nebula .space-popup-opt,
  .theme-nebula .loadout-opt,
  .theme-nebula .play-coop-tile {
    background: rgba(14,21,40,0.92) !important;
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
    border: 1px solid rgba(124,91,245,0.08);
    border-radius: calc(var(--panel-radius) / 2) !important;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-nebula .solo-popup-option:hover,
  .theme-nebula .space-popup-opt:hover,
  .theme-nebula .loadout-opt:hover,
  .theme-nebula .play-coop-tile:hover {
    transform: scale(1.03);
    border-color: rgba(124,91,245,0.3);
    box-shadow: 0 0 0 2px rgba(124,91,245,0.1), 0 0 12px rgba(124,91,245,0.2), 0 0 25px rgba(20,184,166,0.08);
  }

  /* --- Play Go button — purple-to-teal gradient --- */
  .theme-nebula .play-go-btn {
    background: linear-gradient(135deg, #7c5bf5, #14b8a6) !important;
    border: none !important;
    border-radius: 999px !important;
    box-shadow: 0 0 12px rgba(124,91,245,0.4), 0 0 25px rgba(20,184,166,0.2);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    color: #fff !important;
    text-shadow: 0 0 8px rgba(255,255,255,0.3);
  }
  .theme-nebula .play-go-btn:hover {
    transform: scale(1.08);
    box-shadow: 0 0 18px rgba(124,91,245,0.55), 0 0 35px rgba(20,184,166,0.3), 0 0 50px rgba(255,107,157,0.12);
    filter: brightness(1.1);
  }

  /* --- Play bar & misc buttons --- */
  .theme-nebula .play-bar-btn,
  .theme-nebula .back-btn,
  .theme-nebula .purchase-btn,
  .theme-nebula .setlist-btn,
  .theme-nebula .song-tile-btn {
    border-radius: 999px !important;
    border: 1px solid rgba(124,91,245,0.1);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-nebula .play-bar-btn:hover,
  .theme-nebula .back-btn:hover,
  .theme-nebula .purchase-btn:hover,
  .theme-nebula .setlist-btn:hover,
  .theme-nebula .song-tile-btn:hover {
    transform: scale(1.05);
    border-color: rgba(124,91,245,0.3);
    box-shadow: 0 0 0 2px rgba(124,91,245,0.1), 0 0 12px rgba(124,91,245,0.2);
  }

  /* --- Go bar --- */
  .theme-nebula .play-go-bar {
    background: rgba(14,21,40,0.92) !important;
    backdrop-filter: blur(18px);
    -webkit-backdrop-filter: blur(18px);
    border-top: 1px solid rgba(124,91,245,0.1);
  }

  /* --- XP bar — animated cosmic gradient --- */
  .theme-nebula .xp-bar-full {
    background: linear-gradient(90deg, #7c5bf5, #14b8a6, #ff6b9d, #7c5bf5) !important;
    background-size: 300% 100%;
    animation: nebulaXpSlide 4s linear infinite;
    box-shadow: 0 0 8px rgba(124,91,245,0.35), 0 0 16px rgba(20,184,166,0.15);
    border-radius: 999px;
  }

  /* --- Keyboard keys --- */
  .theme-nebula .key,
  .theme-nebula .key-wide {
    border-radius: calc(var(--panel-radius) / 2) !important;
    border: 1px solid rgba(124,91,245,0.1);
    transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
    background: rgba(22,32,64,0.9) !important;
  }
  .theme-nebula .key:hover,
  .theme-nebula .key-wide:hover {
    transform: scale(1.08);
    border-color: rgba(20,184,166,0.3);
    box-shadow: 0 0 8px rgba(20,184,166,0.2);
  }
  .theme-nebula .key:active,
  .theme-nebula .key-wide:active {
    transform: scale(0.95);
    box-shadow: 0 0 12px rgba(124,91,245,0.4);
    border-color: #7c5bf5;
  }

  /* --- Leaderboard accents --- */
  .theme-nebula .lb-score {
    color: #14b8a6 !important;
    text-shadow: 0 0 8px rgba(20,184,166,0.35);
  }
  .theme-nebula .lb-star {
    text-shadow: 0 0 8px rgba(124,91,245,0.4);
    animation: nebulaGlow 2.5s ease-in-out infinite;
  }

  /* --- Scrollbar --- */
  .theme-nebula ::-webkit-scrollbar-thumb {
    background: rgba(124,91,245,0.2) !important;
    border-radius: 999px;
  }
  .theme-nebula ::-webkit-scrollbar-thumb:hover {
    background: rgba(124,91,245,0.4) !important;
  }

  /* --- Popup glass --- */
  .theme-nebula .purchase-overlay .purchase-popup,
  .theme-nebula .solo-overlay .solo-popup,
  .theme-nebula .space-popup,
  .theme-nebula .loadout-popup,
  .theme-nebula .save-popup,
  .theme-nebula .load-popup {
    background: rgba(14,21,40,0.96) !important;
    backdrop-filter: blur(22px);
    -webkit-backdrop-filter: blur(22px);
    border: 1px solid rgba(124,91,245,0.12);
    box-shadow: 0 0 25px rgba(124,91,245,0.12), 0 0 50px rgba(20,184,166,0.06);
  }

  /* --- General hover glow --- */
  .theme-nebula button:not(.play-go-btn):not(.nav-item):hover,
  .theme-nebula select:hover {
    box-shadow: 0 0 0 2px rgba(124,91,245,0.08), 0 0 10px rgba(124,91,245,0.15);
  }

  /* --- Active/click pulse --- */
  .theme-nebula button:active,
  .theme-nebula .song-tile:active,
  .theme-nebula .play-tile:active,
  .theme-nebula .space-tile:active {
    transform: scale(0.97) !important;
    transition-duration: 0.1s;
  }

  /* --- Dropdown selects --- */
  .theme-nebula select {
    border-radius: 999px !important;
    border: 1px solid rgba(124,91,245,0.12);
    background: rgba(22,32,64,0.85) !important;
  }

  /* --- Heading glow --- */
  .theme-nebula .topbar-title,
  .theme-nebula .page-title {
    text-shadow: 0 0 14px rgba(124,91,245,0.3), 0 0 28px rgba(20,184,166,0.12);
  }

  /* --- Cosmic ambient glow on the viewport --- */
  .theme-nebula::after {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background:
      radial-gradient(ellipse at 20% 15%, rgba(124,91,245,0.06) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 85%, rgba(20,184,166,0.05) 0%, transparent 50%),
      radial-gradient(ellipse at 50% 50%, rgba(255,107,157,0.03) 0%, transparent 55%);
    pointer-events: none;
    z-index: 1;
  }

  /* ============================================
     LIQUID GLASS THEME — scoped under .theme-liquid
     Apple-style liquid glass with refractive effects,
     layered inner highlights, prismatic edges
     ============================================ */

  /* --- Keyframes --- */
  @keyframes liquidShimmer {
    0%   { background-position: -200% 0; }
    100% { background-position: 200% 0; }
  }
  @keyframes liquidGlow {
    0%, 100% { box-shadow: 0 0 8px rgba(88,72,160,0.15), inset 0 1px 0 rgba(255,255,255,0.08); }
    50%      { box-shadow: 0 0 20px rgba(88,72,160,0.35), inset 0 1px 0 rgba(255,255,255,0.15); }
  }
  @keyframes liquidXpSlide {
    0%   { background-position: 0% 50%; }
    100% { background-position: 300% 50%; }
  }
  @keyframes liquidBorderRotate {
    0%   { border-color: rgba(88,72,160,0.5); }
    25%  { border-color: rgba(200,56,104,0.5); }
    50%  { border-color: rgba(40,152,120,0.5); }
    75%  { border-color: rgba(200,144,48,0.4); }
    100% { border-color: rgba(88,72,160,0.5); }
  }
  @keyframes liquidRipple {
    0%   { transform: scale(0.97); box-shadow: 0 2px 8px rgba(88,72,160,0.3), inset 0 1px 0 rgba(255,255,255,0.1); }
    50%  { transform: scale(1.01); box-shadow: 0 4px 16px rgba(88,72,160,0.2), inset 0 1px 0 rgba(255,255,255,0.12); }
    100% { transform: scale(1); box-shadow: 0 8px 32px rgba(88,72,160,0.15), inset 0 1px 0 rgba(255,255,255,0.1); }
  }
  @keyframes liquidSpecular {
    0%   { opacity: 0; transform: translateX(-100%) skewX(-15deg); }
    50%  { opacity: 0.6; }
    100% { opacity: 0; transform: translateX(200%) skewX(-15deg); }
  }

  /* --- Glassmorphism panels with layered inner highlights --- */
  .theme-liquid .topbar {
    background: rgba(88,72,160,0.08) !important;
    backdrop-filter: blur(24px) saturate(160%);
    -webkit-backdrop-filter: blur(24px) saturate(160%);
    border: 1px solid rgba(88,72,160,0.12) !important;
    border-bottom: 1px solid rgba(88,72,160,0.15) !important;
    box-shadow: 0 8px 32px rgba(88,72,160,0.08), inset 0 1px 0 rgba(255,255,255,0.35);
    overflow: hidden;
    position: relative;
  }
  .theme-liquid .content {
    background: transparent !important;
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    border: none !important;
    box-shadow: none !important;
    overflow: hidden;
    position: relative;
  }
  .theme-liquid .page {
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
    border-radius: 0;
  }
  .theme-liquid .navbar {
    background: rgba(88,72,160,0.08) !important;
    backdrop-filter: blur(24px) saturate(160%);
    -webkit-backdrop-filter: blur(24px) saturate(160%);
    border: 1px solid rgba(88,72,160,0.12) !important;
    border-top: 1px solid rgba(88,72,160,0.15) !important;
    box-shadow: 0 -4px 24px rgba(88,72,160,0.06), inset 0 1px 0 rgba(255,255,255,0.35);
    overflow: hidden;
    position: relative;
  }

  /* --- Inner specular highlight on panels (top-left light source) --- */
  .theme-liquid .topbar::before,
  .theme-liquid .navbar::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.15) 0%, transparent 40%, transparent 60%, rgba(88,72,160,0.03) 100%);
    pointer-events: none;
    z-index: 1;
    border-radius: inherit;
  }

  /* --- Pill-shaped glass nav items --- */
  .theme-liquid .nav-item {
    border-radius: 999px !important;
    background: rgba(88,72,160,0.04) !important;
    border: 1px solid rgba(88,72,160,0.08);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.20);
    transition: all 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
    transform-origin: center center;
  }
  .theme-liquid .nav-item:hover {
    background: rgba(88,72,160,0.10) !important;
    border-color: rgba(200,56,104,0.2);
    box-shadow: 0 0 16px rgba(200,56,104,0.10), inset 0 1px 0 rgba(255,255,255,0.25);
    transform: none !important;
  }
  .theme-liquid .nav-item.active .nav-icon {
    color: #c83868 !important;
    text-shadow: 0 0 14px rgba(200,56,104,0.4);
  }
  .theme-liquid .nav-item.active .nav-label {
    color: #c83868 !important;
  }
  .theme-liquid .nav-item.active {
    background: rgba(200,56,104,0.08) !important;
    border-color: rgba(200,56,104,0.2);
    box-shadow: 0 0 12px rgba(200,56,104,0.12), inset 0 1px 0 rgba(255,255,255,0.20);
    position: relative;
  }

  /* --- Glass tabs (play mode, leaderboard) --- */
  .theme-liquid .play-mode-tab,
  .theme-liquid .lb-type-btn {
    border-radius: 999px !important;
    background: rgba(88,72,160,0.04) !important;
    border: 1px solid rgba(88,72,160,0.08);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.20);
    transition: all 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-liquid .play-mode-tab:hover,
  .theme-liquid .lb-type-btn:hover {
    background: rgba(88,72,160,0.10) !important;
    border-color: rgba(200,56,104,0.2);
    box-shadow: 0 0 12px rgba(200,56,104,0.08), inset 0 1px 0 rgba(255,255,255,0.25);
    transform: scale(1.05);
  }
  .theme-liquid .play-mode-tab.active,
  .theme-liquid .lb-type-btn.active {
    background: rgba(200,56,104,0.10) !important;
    border-color: rgba(200,56,104,0.3) !important;
    box-shadow: 0 0 14px rgba(200,56,104,0.12), inset 0 1px 0 rgba(255,255,255,0.20);
  }

  /* --- Glass filters / pickers --- */
  .theme-liquid .picker-filter {
    border-radius: 999px !important;
    background: rgba(88,72,160,0.04) !important;
    border: 1px solid rgba(88,72,160,0.08);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.20);
    transition: all 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-liquid .picker-filter:hover {
    background: rgba(88,72,160,0.08) !important;
    border-color: rgba(136,48,136,0.2);
    box-shadow: 0 0 12px rgba(136,48,136,0.08), inset 0 1px 0 rgba(255,255,255,0.25);
    transform: scale(1.05);
  }
  .theme-liquid .picker-filter.active {
    border-color: rgba(200,56,104,0.3);
    box-shadow: 0 0 12px rgba(200,56,104,0.12), inset 0 1px 0 rgba(255,255,255,0.20);
  }

  /* --- Glass content tiles — the core liquid glass effect --- */
  .theme-liquid .song-tile,
  .theme-liquid .play-tile,
  .theme-liquid .space-tile,
  .theme-liquid .vault-tile,
  .theme-liquid .settings-tile,
  .theme-liquid .season-tile {
    border: 1px solid rgba(88,72,160,0.10);
    box-shadow: 0 4px 16px rgba(88,72,160,0.08), inset 0 1px 0 rgba(255,255,255,0.25);
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
  }
  .theme-liquid .song-tile:hover,
  .theme-liquid .play-tile:hover,
  .theme-liquid .space-tile:hover,
  .theme-liquid .vault-tile:hover,
  .theme-liquid .settings-tile:hover,
  .theme-liquid .season-tile:hover {
    transform: scale(1.03);
    border-color: rgba(200,56,104,0.25);
    box-shadow:
      0 12px 40px rgba(88,72,160,0.18),
      0 0 0 1px rgba(200,56,104,0.08),
      0 0 20px rgba(200,56,104,0.06),
      inset 0 1px 0 rgba(255,255,255,0.30);
  }
  .theme-liquid .song-tile:active,
  .theme-liquid .play-tile:active,
  .theme-liquid .space-tile:active,
  .theme-liquid .vault-tile:active {
    transform: scale(0.97) !important;
    box-shadow:
      0 2px 8px rgba(88,72,160,0.25),
      inset 0 2px 4px rgba(0,0,0,0.10),
      inset 0 1px 0 rgba(255,255,255,0.15);
    transition-duration: 0.1s;
  }

  /* Cover art — glass color boost */
  .theme-liquid .song-tile img,
  .theme-liquid .play-tile img {
    filter: saturate(1.15) brightness(1.05) contrast(1.02);
  }

  /* --- Glass theme card --- */
  .theme-liquid .theme-card {
    border: 1px solid rgba(88,72,160,0.10);
    box-shadow: 0 4px 16px rgba(88,72,160,0.08), inset 0 1px 0 rgba(255,255,255,0.20);
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-liquid .theme-card:hover {
    transform: scale(1.04);
    border-color: rgba(200,56,104,0.2);
    box-shadow:
      0 12px 40px rgba(88,72,160,0.15),
      0 0 16px rgba(200,56,104,0.08),
      inset 0 1px 0 rgba(255,255,255,0.25);
  }
  .theme-liquid .theme-card.selected {
    border: 2px solid rgba(200,56,104,0.4);
    animation: liquidBorderRotate 5s linear infinite;
    box-shadow:
      0 0 20px rgba(200,56,104,0.15),
      0 0 40px rgba(88,72,160,0.08),
      inset 0 1px 0 rgba(255,255,255,0.25);
  }

  /* --- Glass solo panel buttons --- */
  .theme-liquid .play-solo-btn,
  .theme-liquid .play-solo-cover-add,
  .theme-liquid .play-solo-add {
    border-radius: calc(var(--panel-radius) / 2) !important;
    border: 1px solid rgba(88,72,160,0.12);
    box-shadow: 0 4px 16px rgba(88,72,160,0.08), inset 0 1px 0 rgba(255,255,255,0.25);
    transition: all 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-liquid .play-solo-btn:hover,
  .theme-liquid .play-solo-cover-add:hover,
  .theme-liquid .play-solo-add:hover {
    transform: scale(1.06);
    border-color: rgba(200,56,104,0.3);
    box-shadow:
      0 8px 28px rgba(88,72,160,0.15),
      0 0 16px rgba(200,56,104,0.10),
      inset 0 1px 0 rgba(255,255,255,0.30);
  }
  .theme-liquid .play-solo-btn:active,
  .theme-liquid .play-solo-cover-add:active,
  .theme-liquid .play-solo-add:active {
    transform: scale(0.95) !important;
    box-shadow: 0 2px 8px rgba(88,72,160,0.25), inset 0 2px 4px rgba(0,0,0,0.08);
    transition-duration: 0.08s;
  }

  /* --- Liquid: instrument colours (frosted glass gradient) --- */
  .theme-liquid .play-solo-btn[data-inst="guitar"],
  .theme-liquid .solo-popup-option[data-instrument="guitar"] { background: linear-gradient(135deg, rgba(180,83,9,0.85), rgba(217,119,6,0.7)) !important; }
  .theme-liquid .play-solo-btn[data-inst="keys"],
  .theme-liquid .solo-popup-option[data-instrument="keys"]   { background: linear-gradient(135deg, rgba(67,56,202,0.85), rgba(99,102,241,0.7)) !important; }
  .theme-liquid .play-solo-btn[data-inst="drums"],
  .theme-liquid .solo-popup-option[data-instrument="drums"]  { background: linear-gradient(135deg, rgba(153,27,27,0.85), rgba(220,38,38,0.7)) !important; }
  .theme-liquid .play-solo-btn[data-inst="vocals"],
  .theme-liquid .solo-popup-option[data-instrument="vocals"] { background: linear-gradient(135deg, rgba(126,34,206,0.85), rgba(168,85,247,0.7)) !important; }
  .theme-liquid .play-solo-btn[data-inst="bass"],
  .theme-liquid .solo-popup-option[data-instrument="bass"]   { background: linear-gradient(135deg, rgba(14,116,144,0.85), rgba(20,184,166,0.7)) !important; }

  /* --- Liquid: difficulty colours --- */
  .theme-liquid .play-solo-btn[data-diff="easy"],
  .theme-liquid .solo-popup-option[data-difficulty="easy"]   { background: linear-gradient(135deg, rgba(4,120,87,0.85), rgba(16,185,129,0.7)) !important; }
  .theme-liquid .play-solo-btn[data-diff="medium"],
  .theme-liquid .solo-popup-option[data-difficulty="medium"] { background: linear-gradient(135deg, rgba(161,98,7,0.85), rgba(234,179,8,0.7)) !important; }
  .theme-liquid .play-solo-btn[data-diff="hard"],
  .theme-liquid .solo-popup-option[data-difficulty="hard"]   { background: linear-gradient(135deg, rgba(194,65,12,0.85), rgba(249,115,22,0.7)) !important; }
  .theme-liquid .play-solo-btn[data-diff="expert"],
  .theme-liquid .solo-popup-option[data-difficulty="expert"] { background: linear-gradient(135deg, rgba(185,28,28,0.85), rgba(239,68,68,0.7)) !important; }

  /* --- Liquid: space & loadout buttons --- */
  .theme-liquid .play-solo-btn[data-role="space"]   { background: linear-gradient(135deg, rgba(30,27,75,0.85), rgba(67,56,202,0.7)) !important; }
  .theme-liquid .play-solo-btn[data-role="loadout"] { background: linear-gradient(135deg, rgba(19,78,74,0.85), rgba(20,184,166,0.7)) !important; }

  /* --- Liquid: meta bubbles --- */
  .theme-liquid .meta-bubble {
    backdrop-filter: blur(16px) saturate(160%);
    -webkit-backdrop-filter: blur(16px) saturate(160%);
    box-shadow: 0 2px 10px rgba(0,0,0,0.06), inset 0 1px 0 rgba(255,255,255,0.35);
  }

  .theme-liquid .meta-bubble-title {
    background: rgba(88,72,160,0.12);
    color: #7868c0;
    border-color: rgba(88,72,160,0.18);
  }

  .theme-liquid .meta-bubble-artist {
    background: rgba(200,56,104,0.10);
    color: #d05880;
    border-color: rgba(200,56,104,0.15);
  }

  .theme-liquid .meta-bubble-dur {
    background: rgba(40,152,120,0.10);
    color: #38b090;
    border-color: rgba(40,152,120,0.15);
  }

  .theme-liquid .meta-bubble-bpm {
    background: rgba(200,144,48,0.10);
    color: #d0a048;
    border-color: rgba(200,144,48,0.15);
  }

  /* --- Glass popup options --- */
  .theme-liquid .solo-popup-option,
  .theme-liquid .space-popup-opt,
  .theme-liquid .loadout-opt,
  .theme-liquid .play-coop-tile {
    background: rgba(88,72,160,0.05) !important;
    backdrop-filter: blur(12px) saturate(150%);
    -webkit-backdrop-filter: blur(12px) saturate(150%);
    border: 1px solid rgba(88,72,160,0.10);
    border-radius: calc(var(--panel-radius) / 2) !important;
    box-shadow: 0 4px 16px rgba(88,72,160,0.08), inset 0 1px 0 rgba(255,255,255,0.20);
    transition: all 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
    overflow: hidden;
  }
  /* Shimmer sweep on hover (the liquid specular highlight) */
  .theme-liquid .solo-popup-option::before,
  .theme-liquid .space-popup-opt::before,
  .theme-liquid .loadout-opt::before,
  .theme-liquid .play-coop-tile::before {
    content: '';
    position: absolute;
    top: 0; left: -100%; width: 60%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.12), transparent);
    transform: skewX(-15deg);
    transition: left 0.5s ease;
    pointer-events: none;
    z-index: 3;
  }
  .theme-liquid .solo-popup-option:hover::before,
  .theme-liquid .space-popup-opt:hover::before,
  .theme-liquid .loadout-opt:hover::before,
  .theme-liquid .play-coop-tile:hover::before {
    left: 150%;
  }
  .theme-liquid .solo-popup-option:hover,
  .theme-liquid .space-popup-opt:hover,
  .theme-liquid .loadout-opt:hover,
  .theme-liquid .play-coop-tile:hover {
    transform: scale(1.03);
    background: rgba(88,72,160,0.09) !important;
    border-color: rgba(200,56,104,0.25);
    box-shadow:
      0 8px 28px rgba(88,72,160,0.15),
      0 0 14px rgba(200,56,104,0.06),
      inset 0 1px 0 rgba(255,255,255,0.25);
  }
  .theme-liquid .solo-popup-option:active,
  .theme-liquid .space-popup-opt:active,
  .theme-liquid .loadout-opt:active,
  .theme-liquid .play-coop-tile:active {
    transform: scale(0.97) !important;
    box-shadow: 0 2px 6px rgba(88,72,160,0.20), inset 0 2px 6px rgba(0,0,0,0.08);
    transition-duration: 0.08s;
  }

  /* --- Liquid Glass Go button — prismatic gradient --- */
  .theme-liquid .play-go-btn {
    background: linear-gradient(135deg, rgba(200,56,104,0.75), rgba(88,72,160,0.65), rgba(40,152,120,0.55)) !important;
    border: 1px solid rgba(255,255,255,0.25) !important;
    border-radius: 999px !important;
    box-shadow:
      0 8px 32px rgba(88,72,160,0.20),
      0 0 20px rgba(200,56,104,0.12),
      inset 0 1px 0 rgba(255,255,255,0.30),
      inset 0 -1px 0 rgba(0,0,0,0.08);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    transition: all 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
    color: #fff !important;
    text-shadow: 0 1px 3px rgba(0,0,0,0.2);
    position: relative;
    overflow: hidden;
  }
  /* Shimmer sweep on Go button hover */
  .theme-liquid .play-go-btn::before {
    content: '';
    position: absolute;
    top: 0; left: -100%; width: 70%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.25), transparent);
    transform: skewX(-15deg);
    transition: left 0.6s ease;
    pointer-events: none;
    z-index: 3;
  }
  .theme-liquid .play-go-btn:hover::before {
    left: 180%;
  }
  .theme-liquid .play-go-btn:hover {
    transform: scale(1.08);
    box-shadow:
      0 16px 48px rgba(88,72,160,0.25),
      0 0 30px rgba(200,56,104,0.15),
      0 0 60px rgba(88,72,160,0.08),
      inset 0 1px 0 rgba(255,255,255,0.35);
    filter: brightness(1.1);
  }
  .theme-liquid .play-go-btn:active {
    transform: scale(0.96) !important;
    box-shadow:
      0 2px 8px rgba(88,72,160,0.30),
      inset 0 2px 6px rgba(0,0,0,0.12);
    transition-duration: 0.08s;
  }

  /* --- Glass bar & misc buttons with shimmer --- */
  .theme-liquid .play-bar-btn,
  .theme-liquid .back-btn,
  .theme-liquid .purchase-btn,
  .theme-liquid .setlist-btn,
  .theme-liquid .song-tile-btn {
    border-radius: 999px !important;
    border: 1px solid rgba(88,72,160,0.10);
    background: rgba(88,72,160,0.05) !important;
    box-shadow: 0 4px 12px rgba(88,72,160,0.06), inset 0 1px 0 rgba(255,255,255,0.20);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    transition: all 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
    overflow: hidden;
  }
  .theme-liquid .play-bar-btn:hover,
  .theme-liquid .back-btn:hover,
  .theme-liquid .purchase-btn:hover,
  .theme-liquid .setlist-btn:hover,
  .theme-liquid .song-tile-btn:hover {
    transform: scale(1.06);
    background: rgba(88,72,160,0.10) !important;
    border-color: rgba(200,56,104,0.2);
    box-shadow: 0 8px 24px rgba(88,72,160,0.12), 0 0 12px rgba(200,56,104,0.06), inset 0 1px 0 rgba(255,255,255,0.25);
  }
  .theme-liquid .play-bar-btn:active,
  .theme-liquid .back-btn:active,
  .theme-liquid .purchase-btn:active {
    transform: scale(0.95) !important;
    box-shadow: 0 1px 4px rgba(88,72,160,0.15), inset 0 2px 4px rgba(0,0,0,0.08);
    transition-duration: 0.08s;
  }

  /* --- Glass go bar: soft gradient fold --- */
  .theme-liquid .play-go-bar {
    background: transparent !important;
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    border-top: none;
    box-shadow: none;
    position: relative;
    z-index: 3;
  }
  .theme-liquid .play-main {
    position: relative;
  }
  .theme-liquid .play-main::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: -32px;
    right: -32px;
    height: 180px;
    background: linear-gradient(
      to bottom,
      transparent 0%,
      rgba(240,237,246,0.3) 25%,
      rgba(240,237,246,0.7) 55%,
      rgba(240,237,246,0.95) 80%,
      rgba(240,237,246,1) 100%
    );
    pointer-events: none;
    z-index: 2;
  }

  /* --- XP bar — prismatic animated gradient --- */
  .theme-liquid .xp-bar-full {
    background: linear-gradient(90deg, #5848a0, #c83868, #289878, #c89030, #5848a0) !important;
    background-size: 300% 100%;
    animation: liquidXpSlide 5s linear infinite;
    box-shadow: 0 0 10px rgba(200,56,104,0.20), 0 0 20px rgba(88,72,160,0.10);
    border-radius: 999px;
  }

  /* --- Glass keyboard keys --- */
  .theme-liquid .key,
  .theme-liquid .key-wide {
    border-radius: calc(var(--panel-radius) / 2) !important;
    background: rgba(88,72,160,0.04) !important;
    border: 1px solid rgba(88,72,160,0.08);
    box-shadow: 0 2px 8px rgba(88,72,160,0.06), inset 0 1px 0 rgba(255,255,255,0.20);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .theme-liquid .key:hover,
  .theme-liquid .key-wide:hover {
    transform: scale(1.08);
    background: rgba(88,72,160,0.10) !important;
    border-color: rgba(200,56,104,0.2);
    box-shadow: 0 4px 12px rgba(88,72,160,0.10), 0 0 8px rgba(200,56,104,0.05), inset 0 1px 0 rgba(255,255,255,0.25);
  }
  .theme-liquid .key:active,
  .theme-liquid .key-wide:active {
    transform: scale(0.94) !important;
    box-shadow: 0 1px 2px rgba(88,72,160,0.12), inset 0 2px 4px rgba(0,0,0,0.08);
    background: rgba(200,56,104,0.12) !important;
    border-color: rgba(200,56,104,0.3);
    transition-duration: 0.06s;
  }

  /* --- Leaderboard accents --- */
  .theme-liquid .lb-score {
    color: #5848a0 !important;
    text-shadow: 0 0 8px rgba(88,72,160,0.3);
  }
  .theme-liquid .lb-star {
    text-shadow: 0 0 8px rgba(200,144,48,0.4);
    animation: liquidGlow 3s ease-in-out infinite;
  }

  /* --- Frosted scrollbar --- */
  .theme-liquid ::-webkit-scrollbar-thumb {
    background: rgba(88,72,160,0.15) !important;
    border-radius: 999px;
  }
  .theme-liquid ::-webkit-scrollbar-thumb:hover {
    background: rgba(88,72,160,0.3) !important;
  }

  /* --- Glass popup overlays --- */
  .theme-liquid .purchase-overlay .purchase-popup,
  .theme-liquid .solo-overlay .solo-popup,
  .theme-liquid .space-popup,
  .theme-liquid .loadout-popup,
  .theme-liquid .save-popup,
  .theme-liquid .load-popup {
    background: rgba(240,237,246,0.80) !important;
    backdrop-filter: blur(24px) saturate(160%);
    -webkit-backdrop-filter: blur(24px) saturate(160%);
    border: 1px solid rgba(88,72,160,0.12);
    box-shadow:
      0 24px 80px rgba(88,72,160,0.15),
      0 0 1px rgba(88,72,160,0.10),
      inset 0 1px 0 rgba(255,255,255,0.40),
      inset 0 -1px 0 rgba(88,72,160,0.04);
  }

  /* --- General glass hover glow --- */
  .theme-liquid button:not(.play-go-btn):not(.nav-item):hover,
  .theme-liquid select:hover {
    box-shadow: 0 4px 16px rgba(88,72,160,0.08), 0 0 8px rgba(200,56,104,0.04), inset 0 1px 0 rgba(255,255,255,0.20);
  }

  /* --- Active/click press on all interactive elements --- */
  .theme-liquid button:active {
    transform: scale(0.96) !important;
    transition-duration: 0.08s;
  }

  /* --- Glass dropdown selects --- */
  .theme-liquid select {
    border-radius: 999px !important;
    border: 1px solid rgba(88,72,160,0.10);
    background: rgba(88,72,160,0.04) !important;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.20);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
  }

  /* --- Heading: frosted glass text effect --- */
  .theme-liquid .topbar-title,
  .theme-liquid .page-title {
    text-shadow: 0 0 16px rgba(88,72,160,0.15), 0 0 32px rgba(200,56,104,0.06);
  }

  /* --- Prismatic ambient light on viewport --- */
  .theme-liquid::after {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background:
      radial-gradient(ellipse 60% 50% at 15% 20%, rgba(88,72,160,0.06) 0%, transparent 60%),
      radial-gradient(ellipse 50% 40% at 85% 75%, rgba(200,56,104,0.04) 0%, transparent 55%),
      radial-gradient(ellipse 40% 35% at 50% 50%, rgba(40,152,120,0.03) 0%, transparent 50%),
      radial-gradient(ellipse 35% 30% at 70% 20%, rgba(200,144,48,0.025) 0%, transparent 50%);
    pointer-events: none;
    z-index: 1;
  }

  /* ── Liquid Glass: Enhanced Backdrop on Hover ───── */
  .theme-liquid .song-tile:hover,
  .theme-liquid .space-tile:hover,
  .theme-liquid .vault-tile:hover,
  .theme-liquid .settings-tile:hover,
  .theme-liquid .theme-card:not(.locked):hover,
  .theme-liquid .solo-popup-option:hover,
  .theme-liquid .space-popup-opt:hover,
  .theme-liquid .loadout-opt:hover,
  .theme-liquid .play-coop-tile:hover {
    -webkit-backdrop-filter: blur(24px) saturate(200%) brightness(112%);
    backdrop-filter: blur(24px) saturate(200%) brightness(112%);
  }
  .theme-liquid .nav-item:hover,
  .theme-liquid .play-mode-tab:hover,
  .theme-liquid .play-solo-btn:hover,
  .theme-liquid .lb-type-btn:hover {
    -webkit-backdrop-filter: blur(20px) saturate(190%) brightness(110%);
    backdrop-filter: blur(20px) saturate(190%) brightness(110%);
  }

  /* ── Liquid Glass: Luminous Border Glow (::after) ─ */
  .theme-liquid .nav-item::after,
  .theme-liquid .play-mode-tab::after,
  .theme-liquid .play-go-btn::after,
  .theme-liquid .play-solo-btn::after,
  .theme-liquid .song-tile::after,
  .theme-liquid .space-tile::after,
  .theme-liquid .vault-tile::after,
  .theme-liquid .settings-tile::after,
  .theme-liquid .theme-card:not(.locked)::after,
  .theme-liquid .solo-popup-option::after,
  .theme-liquid .space-popup-opt::after,
  .theme-liquid .loadout-opt::after,
  .theme-liquid .play-coop-tile::after,
  .theme-liquid .play-bar-btn::after,
  .theme-liquid .back-btn::after,
  .theme-liquid .purchase-btn::after {
    content: '';
    position: absolute;
    top: -1px; left: -1px; right: -1px; bottom: -1px;
    border-radius: inherit;
    background: linear-gradient(
      135deg,
      rgba(88,72,160,0.3) 0%,
      rgba(200,56,104,0.18) 25%,
      rgba(40,152,120,0.12) 50%,
      rgba(200,144,48,0.1) 75%,
      rgba(88,72,160,0.25) 100%
    );
    -webkit-mask:
      linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    mask:
      linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    -webkit-mask-composite: destination-out;
    mask-composite: exclude;
    padding: 1px;
    pointer-events: none;
    z-index: 4;
    opacity: 0;
    transition: opacity 0.35s ease;
  }
  .theme-liquid .nav-item:hover::after,
  .theme-liquid .play-mode-tab:hover::after,
  .theme-liquid .play-go-btn:hover::after,
  .theme-liquid .play-solo-btn:hover::after,
  .theme-liquid .song-tile:hover::after,
  .theme-liquid .space-tile:hover::after,
  .theme-liquid .vault-tile:hover::after,
  .theme-liquid .settings-tile:hover::after,
  .theme-liquid .theme-card:not(.locked):hover::after,
  .theme-liquid .solo-popup-option:hover::after,
  .theme-liquid .space-popup-opt:hover::after,
  .theme-liquid .loadout-opt:hover::after,
  .theme-liquid .play-coop-tile:hover::after,
  .theme-liquid .play-bar-btn:hover::after,
  .theme-liquid .back-btn:hover::after,
  .theme-liquid .purchase-btn:hover::after {
    opacity: 1;
  }

  /* Active nav: no underline, glow border only */
  .theme-liquid .nav-item.active::after {
    display: none;
  }

  /* ── Liquid Glass: Specular Highlight Container ─── */
  .theme-liquid .liquid-specular {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    border-radius: inherit;
    pointer-events: none;
    z-index: 5;
    opacity: 0;
    transition: opacity 0.3s ease;
    overflow: hidden;
  }
  .theme-liquid .liquid-specular-inner {
    position: absolute;
    width: 220px;
    height: 220px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255,255,255,0.22) 0%, rgba(255,255,255,0.06) 40%, transparent 70%);
    mix-blend-mode: screen;
    pointer-events: none;
    transform: translate(-50%, -50%);
  }
  .theme-liquid .liquid-hover .liquid-specular {
    opacity: 1;
  }

  /* ── Liquid Glass: JS controls transform for Tier 1 ── */
  .theme-liquid .nav-item.liquid-hover,
  .theme-liquid .play-mode-tab.liquid-hover,
  .theme-liquid .play-go-btn.liquid-hover,
  .theme-liquid .solo-popup-option.liquid-hover,
  .theme-liquid .space-popup-opt.liquid-hover,
  .theme-liquid .loadout-opt.liquid-hover {
    transition: box-shadow 0.35s ease, border-color 0.35s ease, background 0.35s ease, filter 0.35s ease;
  }

  /* ── Shimmer Animations ──────────────────────────── */
  @keyframes shimmerIdle {
    0%, 85% { transform: translateX(-100%); }
    100% { transform: translateX(250%); }
  }
  @keyframes shimmerHover {
    0%, 30% { transform: translateX(-100%); }
    100% { transform: translateX(250%); }
  }
  @keyframes shimmerActive {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(250%); }
  }

  /* Ensure shimmer containment on elements missing overflow/position */
  .nav-item,
  .play-mode-tab,
  .play-bar-btn,
  .play-go-btn,
  .lb-type-btn {
    overflow: hidden;
    position: relative;
  }

  /* Shimmer sweep pseudo-element */
  .nav-item::before,
  .play-mode-tab::before,
  .play-solo-btn::before,
  .play-solo-cover::before,
  .play-bar-btn::before,
  .play-go-btn::before,
  .settings-tile::before,
  .song-tile::before,
  .theme-card:not(.locked)::before,
  .lb-type-btn::before,
  .space-tile::before,
  .vault-tile::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 55%;
    height: 100%;
    background: linear-gradient(
      120deg,
      transparent 0%,
      rgba(255,255,255,0.15) 50%,
      transparent 100%
    );
    transform: translateX(-100%);
    opacity: 0.3;
    pointer-events: none;
    z-index: 3;
    animation: shimmerIdle 10s ease-in-out infinite;
    transition: opacity 0.4s ease;
  }

  /* Stagger delays so elements don't shimmer in sync */
  .nav-item::before              { animation-delay: 0s; }
  .play-mode-tab::before         { animation-delay: 1.2s; }
  .play-solo-btn::before         { animation-delay: 2.4s; }
  .play-solo-cover::before       { animation-delay: 3.6s; }
  .play-bar-btn::before          { animation-delay: 0.6s; }
  .play-go-btn::before           { animation-delay: 4.2s; }
  .settings-tile::before         { animation-delay: 0.8s; }
  .song-tile::before             { animation-delay: 1.8s; }
  .theme-card:not(.locked)::before { animation-delay: 2.8s; }
  .lb-type-btn::before           { animation-delay: 1.5s; }
  .space-tile::before            { animation-delay: 3.2s; }
  .vault-tile::before            { animation-delay: 0.4s; }

  /* Hover — faster sweep, brighter */
  .nav-item:hover::before,
  .play-mode-tab:hover::before,
  .play-solo-btn:hover::before,
  .play-solo-cover:hover::before,
  .play-bar-btn:hover::before,
  .play-go-btn:hover::before,
  .settings-tile:hover::before,
  .song-tile:hover::before,
  .theme-card:not(.locked):hover::before,
  .lb-type-btn:hover::before,
  .space-tile:hover::before,
  .vault-tile:hover::before {
    opacity: 0.8;
    animation: shimmerHover 3s ease-in-out infinite;
  }

  /* Active/click — fastest sweep, brightest */
  .nav-item:active::before,
  .play-mode-tab:active::before,
  .play-solo-btn:active::before,
  .play-solo-cover:active::before,
  .play-bar-btn:active::before,
  .play-go-btn:active::before,
  .settings-tile:active::before,
  .song-tile:active::before,
  .theme-card:not(.locked):active::before,
  .lb-type-btn:active::before,
  .space-tile:active::before,
  .vault-tile:active::before {
    opacity: 1;
    animation: shimmerActive 0.6s ease-in-out infinite;
  }

  /* ── Wireframe Testing Theme (Dark & Light) ──────── */
  .theme-wireframe,
  .theme-wireframe * {
    font-family: Arial, Helvetica, sans-serif !important;
  }

  .theme-wireframe .play-solo-btn {
    background: #666 !important;
  }

  .theme-wireframe .solo-btn-icon {
    display: none !important;
  }

  .theme-wireframe .solo-btn-label {
    position: static !important;
    text-align: center;
  }

  .theme-wireframe .play-solo-cover-add {
    border: 2px dashed var(--border-strong);
  }

  .theme-wireframe .play-solo-add {
    background: var(--bg-surface) !important;
    border: 2px dashed var(--border-strong);
  }

  .theme-wireframe .xp-bar-full {
    background: var(--text-primary) !important;
  }

  .theme-wireframe .play-go-btn {
    background: var(--text-primary) !important;
    color: var(--bg-body) !important;
    box-shadow: none !important;
  }

  .theme-wireframe .play-go-btn:hover {
    box-shadow: none !important;
    filter: brightness(0.85);
  }

  .theme-wireframe .play-mode-tab.active {
    background: var(--text-primary) !important;
    color: var(--bg-body) !important;
    border-color: var(--text-primary) !important;
  }

  .theme-wireframe .nav-item.active {
    background: var(--text-primary) !important;
    border-color: var(--text-primary) !important;
  }

  .theme-wireframe .nav-item.active .nav-icon,
  .theme-wireframe .nav-item.active .nav-label {
    color: var(--bg-body) !important;
  }

  .theme-wireframe .song-tile:hover,
  .theme-wireframe .space-tile:hover,
  .theme-wireframe .vault-tile:hover,
  .theme-wireframe .settings-tile:hover,
  .theme-wireframe .season-tile:hover,
  .theme-wireframe .theme-card:hover,
  .theme-wireframe .play-solo-btn:hover,
  .theme-wireframe .play-solo-cover:hover,
  .theme-wireframe .play-solo-cover-add:hover,
  .theme-wireframe .play-solo-add:hover,
  .theme-wireframe .play-coop-tile:hover,
  .theme-wireframe .play-tile:hover {
    box-shadow: none !important;
    border-color: var(--text-primary) !important;
  }

  .theme-wireframe .theme-card.selected {
    border-color: var(--text-primary) !important;
    box-shadow: none !important;
    animation: none !important;
  }

  .theme-wireframe .solo-popup-option {
    background: var(--bg-surface) !important;
  }

  .theme-wireframe .loadout-opt {
    background: var(--bg-surface) !important;
  }

  .theme-wireframe .play-nameplate {
    background: var(--text-primary) !important;
  }

  .theme-wireframe .play-bar-btn {
    border: 1px solid var(--border-strong);
  }

  .theme-wireframe .lb-type-btn.active {
    background: var(--text-primary) !important;
    color: var(--bg-body) !important;
    border-color: var(--text-primary) !important;
  }

  /* Kill shimmer on wireframe */
  .theme-wireframe .nav-item::before,
  .theme-wireframe .play-mode-tab::before,
  .theme-wireframe .play-solo-btn::before,
  .theme-wireframe .play-solo-cover::before,
  .theme-wireframe .play-bar-btn::before,
  .theme-wireframe .play-go-btn::before,
  .theme-wireframe .settings-tile::before,
  .theme-wireframe .song-tile::before,
  .theme-wireframe .theme-card::before,
  .theme-wireframe .lb-type-btn::before,
  .theme-wireframe .space-tile::before,
  .theme-wireframe .vault-tile::before {
    display: none !important;
  }

  /* ── Home Grid ──────────────────────────────────────── */
  .home-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 1fr);
    gap: var(--grid-gap);
    flex: 1;
    min-height: 0;
  }

  .home-tile {
    border-radius: calc(var(--panel-radius) / 2);
    background: var(--bg-surface);
    border: 2px solid var(--border-subtle);
    min-height: 0;
  }

  /* ── Layout Picker Overlay ─────────────────────────── */
  .layout-overlay          { display:none; position:absolute; inset:0; background:rgba(0,0,0,0.7); z-index:999; align-items:center; justify-content:center; }
  .layout-overlay.active   { display:flex; }
  .layout-popup            { background:var(--bg-panel); border-radius:var(--panel-radius); padding:40px 52px; width:1700px; max-height:90%; display:flex; flex-direction:column; position:relative; }
  .layout-title            { font-size:40px; font-weight:800; text-align:center; margin-bottom:8px; }
  .layout-count            { font-size:22px; color:var(--text-secondary); text-align:center; margin-bottom:16px; }
  .layout-browser          { display:grid; grid-template-columns:repeat(8,1fr); gap:12px; overflow-y:auto; flex:1; min-height:0; }

  /* Thumbnail cards (padding-top trick for 1:1 — Chromium 91 lacks aspect-ratio) */
  .layout-thumb-wrap       { position:relative; width:100%; padding-top:100%; }
  .layout-thumb            { position:absolute; top:0;left:0;right:0;bottom:0; display:grid; grid-template-columns:repeat(3,1fr); grid-template-rows:repeat(3,1fr); gap:3px; padding:6px; border-radius:calc(var(--panel-radius)/3); border:2px solid var(--border-subtle); background:var(--bg-panel); cursor:pointer; }
  .layout-thumb:hover      { border-color:var(--pink); }
  .layout-thumb.selected   { border-color:var(--pink); box-shadow:0 0 0 3px var(--pink-30); }
  .layout-thumb-tile       { border-radius:3px; background:var(--bg-surface); }

  /* "Layouts" button on home page */
  .home-layout-btn         { position:absolute; bottom:16px; right:16px; padding:12px 28px; border-radius:calc(var(--panel-radius)/2); border:2px solid var(--border-strong); background:var(--bg-surface); color:var(--text-primary); font-size:22px; font-weight:700; cursor:pointer; font-family:inherit; z-index:5; }
  .home-layout-btn:hover   { background:var(--bg-surface-hover); }

  /* Wireframe cleanup */
  .theme-wireframe .home-tile::before,
  .theme-wireframe .layout-thumb::before { display:none !important; }

</style>
</head>
<body>

<div class="viewport">

<!-- ══════════════ TOP BAR ══════════════ -->
<header class="topbar" onclick="navigateTo('career')" style="cursor:pointer">
    <div class="topbar-main">
      <div class="profile-avatar">
        <img src="rael_new.png" alt="Rael">
      </div>
      <div class="profile-info">
        <div class="profile-name">Rael</div>
      </div>
      <div class="topbar-spacer"></div>
      <div class="profile-info profile-info-right">
        <div class="stat-ticker" id="stat-ticker"></div>
      </div>
      <div class="coin-scene">
        <div class="coin-body">
          <div class="coin-edge">
            <div class="coin-edge-slice" style="transform:translateZ(-12px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(-11px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(-10px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(-9px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(-8px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(-7px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(-6px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(-5px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(-4px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(-3px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(-2px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(-1px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(0px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(1px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(2px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(3px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(4px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(5px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(6px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(7px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(8px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(9px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(10px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(11px)"></div>
            <div class="coin-edge-slice" style="transform:translateZ(12px)"></div>
          </div>
          <div class="coin-front coin-face"></div>
          <div class="coin-back coin-face"></div>
          <div class="coin-shine"></div>
        </div>
      </div>
    </div>
    <div class="xp-bar-full"><div class="xp-bar-fill" style="width:65%"></div></div>
  </header>

  <main class="content">
    <div class="content-banner" id="content-banner"></div>
    <div class="content-overlay"></div>
    <div class="page active" id="page-home">
      <div class="home-grid" id="home-grid"></div>
      <button class="home-layout-btn" onclick="openLayoutPicker()">Layouts</button>
    </div>

    <div class="page" id="page-play">
      <div class="play-layout" id="play-main-layout">
        <div class="play-main">
          <div class="play-mode-tabs" id="play-mode-tabs"></div>
          <div class="play-body">
            <div class="play-song-col" id="play-song-col"></div>
            <div class="play-right-panel" id="play-right-panel"></div>
          </div>
          <div class="play-go-bar">
            <div class="play-duration" id="play-duration">0:00</div>
            <button class="play-bar-btn" onclick="openSaveSetlist()">Save</button>
            <button class="play-go-btn" id="play-go-btn" onclick="startGame()">Start</button>
            <button class="play-bar-btn" onclick="openLoadSetlist()">Load</button>
            <div class="play-duration" id="play-song-count">0 songs</div>
          </div>
        </div>
      </div>
      <div class="play-picker" id="play-picker">
        <div class="play-picker-body">
          <div class="picker-songs-col">
            <div class="picker-filters">
              <select class="picker-filter" id="filter-genre" onchange="applyPickerFilters()">
                <option value="">All Genres</option>
                <option value="Pop">Pop</option>
                <option value="Hip-Hop">Hip-Hop</option>
                <option value="Rock">Rock</option>
                <option value="R&amp;B">R&amp;B</option>
                <option value="Country">Country</option>
                <option value="Electronic">Electronic</option>
                <option value="Latin">Latin</option>
                <option value="Indie">Indie</option>
              </select>
              <select class="picker-filter" id="filter-decade" onchange="applyPickerFilters()">
                <option value="">All Decades</option>
                <option value="2020s">2020s</option>
                <option value="2010s">2010s</option>
                <option value="2000s">2000s</option>
                <option value="90s">90s</option>
                <option value="80s">80s</option>
                <option value="Classic">Classic</option>
              </select>
              <select class="picker-filter" id="filter-duration" onchange="applyPickerFilters()">
                <option value="">Any Length</option>
                <option value="short">Under 3 min</option>
                <option value="medium">3–4 min</option>
                <option value="long">Over 4 min</option>
              </select>
              <select class="picker-filter" id="filter-sort" onchange="applyPickerFilters()">
                <option value="rank">Popularity</option>
                <option value="title">Title A–Z</option>
                <option value="artist">Artist A–Z</option>
                <option value="duration">Duration</option>
                <option value="recent">Recently Added</option>
              </select>
            </div>
            <div class="picker-grid-row">
              <div class="grid-viewport">
                <div class="grid-track" id="grid-track"></div>
              </div>
              <div class="grid-nav" id="grid-nav-right"></div>
            </div>
            <div class="picker-setlist">
              <div class="picker-setlist-header">
                <div class="play-section-header">Setlist</div>
              </div>
              <div class="picker-setlist-tiles" id="picker-setlist-tiles"></div>
              <div class="picker-setlist-nav" id="picker-setlist-nav"></div>
            </div>
          </div>
          <div class="play-picker-lb">
            <button class="lb-type-btn" id="picker-inst-btn" onclick="rotatePickerInstrument()">&#127928; Guitar</button>
            <button class="lb-type-btn" id="picker-diff-btn" onclick="rotatePickerDifficulty()">&#127922; Medium</button>
            <button class="lb-type-btn" id="lb-type-btn" onclick="rotateLbType()"><span>&#127757;</span> Worldwide</button>
            <div class="play-panel play-leaderboard">
              <div class="play-lb-list" id="play-lb-list"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="page" id="page-career">
      <div id="career-main" style="display:flex;flex-direction:column;flex:1;min-height:0">
        <div class="settings-grid">
          <div class="settings-tile career-tile" onclick="showProfilesPanel()" style="cursor:pointer"><div class="tile-info"><div class="tile-icon">&#9823;</div><div class="tile-title">Profiles</div></div></div>
          <div class="settings-tile career-tile"><div class="tile-info"><div class="tile-icon">&#9998;</div><div class="tile-title">Name</div></div></div>
          <div class="settings-tile career-tile"><div class="tile-info"><div class="tile-icon">&#9635;</div><div class="tile-title">Picture</div></div></div>
          <div class="settings-tile career-tile"><div class="tile-info"><div class="tile-icon">&#9786;</div><div class="tile-title">Avatar</div></div></div>
          <div class="settings-tile career-tile"><div class="tile-info"><div class="tile-icon">&#9673;</div><div class="tile-title">Coins</div></div></div>
          <div class="settings-tile career-tile" onclick="navigateTo('settings')" style="cursor:pointer"><div class="tile-info"><div class="tile-icon">&#9881;</div><div class="tile-title">Settings</div></div></div>
        </div>
      </div>
      <div class="profile-section" id="profile-section-career">
        <button class="back-btn" onclick="hideProfilePanel()">&#8617; Profile</button>
        <div class="profile-grid" id="profile-grid-career"></div>
      </div>
    </div>
    <div class="page" id="page-season">
      <button class="back-btn" onclick="navigateTo('home')">&#9664; Home</button>
      <div class="season-grid" id="season-grid"></div>
    </div>
    <div class="page" id="page-social"><button class="back-btn" onclick="navigateTo('home')">&#9664; Home</button><div class="section-title">Social</div></div>
    <div class="page" id="page-spaces"><button class="back-btn" onclick="navigateTo('home')">&#9664; Home</button><div class="spaces-grid" id="spaces-grid"></div></div>
    <div class="page" id="page-vault"><button class="back-btn" onclick="navigateTo('home')">&#9664; Home</button><div class="vault-grid" id="vault-grid"></div></div>
    <div class="page" id="page-store"><button class="back-btn" onclick="navigateTo('home')">&#9664; Home</button><div class="section-title">Store</div></div>
    <div class="page" id="page-settings">
      <div id="settings-main" style="display:flex;flex-direction:column;flex:1;min-height:0">
        <button class="back-btn" onclick="navigateTo('home')">&#9664; Home</button>
        <div class="settings-grid">
          <div class="settings-tile" id="themes-tile" onclick="showThemes()">
            <div class="tile-info"><div class="tile-title">Themes</div></div>
          </div>
          <div class="settings-tile" id="banners-tile" onclick="showBanners()">
            <div class="tile-info"><div class="tile-title">Banners</div></div>
          </div>
          <div class="settings-tile" id="frames-tile" onclick="showFrames()">
            <div class="tile-info"><div class="tile-title">Frames</div></div>
          </div>
          <div class="settings-tile" onclick="showTos()">
            <div class="tile-info"><div class="tile-title">Terms of Service</div></div>
          </div>
          <div class="settings-tile" onclick="showPrivacy()">
            <div class="tile-info"><div class="tile-title">Privacy Policy</div></div>
          </div>
          <div class="settings-tile">
            <div class="tile-info"><div class="tile-title">Volume Mixer</div></div>
          </div>
          <div class="settings-tile">
            <div class="tile-info"><div class="tile-title">Language</div></div>
          </div>
          <div class="settings-tile">
            <div class="tile-info"><div class="tile-title">Gameplay</div></div>
          </div>
          <div class="settings-tile">
            <div class="tile-info"><div class="tile-title">Rate Us</div></div>
          </div>
          <div class="settings-tile">
            <div class="tile-info"><div class="tile-title">Report a Bug</div></div>
          </div>
          <div class="settings-tile">
            <div class="tile-info"><div class="tile-title">Send Feedback</div></div>
          </div>
          <div class="settings-tile">
            <div class="tile-info"><div class="tile-title">Meet the Team</div></div>
          </div>
          <div class="settings-tile" style="cursor:default">
            <div class="tile-info"><div class="tile-title" style="font-size:16px;line-height:1.4">Backstage Pass<br>0.1.0 (508)</div></div>
          </div>
        </div>
      </div>
      <div class="theme-section" id="theme-section">
        <button class="back-btn" onclick="hideSettingsSub()">&#9664; Settings</button>
        <div class="theme-grid" id="theme-grid"></div>
      </div>
      <div class="banner-section" id="banner-section">
        <button class="back-btn" onclick="hideSettingsSub()">&#9664; Settings</button>
        <div class="banner-grid" id="banner-grid"></div>
      </div>
      <div class="frame-section" id="frame-section">
        <button class="back-btn" onclick="hideSettingsSub()">&#9664; Settings</button>
        <div class="frame-grid" id="frame-grid"></div>
      </div>
      <div class="legal-section" id="tos-section">
        <button class="back-btn" onclick="hideSettingsSub()">&#9664; Settings</button>
        <div class="legal-content" id="tos-content">
          <h2>Terms of Service</h2>
          <p class="legal-version">Version 1 &mdash; Effective date: 1 November 2025 | Last update: 1 November 2025</p>
          <p>If you are a user of any of our games, platforms or services (&ldquo;Services&rdquo;), these terms of service (&ldquo;Terms&rdquo;) apply between you (&ldquo;you&rdquo; or &ldquo;User&rdquo;) and us, Jamsesh Limited (&ldquo;Jamsesh&rdquo;, &ldquo;we&rdquo;, &ldquo;us&rdquo;, or &ldquo;our&rdquo;).</p>
          <p>By downloading, installing, accessing, or using the Services, you agree to be bound by these Terms. If you do not agree to these terms, do not use the Services.</p>

          <h2>1. Age Requirements and Parental Consent</h2>
          <h3>1.1 Age Restrictions</h3>
          <p>The Services are intended for users aged 13 and over. Users under the age of 16 require parental or guardian consent to use the Services.</p>
          <h3>1.2 Parental Consent for Users Under 16</h3>
          <p>If you are under 16 years of age:</p>
          <ul>
            <li>You must have your parent or legal guardian read and agree to these Terms on your behalf</li>
            <li>Your parent or guardian must create or authorise your account</li>
            <li>Your parent or guardian is responsible for your use of the Services</li>
            <li>Your parent or guardian may contact us at any time to request access to, modification of, or deletion of your personal information</li>
          </ul>
          <h3>1.3 Verification</h3>
          <p>We reserve the right to request proof of age and/or parental consent at any time. Failure to provide such proof may result in immediate suspension or termination of your account.</p>

          <h2>2. Licence Grant</h2>
          <h3>2.1 Limited Licence</h3>
          <p>Subject to your compliance with these Terms, Jamsesh grants you a limited, non-exclusive, non-transferable, non-sublicensable, revocable license to:</p>
          <ul>
            <li>Download and install the Services on compatible devices</li>
            <li>Access and use the Services for personal, non-commercial entertainment purposes</li>
          </ul>
          <h3>2.2 License Restrictions</h3>
          <p>You may NOT:</p>
          <ul>
            <li>Copy, modify, adapt, translate, or create derivative works of the Services</li>
            <li>Reverse engineer, decompile, disassemble, or attempt to discover the source code</li>
            <li>Rent, lease, sell, sublicense, distribute, or transfer the Services</li>
            <li>Remove, alter, or obscure any proprietary notices</li>
            <li>Use the Services for any commercial purpose without our express written consent</li>
            <li>Use automated systems (bots, scripts, crawlers) to access the Services</li>
            <li>Circumvent any technical limitations or security measures in the Services</li>
          </ul>

          <h2>3. User Generated Content</h2>
          <h3>3.1 Types of User Generated Content</h3>
          <p>The Services allow you to create, upload, share, and interact with various forms of content, including but not limited to:</p>
          <ul>
            <li>Custom band designs and avatars</li>
            <li>Performance recordings</li>
            <li>Sketches and drawings created using the Band Creator feature</li>
            <li>Chat messages and voice communications</li>
            <li>User profiles and customisations</li>
            <li>Any other content you create or share through the Service (collectively, &ldquo;UGC&rdquo;)</li>
          </ul>
          <h3>3.2 Ownership of UGC</h3>
          <p>You retain ownership of any intellectual property rights that you hold in your UGC. However, by creating or sharing UGC through the Services, you grant Jamsesh the licenses described below.</p>
          <h3>3.3 License Grant to Jamsesh</h3>
          <p>By using the Services to generate UGC, or submitting UGC to the Services, you grant Jamsesh a worldwide, non-exclusive, royalty-free, perpetual, irrevocable, sublicensable, and transferable license to:</p>
          <ul>
            <li>Use, reproduce, distribute, modify, adapt, publicly display, and publicly perform your UGC</li>
            <li>Create derivative works from your UGC</li>
            <li>Incorporate your UGC into the Services (now or in the future) and other Jamsesh products</li>
            <li>Use your UGC for promotional, marketing, and advertising purposes</li>
          </ul>
          <p>This license continues even if you stop using the Services.</p>
          <h3>3.4 UGC Representations and Warranties</h3>
          <p>By creating and/or submitting UGC, you represent and warrant that:</p>
          <ul>
            <li>You own or have obtained all necessary rights, licenses, and permissions for the UGC</li>
            <li>Your UGC does not infringe any third-party intellectual property rights</li>
            <li>Your UGC complies with all applicable laws and this Agreement</li>
            <li>If you are under 18, your parent or guardian has reviewed and approved your UGC</li>
          </ul>
          <h3>3.5 Prohibited Content</h3>
          <p>You agree NOT to create, upload, or share UGC that:</p>
          <ul>
            <li>Infringes intellectual property rights of others</li>
            <li>Contains unlicensed copyrighted music (outside of the licensed tracks we provide)</li>
            <li>Is illegal, harmful, threatening, abusive, harassing, defamatory, vulgar, obscene, or hateful</li>
            <li>Contains nudity, sexual content, or is otherwise inappropriate for minors</li>
            <li>Promotes violence, discrimination, or harm against individuals or groups</li>
            <li>Contains malware, viruses, or malicious code</li>
            <li>Impersonates any person or entity</li>
            <li>Violates anyone&rsquo;s privacy or publicity rights</li>
            <li>Constitutes spam or unsolicited advertising</li>
            <li>Encourages illegal activity or violates any laws</li>
          </ul>
          <h3>3.6 Content Moderation</h3>
          <p>Jamsesh reserves the right, but has no obligation, to:</p>
          <ul>
            <li>Monitor, review, and moderate all UGC</li>
            <li>Remove or refuse to publish any UGC that violates these Terms</li>
            <li>Restrict or terminate access to the Services for users who violate these content policies</li>
            <li>Cooperate with law enforcement regarding illegal content</li>
          </ul>
          <p>You use the Services at your own risk. We may record, temporarily store, and reserve the right to monitor player activities, including player voice chat, in playing Jamsesh in order to help us with player moderation. This allows us to help ensure community guidelines are being met and no inappropriate behaviour is being committed by players. Voice recordings used for moderation are retained only as long as needed to investigate and enforce our community guidelines, then deleted or de-identified.</p>
          <h3>3.7 Reporting Inappropriate Content</h3>
          <p>If you encounter UGC that violates these Terms, please report it immediately through our in-app reporting tools or by contacting team@jamsesh.co.</p>
          <h3>3.8 Special Provisions for Users Under 18</h3>
          <p>If you are under 18 years of age:</p>
          <ul>
            <li>All UGC you create or submit may be reviewed by our moderation team</li>
            <li>We may implement additional restrictions on your ability to share content publicly</li>
            <li>Your parent or guardian may request copies of or deletion of your UGC</li>
            <li>You agree not to share personal information in UGC (name, address, school, etc.)</li>
          </ul>

          <h2>4. Account Responsibilities</h2>
          <h3>4.1 Account Security</h3>
          <p>You are responsible for:</p>
          <ul>
            <li>Maintaining the confidentiality of your account credentials</li>
            <li>All activities that occur under your account</li>
            <li>Notifying us immediately of any unauthorised use</li>
          </ul>
          <h3>4.2 Accurate Information</h3>
          <p>You agree to provide accurate, current, and complete information when creating your account and to update it as necessary.</p>
          <h3>4.3 Parental Supervision for Minors</h3>
          <p>Parents and guardians of users under 16 are responsible for:</p>
          <ul>
            <li>Monitoring their child&rsquo;s use of the Service</li>
            <li>Ensuring compliance with these Terms</li>
            <li>Any charges or purchases made through the account</li>
          </ul>

          <h2>5. Virtual Items and Purchases</h2>
          <h3>5.1 Virtual Currency and Items</h3>
          <p>The Service may include virtual currency, items, or content available for purchase (&ldquo;Virtual Items&rdquo;). Virtual Items:</p>
          <ul>
            <li>Have no monetary value and cannot be redeemed for cash</li>
            <li>Are licensed, not sold, and remain the property of Jamsesh</li>
            <li>May expire and are subject to terms specified at time of purchase</li>
            <li>Are non-refundable except as required by law. Please review Meta&rsquo;s refund policies as Jamsesh may not be able to process refunds.</li>
          </ul>
          <h3>5.2 Purchases by Minors</h3>
          <p>Users under 18 must obtain parental consent before making any purchases.</p>

          <h2>6. Intellectual Property</h2>
          <h3>6.1 Jamsesh Ownership</h3>
          <p>The Service, including all content, features, functionality, software, designs, graphics, text, and trademarks (excluding User Content) are owned by Jamsesh and protected by copyright, trademark, and other intellectual property laws.</p>
          <h3>6.2 Licensed Music Content</h3>
          <p>Music tracks available in the Services are licensed from third-party rights holders. Your use of this music is limited to performance within the Services and may not be recorded or distributed outside the Services without authorisation.</p>
          <h3>6.3 Feedback</h3>
          <p>If you provide feedback, suggestions, or ideas about the Services, you grant Jamsesh an unrestricted, perpetual right to use such feedback without compensation or attribution.</p>

          <h2>7. Privacy Policy and Data Protection</h2>
          <h3>7.1 Privacy Policy</h3>
          <p>Your use of the Service is also governed by our Privacy Policy, which is incorporated into these Terms by reference. Please review our Privacy Policy to understand how we collect and use your information.</p>
          <h3>7.2 Special Protections for Children</h3>
          <p>For users under 16, we:</p>
          <ul>
            <li>Collect only the minimum necessary personal information</li>
            <li>Require verifiable parental consent for data processing</li>
            <li>Provide parents with access to their child&rsquo;s data</li>
            <li>Implement enhanced safety and privacy measures</li>
            <li>Comply with the UK General Data Protection Regulation (UK GDPR) and Children&rsquo;s Code</li>
          </ul>

          <h2>8. Code of Conduct</h2>
          <h3>8.1 Acceptable Behavior</h3>
          <p>You agree to:</p>
          <ul>
            <li>Treat other users with respect</li>
            <li>Comply with instructions from Jamsesh moderators</li>
            <li>Follow performance and community guidelines</li>
            <li>Report violations of these Terms</li>
          </ul>
          <h3>8.2 Prohibited Behaviour</h3>
          <p>You may NOT:</p>
          <ul>
            <li>Harass, bully, threaten, or intimidate other users</li>
            <li>Use offensive, discriminatory, or inappropriate language</li>
            <li>Engage in cheating or exploiting bugs</li>
            <li>Share personal information of others</li>
            <li>Disrupt the Service or other users&rsquo; experience</li>
            <li>Attempt to scam or defraud other users</li>
          </ul>
          <h3>8.3 Enforcement</h3>
          <p>Violations may result in:</p>
          <ul>
            <li>Warning or temporary suspension</li>
            <li>Content removal</li>
            <li>Permanent account termination</li>
            <li>Legal action where appropriate</li>
          </ul>

          <h2>9. Disclaimers and Limitation of Liability</h2>
          <h3>9.1 &ldquo;As Is&rdquo; Service</h3>
          <p class="legal-caps">THE SERVICES ARE PROVIDED &ldquo;AS IS&rdquo; AND &ldquo;AS AVAILABLE&rdquo; WITHOUT WARRANTIES OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, OR NON-INFRINGEMENT.</p>
          <h3>9.2 No Warranty</h3>
          <p>Jamsesh does not warrant that:</p>
          <ul>
            <li>The Services will be uninterrupted, secure, or error-free</li>
            <li>Defects will be corrected</li>
            <li>The Services are free from viruses or harmful components</li>
            <li>Results obtained from the Services will be accurate or reliable</li>
          </ul>
          <h3>9.3 Limitation of Liability</h3>
          <p class="legal-caps">TO THE MAXIMUM EXTENT PERMITTED BY LAW, JAMSESH SHALL NOT BE LIABLE FOR ANY INDIRECT, INCIDENTAL, SPECIAL, CONSEQUENTIAL, OR PUNITIVE DAMAGES, OR ANY LOSS OF PROFITS, REVENUE, DATA, OR USE, WHETHER ARISING FROM:</p>
          <ul>
            <li>Use or inability to use the Services</li>
            <li>UGC or conduct of other users</li>
            <li>Unauthorised access to your account or data</li>
            <li>Any other matter relating to the Services</li>
          </ul>
          <p class="legal-caps">IN NO EVENT SHALL JAMSESH&rsquo;S TOTAL LIABILITY EXCEED THE AMOUNT YOU PAID TO JAMSESH IN THE 12 MONTHS PRECEDING THE CLAIM, OR &pound;100, WHICHEVER IS GREATER.</p>
          <h3>9.4 UK Consumer Rights</h3>
          <p>Nothing in these Terms excludes or limits our liability for:</p>
          <ul>
            <li>Death or personal injury caused by our negligence</li>
            <li>Fraud or fraudulent misrepresentation</li>
            <li>Any other liability that cannot be excluded under English law</li>
          </ul>
          <p>If you are a consumer in the UK, you have certain legal rights. Nothing in these Terms affects those statutory rights.</p>

          <h2>10. Indemnification</h2>
          <p>You agree to indemnify, defend, and hold harmless Jamsesh, its affiliates, officers, directors, employees, and agents from any claims, liabilities, damages, losses, and expenses (including legal fees) arising from:</p>
          <ul>
            <li>Your use of the Services</li>
            <li>Your UGC</li>
            <li>Your violation of these Terms</li>
            <li>Your violation of any rights of another party</li>
            <li>Any activity under your account</li>
          </ul>
          <p>If you are a consumer in the UK, this indemnification provision applies only to the extent permitted by law.</p>

          <h2>11. Termination</h2>
          <h3>11.1 Termination by You</h3>
          <p>You may stop using the Services and delete your account at any time by contacting team@jamsesh.co or using in-app account deletion features.</p>
          <h3>11.2 Termination by Jamsesh</h3>
          <p>We may suspend or terminate your access to the Services immediately, without notice, for:</p>
          <ul>
            <li>Violation of these Terms</li>
            <li>Illegal activity</li>
            <li>Fraudulent conduct</li>
            <li>Inappropriate conduct or any potential or actual harm caused to other users</li>
            <li>Extended periods of inactivity</li>
            <li>At our discretion for any other reason</li>
          </ul>
          <h3>11.3 Effects of Termination</h3>
          <p>Upon termination:</p>
          <ul>
            <li>Your license to use the Services immediately ends</li>
            <li>You must cease all use of the Services</li>
            <li>Your UGC may be deleted (subject to our data retention obligations)</li>
            <li>Provisions of these Terms that by their nature should survive will continue (including ownership, disclaimers, limitations of liability, and governing law)</li>
          </ul>

          <h2>12. Modifications to the Services and these Terms</h2>
          <h3>12.1 Service Changes</h3>
          <p>Jamsesh reserves the right to modify, suspend, or discontinue the Services (or any part thereof) at any time, with or without notice. We shall not be liable to you or any third party for any such modification, suspension, or discontinuation.</p>
          <h3>12.2 Agreement Changes</h3>
          <p>We may update these Terms from time to time. We will notify you of material changes by:</p>
          <ul>
            <li>Posting the updated Terms in the Services</li>
            <li>Sending an email notification (if you have provided an email address)</li>
            <li>Displaying a prominent notice in the Services</li>
          </ul>
          <p>Your continued use of the Services after such notice constitutes acceptance of the updated Terms.</p>

          <h2>13. Dispute Resolution</h2>
          <h3>13.1 Informal Resolution</h3>
          <p>If you have a concern or dispute, please contact us first at team@jamsesh.co. We will attempt to resolve disputes informally.</p>
          <h3>13.2 Governing Law</h3>
          <p>This Agreement shall be governed by and construed in accordance with the laws of England and Wales, without regard to conflict of law principles.</p>
          <h3>13.3 Jurisdiction</h3>
          <p>You agree that any dispute arising from these Terms or your use of the Services shall be subject to the exclusive jurisdiction of the courts of England and Wales.</p>
          <h3>13.4 Consumer Rights</h3>
          <p>If you are a consumer residing in the UK, nothing in this section affects your rights to rely on mandatory provisions of consumer protection law in your country of residence.</p>

          <h2>14. General Provisions</h2>
          <p>These Terms, together with our Privacy Policy, constitutes the entire agreement between you and Jamsesh regarding the Services.</p>
          <p>If any provision of these Terms is held to be invalid or unenforceable, the remaining provisions shall continue in full force and effect.</p>
          <p>No waiver of any provision of these Terms shall be deemed a further or continuing waiver of such term or any other term.</p>
          <p>You may not assign or transfer these Terms or any rights hereunder. Jamsesh may assign these Terms without restriction.</p>
          <p>These Terms do not confer any rights on third parties, except that third-party licensors of music content and platform providers (e.g., Meta) are intended beneficiaries with respect to provisions protecting their rights.</p>
          <p>Jamsesh shall not be liable for any failure to perform due to circumstances beyond its reasonable control.</p>
          <h3>14.7 Contact Information</h3>
          <p>For questions about these Terms or to exercise your rights, contact us on Discord or via email at:</p>
          <p>Jamsesh<br>Email: team@jamsesh.co</p>

          <h2>15. Special Notice for Parents and Guardians</h2>
          <p>We take the safety and privacy of young users seriously. Parents and guardians of users under 16 should:</p>
          <ul>
            <li>Review these Terms and our Privacy Policy carefully</li>
            <li>Discuss online safety with their children</li>
            <li>Monitor their child&rsquo;s use of the Services</li>
            <li>Use parental control features available in VR platforms</li>
            <li>Contact us immediately with any concerns</li>
          </ul>
          <p>Parents may request:</p>
          <ul>
            <li>Access to their child&rsquo;s account information</li>
            <li>Deletion of their child&rsquo;s account and data</li>
            <li>Restrictions on their child&rsquo;s account features</li>
            <li>Information about data we collect from their child</li>
          </ul>
          <p>To make such requests, contact us at team@jamsesh.co with proof of parental authority.</p>
          <p class="legal-caps">BY USING THE SERVICE, YOU ACKNOWLEDGE THAT YOU HAVE READ, UNDERSTOOD, AND AGREE TO BE BOUND BY THIS AGREEMENT.</p>
          <p class="legal-caps">IF YOU ARE UNDER 16, YOUR PARENT OR GUARDIAN MUST ALSO AGREE TO THIS AGREEMENT ON YOUR BEHALF.</p>
        </div>
      </div>
      <div class="legal-section" id="pp-section">
        <button class="back-btn" onclick="hideSettingsSub()">&#9664; Settings</button>
        <div class="legal-content" id="pp-content">
          <h2>Privacy Policy</h2>
          <p class="legal-version">Version 1 &mdash; Effective date: 4 September 2025 | Last update: 4 September 2025</p>

          <h2>1. Introduction</h2>
          <p>This Privacy Policy (&ldquo;Policy&rdquo;) explains how we collect, use, share, and protect personal information when you play Jamsesh games or use any of our services. &ldquo;Personal information&rdquo; is any information that relates to and is capable of being used to identify you, and includes any user-generated content (&ldquo;UGC&rdquo;) that you create on Jamsesh. This Policy applies to all players of our games and services.</p>
          <p>Jamsesh Limited is a company based in the UK.</p>
          <p>If you are under 18 years old, you can take a look at how we handle your personal information in Section 9.</p>

          <h2>2. What We Collect</h2>
          <h3>Account Information</h3>
          <p>Identifying details in relation to the account that you create when you play any of our games, such as full name, username, email address, password, profile details, date of birth.</p>
          <h3>Gameplay Data</h3>
          <p>Scores, progress, achievements, and in-game preferences; game session info, levels played or created, time spent, preferences, crash reports.</p>
          <h3>Device Information</h3>
          <p>Hardware identifiers, operating system, VR headset type, crash reports, performance logs.</p>
          <h3>Payment Information</h3>
          <p>If applicable, billing details and purchase history (processed securely via third-party payment providers).</p>
          <h3>Support Requests and Surveys</h3>
          <p>Messages or inquiries you send to us (e.g., via customer support or feedback forms); details you share when leaving feedback or responding to research or surveys.</p>
          <h3>User Generated Content</h3>
          <p>Any content you generate, develop or upload (like player-created content, player performances, text/chat, voice recordings, images, audio, video, game mods, avatars, messages).</p>
          <h3>Third Party Information</h3>
          <p>If you link a third-party account (e.g., Steam, Discord), we receive data permitted under that platform&rsquo;s policy.</p>

          <h2>3. How We Use Your Information</h2>
          <h3>Provide and Improve Our Games and Services</h3>
          <p>Deliver gameplay experiences, manage accounts, provide customer support, and enhance our games based on user feedback and data.</p>
          <h3>Personalise Experiences</h3>
          <p>Customise content, recommend features, and tailor experiences to your preferences and gameplay style.</p>
          <h3>Communication</h3>
          <p>Send updates about our games, respond to inquiries, and provide customer support.</p>
          <h3>Safety and Security</h3>
          <p>Detect and prevent fraud, abuse, and other harmful activities; enforce our terms of service.</p>
          <h3>Analytics and Research</h3>
          <p>Understand how our games are used, identify trends, and improve our services through data analysis.</p>
          <h3>Legal, Regulatory and Compliance</h3>
          <p>Comply with applicable laws, regulations, and legal processes.</p>

          <h2>4. How We Share Your Information</h2>
          <p>We may share your personal information in the following circumstances:</p>
          <ul>
            <li><strong>Service providers:</strong> Third-party companies that help us provide our services (e.g., cloud hosting, payment processing, analytics).</li>
            <li><strong>Business partners:</strong> Platform holders (e.g., Steam, Meta) where our games are distributed, subject to their privacy policies.</li>
            <li><strong>Legal requirements:</strong> When required by law, court order, or to protect our rights and safety.</li>
            <li><strong>Business transfers:</strong> In connection with mergers, acquisitions, or asset sales.</li>
            <li><strong>With your consent:</strong> When you explicitly agree to share your information for specific purposes.</li>
          </ul>

          <h2>5. Data Retention</h2>
          <p>We retain your personal information for as long as necessary to provide our services and fulfill the purposes outlined in this Policy. Specific retention periods depend on the type of information and our legal obligations. You can request deletion of your account and associated data at any time.</p>

          <h2>6. Your Rights and Choices</h2>
          <p>Depending on your location, you may have the following rights:</p>
          <ul>
            <li><strong>Access:</strong> Request a copy of the personal information we hold about you.</li>
            <li><strong>Correction:</strong> Ask us to correct inaccurate or incomplete information.</li>
            <li><strong>Deletion:</strong> Request deletion of your personal information.</li>
            <li><strong>Portability:</strong> Request a copy of your data in a structured format.</li>
            <li><strong>Objection:</strong> Object to certain types of processing.</li>
            <li><strong>Restriction:</strong> Request that we limit how we use your information.</li>
          </ul>
          <p>To exercise these rights, please contact us at team@jamsesh.co</p>

          <h2>7. Security</h2>
          <p>We implement appropriate technical and organisational measures to protect your personal information against unauthorised access, alteration, disclosure, or destruction. However, no method of transmission over the internet or electronic storage is completely secure.</p>

          <h2>8. International Transfers</h2>
          <p>Your personal information may be processed and stored in countries outside your country of residence. We ensure appropriate safeguards are in place to protect your information in accordance with this Policy and applicable data protection laws.</p>

          <h2>9. Children&rsquo;s Privacy</h2>
          <p>We take special care to protect children&rsquo;s privacy. If you are under 18, we may collect limited information with parental consent where required by law. Parents can review, modify, or delete their child&rsquo;s information by contacting us.</p>

          <h2>10. Changes to This Policy</h2>
          <p>We may update this Privacy Policy from time to time. We will notify you of significant changes by posting the updated Policy on our website and updating the effective date. Your continued use of our services constitutes acceptance of the updated Policy.</p>

          <h2>11. Contact Us</h2>
          <p>If you have questions about this Privacy Policy or our privacy practices, please contact us at:</p>
          <p>Email: team@jamsesh.co<br>Company: Jamsesh Limited<br>Location: London, United Kingdom</p>
        </div>
      </div>
    </div>
  </main>

  <nav class="navbar">
    <div class="navbar-banner" id="navbar-banner"></div>
    <div class="navbar-overlay"></div>
    <div class="nav-item active" data-page="home" onclick="navigateTo('home')">
      <span class="nav-icon"><svg viewBox="0 0 24 24"><path d="M3 12.5l9-9 9 9M5 11v8a1 1 0 001 1h4v-5h4v5h4a1 1 0 001-1v-8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
      <span class="nav-label">Home</span>
    </div>
    <div class="nav-item" data-page="social" onclick="navigateTo('social')">
      <span class="nav-icon"><svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 3-1.34 3-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05C16.19 13.89 17 15.02 17 16.5V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" fill="currentColor"/></svg></span>
      <span class="nav-label">Social</span>
    </div>
    <div class="nav-item" data-page="spaces" onclick="navigateTo('spaces')">
      <span class="nav-icon"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z" fill="currentColor"/></svg></span>
      <span class="nav-label">Spaces</span>
    </div>
    <div class="nav-item" data-page="play" onclick="navigateTo('play')">
      <span class="nav-icon"><svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z" fill="currentColor"/></svg></span>
      <span class="nav-label">Play</span>
    </div>
    <div class="nav-item" data-page="vault" onclick="navigateTo('vault')">
      <span class="nav-icon"><svg viewBox="0 0 24 24"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1v2z" fill="currentColor"/></svg></span>
      <span class="nav-label">Vault</span>
    </div>
    <div class="nav-item" data-page="store" onclick="navigateTo('store')">
      <span class="nav-icon"><svg viewBox="0 0 24 24"><path d="M20 4H4v2h16V4zm1 10v-2l-1-5H4l-1 5v2h1v6h10v-6h4v6h2v-6h1zm-9 4H6v-4h6v4z" fill="currentColor"/></svg></span>
      <span class="nav-label">Store</span>
    </div>
    <div class="nav-item" data-page="season" onclick="navigateTo('season')">
      <span class="nav-icon"><svg viewBox="0 0 24 24"><path d="M19 5h-2V3H7v2H5c-1.1 0-2 .9-2 2v1c0 2.55 1.92 4.63 4.39 4.94.63 1.5 1.98 2.63 3.61 2.96V19H7v2h10v-2h-4v-3.1c1.63-.33 2.98-1.46 3.61-2.96C19.08 12.63 21 10.55 21 8V7c0-1.1-.9-2-2-2zM5 8V7h2v3.82C5.84 10.4 5 9.3 5 8zm14 0c0 1.3-.84 2.4-2 2.82V7h2v1z" fill="currentColor"/></svg></span>
      <span class="nav-label">Season</span>
    </div>
  </nav>

<div class="purchase-overlay" id="purchase-overlay" onclick="closePurchasePopup(event)">
  <div class="purchase-popup" onclick="event.stopPropagation()" style="position:relative">
    <button class="popup-close-btn" onclick="closePurchasePopup()">&#10005;</button>
    <div class="purchase-preview" id="purchase-preview"></div>
    <div class="purchase-title" id="purchase-title"></div>
    <div class="purchase-cost" id="purchase-cost"></div>
    <div class="purchase-balance" id="purchase-balance"></div>
    <div class="purchase-buttons">
      <button class="purchase-btn purchase-btn-cancel" onclick="closePurchasePopup()">Cancel</button>
      <button class="purchase-btn purchase-btn-confirm" id="purchase-confirm-btn" onclick="confirmPurchase()">Unlock</button>
    </div>
  </div>
</div>

<div class="solo-popup-overlay" id="solo-popup-overlay" onclick="closeSoloPopup()">
  <div class="solo-popup" id="solo-popup" onclick="event.stopPropagation()"></div>
</div>

<div class="loadout-overlay" id="loadout-overlay" onclick="closeLoadoutPopup(event)">
  <div class="loadout-popup" id="loadout-popup" onclick="event.stopPropagation()"></div>
</div>

<div class="save-overlay" id="save-overlay" onclick="closeSaveOverlay(event)">
  <div class="save-popup" onclick="event.stopPropagation()" style="position:relative">
    <button class="popup-close-btn" onclick="closeSaveOverlay()">&#10005;</button>
    <h2>Save Setlist</h2>
    <input class="save-input" id="save-setlist-input" type="text" readonly>
    <div class="keyboard">
      <div class="keyboard-row">
        <button class="key" onclick="onScreenKey('Q')">Q</button>
        <button class="key" onclick="onScreenKey('W')">W</button>
        <button class="key" onclick="onScreenKey('E')">E</button>
        <button class="key" onclick="onScreenKey('R')">R</button>
        <button class="key" onclick="onScreenKey('T')">T</button>
        <button class="key" onclick="onScreenKey('Y')">Y</button>
        <button class="key" onclick="onScreenKey('U')">U</button>
        <button class="key" onclick="onScreenKey('I')">I</button>
        <button class="key" onclick="onScreenKey('O')">O</button>
        <button class="key" onclick="onScreenKey('P')">P</button>
      </div>
      <div class="keyboard-row">
        <button class="key" onclick="onScreenKey('A')">A</button>
        <button class="key" onclick="onScreenKey('S')">S</button>
        <button class="key" onclick="onScreenKey('D')">D</button>
        <button class="key" onclick="onScreenKey('F')">F</button>
        <button class="key" onclick="onScreenKey('G')">G</button>
        <button class="key" onclick="onScreenKey('H')">H</button>
        <button class="key" onclick="onScreenKey('J')">J</button>
        <button class="key" onclick="onScreenKey('K')">K</button>
        <button class="key" onclick="onScreenKey('L')">L</button>
      </div>
      <div class="keyboard-row">
        <button class="key" onclick="onScreenKey('Z')">Z</button>
        <button class="key" onclick="onScreenKey('X')">X</button>
        <button class="key" onclick="onScreenKey('V')">V</button>
        <button class="key" onclick="onScreenKey('C')">C</button>
        <button class="key" onclick="onScreenKey('B')">B</button>
        <button class="key" onclick="onScreenKey('N')">N</button>
        <button class="key" onclick="onScreenKey('M')">M</button>
        <button class="key key-wide" onclick="onScreenKey('backspace')">&#9003;</button>
      </div>
      <div class="keyboard-row">
        <button class="key key-wide" onclick="onScreenKey(' ')">Space</button>
        <button class="key key-wide" onclick="onScreenKey('clear')">Clear</button>
      </div>
    </div>
    <div class="save-buttons">
      <button class="save-btn-cancel" onclick="closeSaveOverlay()">Cancel</button>
      <button class="save-btn-confirm" onclick="confirmSaveSetlist()">Save</button>
    </div>
  </div>
</div>

<div class="load-overlay" id="load-overlay" onclick="closeLoadOverlay(event)">
  <div class="load-popup" onclick="event.stopPropagation()">
    <h2>Load Setlist</h2>
    <div class="load-list" id="load-list"></div>
    <button class="load-close-btn" onclick="closeLoadOverlay()">Close</button>
  </div>
</div>

<div class="layout-overlay" id="layout-overlay" onclick="closeLayoutPicker(event)">
  <div class="layout-popup" onclick="event.stopPropagation()">
    <button class="popup-close-btn" onclick="closeLayoutPicker()">&#10005;</button>
    <div class="layout-title">Choose Layout</div>
    <div class="layout-count" id="layout-count"></div>
    <div class="layout-browser" id="layout-browser"></div>
  </div>
</div>

</div><!-- /viewport -->

<script>
// ── Vuplex Bridge ──────────────────────────────────────
function sendToUnity(type, data) {
  var msg = JSON.stringify({ type: type, data: data });
  if (window.vuplex) {
    window.vuplex.postMessage(msg);
  } else {
    console.log('[Jamsesh→Unity]', msg);
  }
}

function initVuplexListener() {
  function attach() {
    window.vuplex.addEventListener('message', function(event) {
      try { handleUnityMessage(JSON.parse(event.data)); }
      catch(e) { console.warn('Failed to parse Unity message:', e); }
    });
  }
  if (window.vuplex) attach();
  else window.addEventListener('vuplexready', attach);
}

function handleUnityMessage(msg) {
  switch(msg.type) {
    case 'updateProfile': updateProfile(msg.data); break;
    case 'navigate': navigateTo(msg.data); break;
    default: console.log('[Unity→Jamsesh] Unhandled:', msg);
  }
}

function updateProfile(data) {
  if (data.name) document.querySelector('.profile-name').textContent = data.name;
  if (data.level != null) document.querySelector('.level-badge').textContent = data.level;
  if (data.xp != null && data.xpMax != null) {
    var pct = Math.min(100, Math.round((data.xp / data.xpMax) * 100));
    document.querySelector('.xp-bar-fill').style.width = pct + '%';
  }
  if (data.notes != null) document.querySelectorAll('.currency')[0].querySelector('span').textContent = data.notes.toLocaleString();
  if (data.coins != null) document.querySelectorAll('.currency')[1].querySelector('span').textContent = data.coins.toLocaleString();
}

// ── Navigation ─────────────────────────────────────────
function navigateTo(pageName) {
  var pages = document.querySelectorAll('.page');
  for (var i = 0; i < pages.length; i++) pages[i].classList.remove('active');
  var target = document.getElementById('page-' + pageName);
  if (target) target.classList.add('active');

  var navItems = document.querySelectorAll('.nav-item');
  for (var i = 0; i < navItems.length; i++) {
    navItems[i].classList.remove('active');
    if (navItems[i].getAttribute('data-page') === pageName) navItems[i].classList.add('active');
  }

  // Reset sub-sections
  hideSettingsSub();
  resetPlayPicker();

  // Grid nav always hidden by default (sub-sections show it as needed)
  var gridNavs = document.querySelectorAll('.grid-nav');
  for (var i = 0; i < gridNavs.length; i++) gridNavs[i].style.display = 'none';

  sendToUnity('navigate', pageName);
}

// ── Song Grid ──────────────────────────────────────────
var currentPage = 0;
var totalPages = 0;
var SONGS_PER_PAGE = 20;
var pageHeight = 0;

function buildNavButtons(container, id) {
  container.innerHTML = '';

  // Top of list
  var top = document.createElement('button');
  top.className = 'grid-nav-btn';
  top.innerHTML = '<span>&#9650;</span><span>&#9650;</span>';
  top.onclick = function() { goToPage(0); };
  top.id = id + '-top';
  container.appendChild(top);

  // Up one page
  var prev = document.createElement('button');
  prev.className = 'grid-nav-btn';
  prev.innerHTML = '&#9650;';
  prev.onclick = function() { gridPage(-1); };
  prev.id = id + '-prev';
  container.appendChild(prev);

  // Down one page
  var next = document.createElement('button');
  next.className = 'grid-nav-btn';
  next.innerHTML = '&#9660;';
  next.onclick = function() { gridPage(1); };
  next.id = id + '-next';
  container.appendChild(next);

  // Bottom of list
  var bottom = document.createElement('button');
  bottom.className = 'grid-nav-btn';
  bottom.innerHTML = '<span>&#9660;</span><span>&#9660;</span>';
  bottom.onclick = function() { goToPage(totalPages - 1); };
  bottom.id = id + '-bottom';
  container.appendChild(bottom);
}

function buildGrid(songs) {
  var track = document.getElementById('grid-track');
  track.innerHTML = '';
  totalPages = Math.ceil(songs.length / SONGS_PER_PAGE);

  for (var p = 0; p < totalPages; p++) {
    var page = document.createElement('div');
    page.className = 'grid-page';
    var start = p * SONGS_PER_PAGE;
    var end = Math.min(start + SONGS_PER_PAGE, songs.length);

    for (var i = start; i < end; i++) {
      var song = songs[i];
      var tile = document.createElement('div');
      tile.className = 'song-tile';
      tile.onclick = (function(s) {
        return function() { selectPickerSong(s, this); };
      })(song);
      var dm = Math.floor(song.duration / 60);
      var ds = song.duration % 60;
      var durTxt = dm + ':' + (ds < 10 ? '0' : '') + ds;
      tile.innerHTML =
        '<img src="' + song.file + '" alt="" loading="lazy">' +
        '<span class="tile-rank">#' + song.rank + '</span>' +
        '<div class="tile-info">' +
          '<div class="tile-title">' + song.title + '</div>' +
          '<div class="tile-artist">' + song.artist + '</div>' +
          '<div class="tile-meta"><span>' + durTxt + '</span><span>' + song.bpm + ' BPM</span></div>' +
        '</div>' +
        '<div class="song-tile-actions">' +
          '<button class="song-tile-btn song-tile-preview">&#9654;</button>' +
          '<button class="song-tile-btn song-tile-add">+</button>' +
        '</div>';
      (function(s, t) {
        t.querySelector('.song-tile-preview').onclick = function(e) {
          e.stopPropagation();
          sendToUnity('previewSong', s.title);
        };
        t.querySelector('.song-tile-add').onclick = function(e) {
          e.stopPropagation();
          addSongToSetlist(s);
        };
      })(song, tile);
      page.appendChild(tile);
    }
    track.appendChild(page);
  }

  // Page height will be measured when picker is first opened
  buildNavButtons(document.getElementById('grid-nav-right'), 'right');
  updateNavState();
}

function goToPage(idx) {
  if (idx < 0 || idx >= totalPages) return;
  currentPage = idx;
  document.getElementById('grid-track').style.transform = 'translateY(-' + (currentPage * pageHeight) + 'px)';
  updateNavState();
}

function gridPage(dir) { goToPage(currentPage + dir); }

function updateNavState() {
  var navs = document.querySelectorAll('.grid-nav');
  for (var n = 0; n < navs.length; n++) {
    var atTop = (currentPage === 0);
    var atBottom = (currentPage === totalPages - 1);
    var top = navs[n].querySelector('[id$="-top"]');
    var prev = navs[n].querySelector('[id$="-prev"]');
    var next = navs[n].querySelector('[id$="-next"]');
    var bottom = navs[n].querySelector('[id$="-bottom"]');
    if (top) top.disabled = atTop;
    if (prev) prev.disabled = atTop;
    if (next) next.disabled = atBottom;
    if (bottom) bottom.disabled = atBottom;
  }
}

// ── Spaces Grid ─────────────────────────────────────────
var spaces = [
  {name:'Neon Stadium',     desc:'80,000 capacity arena',   file:'spaces/001.jpg'},
  {name:'Desert Festival',  desc:'Open air desert stage',   file:'spaces/002.jpg'},
  {name:'Underground Club', desc:'Intimate basement venue',  file:'spaces/003.jpg'},
  {name:'Rooftop Lounge',   desc:'City skyline views',      file:'spaces/004.jpg'},
  {name:'Jazz Basement',    desc:'Smoky speakeasy vibe',    file:'spaces/005.jpg'},
  {name:'Beach Stage',      desc:'Sunset oceanfront',       file:'spaces/006.jpg'},
  {name:'Arena Bowl',       desc:'Championship venue',      file:'spaces/007.jpg'},
  {name:'Forest Rave',      desc:'Deep woods party',        file:'spaces/008.jpg'},
  {name:'Vinyl Cafe',       desc:'Cozy record bar',         file:'spaces/009.jpg'},
  {name:'Warehouse Party',  desc:'Raw industrial space',    file:'spaces/010.jpg'},
  {name:'Opera House',      desc:'Grand classical hall',    file:'spaces/011.jpg'},
  {name:'Street Corner',    desc:'Open mic busking spot',   file:'spaces/012.jpg'},
  {name:'Skyline Terrace',  desc:'Penthouse party deck',    file:'spaces/013.jpg'},
  {name:'Retro Arcade',     desc:'80s synthwave den',       file:'spaces/014.jpg'},
  {name:'Ice Palace',       desc:'Frozen crystal stage',    file:'spaces/015.jpg'},
  {name:'Tropical Resort',  desc:'Poolside paradise',       file:'spaces/016.jpg'},
  {name:'Gothic Cathedral', desc:'Reverb-soaked stone',     file:'spaces/017.jpg'},
  {name:'Cyberpunk Alley',  desc:'Neon-lit back street',    file:'spaces/018.jpg'},
  {name:'Mountain Amp',     desc:'Alpine amphitheater',     file:'spaces/019.jpg'},
  {name:'Submarine Lounge', desc:'Deep sea listening room', file:'spaces/020.jpg'},
  {name:'Space Station',    desc:'Zero gravity club',       file:'spaces/021.jpg'},
  {name:'Pirate Ship',      desc:'High seas shanty deck',   file:'spaces/022.jpg'},
  {name:'Enchanted Garden', desc:'Fairy-lit grove',         file:'spaces/023.jpg'},
  {name:'Volcano Stage',    desc:'Molten rock arena',       file:'spaces/024.jpg'},
  {name:'Crystal Cavern',   desc:'Glowing gem grotto',      file:'spaces/025.jpg'}
];

function buildSpacesGrid() {
  var grid = document.getElementById('spaces-grid');
  grid.innerHTML = '';
  for (var i = 0; i < spaces.length; i++) {
    var s = spaces[i];
    var tile = document.createElement('div');
    tile.className = 'space-tile';
    tile.onclick = (function(space) {
      return function() { sendToUnity('selectSpace', space.name); };
    })(s);
    tile.innerHTML =
      '<img src="' + s.file + '" alt="" loading="lazy">' +
      '<div class="tile-info">' +
        '<div class="tile-title">' + s.name + '</div>' +
        '<div class="tile-artist">' + s.desc + '</div>' +
      '</div>';
    grid.appendChild(tile);
  }
}

// ── Play Panel ──────────────────────────────────────────
var allSongs = [];
var setlist = [];
var selectedInstrument = 'guitar';
var selectedDifficulty = 'medium';
var playMode = 'solo';
var songInstruments = {};
var songDiffs = {};
var songSpaces = {};
var savedSetlists = [];
var setlistCounter = 1;
var defaultIconStyle = 'position:absolute;bottom:0;right:0;height:80%;opacity:0.3;pointer-events:none;object-fit:contain';

var spaceCategories = [
  {id:'stage', label:'Stage', options:[
    {id:'classic',   label:'Classic',   desc:'Traditional concert stage',  bg:'#1e3a5f'},
    {id:'arena',     label:'Arena',     desc:'Massive stadium platform',   bg:'#4a1942'},
    {id:'intimate',  label:'Intimate',  desc:'Small club feel',            bg:'#2d1b4e'},
    {id:'festival',  label:'Festival',  desc:'Open air main stage',        bg:'#1b4332'}
  ]},
  {id:'environment', label:'Environment', options:[
    {id:'city',      label:'City',      desc:'Urban skyline backdrop',     bg:'#1a1a3e'},
    {id:'nature',    label:'Nature',    desc:'Forests and mountains',      bg:'#14532d'},
    {id:'space',     label:'Space',     desc:'Cosmic starfield',           bg:'#0f172a'},
    {id:'fantasy',   label:'Fantasy',   desc:'Otherworldly dreamscape',    bg:'#4a1d6a'}
  ]},
  {id:'crowd', label:'Crowd', options:[
    {id:'packed',    label:'Packed',    desc:'Sold-out wall to wall',      bg:'#7c2d12'},
    {id:'moderate',  label:'Moderate',  desc:'Lively but room to move',    bg:'#713f12'},
    {id:'sparse',    label:'Sparse',    desc:'Small dedicated fans',       bg:'#1c4532'},
    {id:'none',      label:'Empty',     desc:'Just you and the music',     bg:'#1e293b'}
  ]},
  {id:'effects', label:'Stage Effects', options:[
    {id:'pyro',      label:'Pyro',      desc:'Flames and fireworks',       bg:'#9a3412'},
    {id:'lasers',    label:'Lasers',    desc:'Beams and light show',       bg:'#1e40af'},
    {id:'fog',       label:'Fog',       desc:'Haze and atmosphere',        bg:'#374151'},
    {id:'minimal',   label:'Minimal',   desc:'Clean and simple',           bg:'#1e293b'}
  ]}
];

var spaceDefaults = {stage:'classic', environment:'city', crowd:'packed', effects:'pyro'};

var instruments = [
  {id:'guitar', label:'Guitar', bg:'#b45309', desc:'Lead melodies and riffs', icon:'instruments/guitar.png', iconStyle:'position:absolute;bottom:-20%;right:-25%;height:160%;opacity:0.3;pointer-events:none;object-fit:contain;transform:rotate(-30deg)'},
  {id:'keys',   label:'Keys',   bg:'#1a1a4e', desc:'Chords, synths and piano', icon:'instruments/keys.png'},
  {id:'drums',  label:'Drums',  bg:'#991b1b', desc:'Keep the rhythm going', icon:'instruments/drums.png', iconStyle:'position:absolute;bottom:-60%;right:-15%;height:120%;opacity:0.3;pointer-events:none;object-fit:contain'},
  {id:'vocals', label:'Vocals', bg:'#6b21a8', desc:'Sing along to the lyrics', icon:'instruments/vocals.png', iconStyle:'position:absolute;bottom:-85%;right:-25%;height:150%;opacity:0.3;pointer-events:none;object-fit:contain'},
  {id:'bass',   label:'Bass',   bg:'#0e7490', desc:'Hold down the low end', icon:'instruments/bass.png', iconStyle:'position:absolute;bottom:-20%;right:-20%;height:160%;opacity:0.3;pointer-events:none;object-fit:contain;transform:rotate(-30deg)'}
];

// lobbyPlayers uses np plates defined below (initialized in initLobbyPlates)
var lobbyPlayers = [
  {name:'xShredMaster',  avatar:'art/001.jpg', plate:null, plateClass:null,            instrument:'guitar', difficulty:'expert', ready:true},
  {name:'BeatDropQueen', avatar:'art/002.jpg', plate:null, plateClass:'plate-holo',    instrument:'drums',  difficulty:'hard',   ready:true},
  {name:'NeonRiff',      avatar:'art/003.jpg', plate:null, plateClass:null,            instrument:'guitar', difficulty:'medium', ready:false},
  {name:'AxelStorm',     avatar:'art/004.jpg', plate:null, plateClass:null,            instrument:'keys',   difficulty:'expert', ready:true},
  {name:'VoxHunter',     avatar:'art/006.jpg', plate:null, plateClass:null,            instrument:'vocals', difficulty:'hard',   ready:true},
  {name:'FretBoss',      avatar:'art/007.jpg', plate:null, plateClass:'plate-radiate', instrument:'guitar', difficulty:'expert', ready:true},
  {name:'SynthWave99',   avatar:'art/008.jpg', plate:null, plateClass:null,            instrument:'keys',   difficulty:'medium', ready:false},
  {name:'PickSlinger',   avatar:'art/009.jpg', plate:null, plateClass:null,            instrument:'guitar', difficulty:'easy',   ready:true},
  {name:'CrashKid',      avatar:'art/011.jpg', plate:null, plateClass:null,            instrument:'drums',  difficulty:'hard',   ready:false}
];

var difficulties = [
  {id:'easy',   label:'Easy',   bg:'linear-gradient(135deg, #064e3b 0%, #059669 50%, #34d399 100%)', desc:'Relaxed pace, fewer notes'},
  {id:'medium', label:'Medium', bg:'linear-gradient(135deg, #713f12 0%, #ca8a04 50%, #facc15 100%)', desc:'A balanced challenge'},
  {id:'hard',   label:'Hard',   bg:'linear-gradient(135deg, #7c2d12 0%, #ea580c 50%, #fb923c 100%)', desc:'Fast patterns, more notes'},
  {id:'expert', label:'Expert', bg:'linear-gradient(135deg, #450a0a 0%, #dc2626 50%, #f87171 100%)', desc:'Full song, no mercy'}
];

function plateImg(file) {
  return 'linear-gradient(rgba(0,0,0,0.3),rgba(0,0,0,0.3)),url(plates/' + file + ')';
}

var np = {
  galaxy:     plateImg('galaxy.jpg'),
  bamboo:     plateImg('bamboo.jpg'),
  garden:     plateImg('garden.jpg'),
  flames:     plateImg('flames.jpg'),
  drums:      plateImg('drums.jpg'),
  microphone: plateImg('microphone.jpg'),
  kpop:       plateImg('kpop.jpg'),
  sakura:
    'radial-gradient(8px 8px at 15% 30%, rgba(255,150,200,0.3), transparent),' +
    'radial-gradient(6px 6px at 45% 70%, rgba(255,160,210,0.25), transparent),' +
    'radial-gradient(10px 10px at 75% 25%, rgba(255,140,190,0.3), transparent),' +
    'radial-gradient(7px 7px at 90% 60%, rgba(255,170,220,0.2), transparent),' +
    'linear-gradient(135deg, #1a0815 0%, #2a1025 30%, #3a1535 50%, #2a1025 70%, #1a0815 100%)'
};

var swapTargetIdx = -1;

var diffLevels = ['easy','medium','hard','expert'];
var diffColors = {easy:'#059669', medium:'#ca8a04', hard:'#ea580c', expert:'#dc2626'};

// ── Mode Tabs ──────────────────────────────────────────
function buildModeTabs() {
  var container = document.getElementById('play-mode-tabs');
  container.innerHTML = '';
  var modes = ['Solo', 'Co-op', 'Battle'];
  var modeIds = ['solo', 'coop', 'battle'];
  for (var i = 0; i < modes.length; i++) {
    var btn = document.createElement('button');
    btn.className = 'play-mode-tab' + (modeIds[i] === playMode ? ' active' : '');
    btn.textContent = modes[i];
    btn.onclick = (function(id) { return function() { setPlayMode(id); }; })(modeIds[i]);
    container.appendChild(btn);
  }
}

function setPlayMode(mode) {
  playMode = mode;
  buildModeTabs();
  buildRightPanel();
  sendToUnity('playMode', mode);
}

// ── Song Column ────────────────────────────────────────
function buildSongColumn() {
  var col = document.getElementById('play-song-col');
  col.innerHTML = '';
  for (var i = 0; i < setlist.length; i++) {
    if (!setlist[i]) continue;
    var slot = document.createElement('div');
    slot.className = 'play-song-slot';
    var pos = document.createElement('div');
    pos.className = 'play-song-pos';
    pos.textContent = (i + 1);
    slot.appendChild(pos);

    var tile = document.createElement('div');
    tile.className = 'play-tile';
    tile.innerHTML =
      '<img src="' + setlist[i].file + '" alt="">' +
      '<div class="tile-info">' +
        '<div class="tile-title">' + setlist[i].title + '</div>' +
        '<div class="tile-artist">' + setlist[i].artist + '</div>' +
      '</div>' +
      '<div class="setlist-actions">' +
        '<button class="setlist-btn setlist-btn-swap" data-idx="' + i + '">&#8635;</button>' +
        '<button class="setlist-btn setlist-btn-remove" data-idx="' + i + '">&#10005;</button>' +
      '</div>';
    (function(idx) {
      tile.querySelector('.setlist-btn-swap').onclick = function(e) { e.stopPropagation(); swapSetlistSong(idx); };
      tile.querySelector('.setlist-btn-remove').onclick = function(e) { e.stopPropagation(); removeFromSetlist(idx); };
    })(i);
    slot.appendChild(tile);
    col.appendChild(slot);
  }
  // Always show a + tile at the end
  var addSlot = document.createElement('div');
  addSlot.className = 'play-song-slot';
  var spacer = document.createElement('div');
  spacer.className = 'play-song-pos';
  spacer.textContent = (setlist.length + 1);
  addSlot.appendChild(spacer);
  var addTile = document.createElement('div');
  addTile.className = 'play-tile play-add-tile';
  addTile.innerHTML = '+';
  addTile.onclick = showPlayPicker;
  addSlot.appendChild(addTile);
  col.appendChild(addSlot);
  updateDuration();
}

// ── Right Panel Dispatch ───────────────────────────────
function buildRightPanel() {
  var panel = document.getElementById('play-right-panel');
  var songCol = document.getElementById('play-song-col');
  panel.innerHTML = '';
  if (playMode === 'solo') {
    songCol.style.display = 'none';
    buildSoloPanel(panel);
  } else {
    songCol.style.display = '';
    buildCoopPanel(panel);
  }
}

// ── Solo Panel (row-based, paginated) ──────────────────
var soloPage = 0;
var soloScrollDir = '';
var SOLO_PER_PAGE = 3;

function soloTotalPages() {
  var count = setlist.length + 1; // +1 for the add row
  return Math.max(1, Math.ceil(count / SOLO_PER_PAGE));
}

function buildSoloPanel(panel) {
  var wrapper = document.createElement('div');
  wrapper.className = 'play-solo-wrapper';

  var container = document.createElement('div');
  container.className = 'play-solo-rows' + (soloScrollDir ? ' slide-' + soloScrollDir : '');
  soloScrollDir = '';

  // Clamp soloPage if songs were removed
  var tp = soloTotalPages();
  if (soloPage >= tp) soloPage = tp - 1;

  var totalSlots = setlist.length + 1; // songs + 1 add row
  var start = soloPage * SOLO_PER_PAGE;
  var end = Math.min(start + SOLO_PER_PAGE, totalSlots);

  for (var i = start; i < end; i++) {
    var row = document.createElement('div');
    var isAddRow = (i >= setlist.length);
    var isEmpty = isAddRow;
    row.className = 'play-solo-row';

    // Inner row wrapper (holds num, cover, buttons horizontally)
    var inner = document.createElement('div');
    inner.className = 'play-solo-row-inner';

    // Number
    var num = document.createElement('div');
    num.className = 'play-solo-num';
    num.textContent = (i + 1);
    inner.appendChild(num);

    // Cover art / add button
    var cover = document.createElement('div');
    cover.className = 'play-solo-cover';
    if (!isAddRow && setlist[i]) {
      cover.innerHTML =
        '<img src="' + setlist[i].file + '" alt="">' +
        '<div class="setlist-actions">' +
          '<button class="setlist-btn setlist-btn-preview" data-idx="' + i + '">' + (previewIdx === i ? '<svg width="14" height="16" viewBox="0 0 14 16" style="vertical-align:middle"><rect x="0" y="0" width="5" height="16" rx="1" fill="currentColor"/><rect x="9" y="0" width="5" height="16" rx="1" fill="currentColor"/></svg>' : '&#9654;') + '</button>' +
          '<button class="setlist-btn setlist-btn-swap" data-idx="' + i + '">&#8635;</button>' +
          '<button class="setlist-btn setlist-btn-remove" data-idx="' + i + '">&#10005;</button>' +
        '</div>';
      (function(idx) {
        cover.querySelector('.setlist-btn-preview').onclick = function(e) { e.stopPropagation(); togglePreview(idx); };
        cover.querySelector('.setlist-btn-swap').onclick = function(e) { e.stopPropagation(); swapSetlistSong(idx); };
        cover.querySelector('.setlist-btn-remove').onclick = function(e) { e.stopPropagation(); removeFromSetlist(idx); };
      })(i);
    } else {
      cover.className = 'play-solo-cover play-solo-cover-add';
      cover.innerHTML = '+';
      cover.onclick = showPlayPicker;
    }
    inner.appendChild(cover);

    // Instrument button
    var selInst = songInstruments[i] || 'guitar';
    var instObj = null;
    for (var j = 0; j < instruments.length; j++) {
      if (instruments[j].id === selInst) { instObj = instruments[j]; break; }
    }
    if (!instObj) instObj = instruments[0];

    var instBtn = document.createElement('div');
    instBtn.className = 'play-solo-btn' + (isEmpty ? ' empty' : '');
    instBtn.setAttribute('data-inst', instObj.id);
    instBtn.style.background = instObj.bg;
    var iconHtml = instObj.icon ? '<img class="solo-btn-icon" src="' + instObj.icon + '" style="' + (instObj.iconStyle || defaultIconStyle) + '">' : '';
    instBtn.innerHTML = '<span class="solo-btn-label">' + instObj.label + '</span>' + iconHtml;
    instBtn.onclick = (function(songIdx) {
      return function() { openSoloPopup(songIdx, 'instrument'); };
    })(i);
    inner.appendChild(instBtn);

    // Difficulty button
    var selDiff = songDiffs[i] || 'medium';
    var diffObj = null;
    for (var d = 0; d < difficulties.length; d++) {
      if (difficulties[d].id === selDiff) { diffObj = difficulties[d]; break; }
    }
    if (!diffObj) diffObj = difficulties[0];

    var diffBtn = document.createElement('div');
    diffBtn.className = 'play-solo-btn' + (isEmpty ? ' empty' : '');
    diffBtn.setAttribute('data-diff', diffObj.id);
    diffBtn.style.background = diffObj.bg;
    diffBtn.innerHTML = '<span class="solo-btn-label">' + diffObj.label + '</span>';
    diffBtn.onclick = (function(songIdx) {
      return function() { openSoloPopup(songIdx, 'difficulty'); };
    })(i);
    inner.appendChild(diffBtn);

    // Space button
    var spaceBtn = document.createElement('div');
    spaceBtn.className = 'play-solo-btn' + (isEmpty ? ' empty' : '');
    spaceBtn.setAttribute('data-role', 'space');
    spaceBtn.style.background = '#1a1a3e';
    var spaceConf = songSpaces[i] || {};
    var stageName = getSpaceOptionLabel('stage', spaceConf.stage || spaceDefaults.stage);
    spaceBtn.innerHTML = '<span class="solo-btn-label">' + stageName + '</span>';
    spaceBtn.onclick = (function(songIdx) {
      return function() { openSpacePopup(songIdx); };
    })(i);
    inner.appendChild(spaceBtn);

    // Loadout button
    var loadBtn = document.createElement('div');
    loadBtn.className = 'play-solo-btn' + (isEmpty ? ' empty' : '');
    loadBtn.setAttribute('data-role', 'loadout');
    loadBtn.style.background = '#374151';
    loadBtn.innerHTML = '<span class="solo-btn-label">Loadout</span>';
    loadBtn.onclick = (function(songIdx) {
      return function() { openLoadoutPopup(songIdx); };
    })(i);
    inner.appendChild(loadBtn);

    row.appendChild(inner);

    // Song meta bubbles underneath the row
    var meta = document.createElement('div');
    meta.className = 'play-solo-row-meta';
    if (!isAddRow && setlist[i]) {
      var s = setlist[i];
      var durMins = Math.floor(s.duration / 60);
      var durSecs = s.duration % 60;
      var durStr = durMins + ':' + (durSecs < 10 ? '0' : '') + durSecs;
      meta.innerHTML =
        '<span class="meta-bubble meta-bubble-title">' + s.title + '</span>' +
        '<span class="meta-bubble meta-bubble-artist">' + s.artist + '</span>' +
        '<span class="meta-bubble meta-bubble-dur">' + durStr + '</span>' +
        (s.bpm ? '<span class="meta-bubble meta-bubble-bpm">' + s.bpm + ' BPM</span>' : '');
    }
    row.appendChild(meta);

    container.appendChild(row);
  }

  wrapper.appendChild(container);

  // Navigation arrows
  var nav = document.createElement('div');
  nav.className = 'play-solo-nav';
  var onlyOnePage = (tp <= 1);

  var btnTop = document.createElement('button');
  btnTop.className = 'play-solo-nav-btn';
  btnTop.innerHTML = '<span>&#9650;</span><span>&#9650;</span>';
  btnTop.disabled = onlyOnePage || (soloPage === 0);
  btnTop.onclick = function() { soloScrollDir = 'down'; soloPage = 0; buildRightPanel(); };
  nav.appendChild(btnTop);

  var btnUp = document.createElement('button');
  btnUp.className = 'play-solo-nav-btn';
  btnUp.innerHTML = '&#9650;';
  btnUp.disabled = onlyOnePage || (soloPage === 0);
  btnUp.onclick = function() { if (soloPage > 0) { soloScrollDir = 'down'; soloPage--; buildRightPanel(); } };
  nav.appendChild(btnUp);

  var btnDown = document.createElement('button');
  btnDown.className = 'play-solo-nav-btn';
  btnDown.innerHTML = '&#9660;';
  btnDown.disabled = onlyOnePage || (soloPage >= tp - 1);
  btnDown.onclick = function() { if (soloPage < tp - 1) { soloScrollDir = 'up'; soloPage++; buildRightPanel(); } };
  nav.appendChild(btnDown);

  var btnBottom = document.createElement('button');
  btnBottom.className = 'play-solo-nav-btn';
  btnBottom.innerHTML = '<span>&#9660;</span><span>&#9660;</span>';
  btnBottom.disabled = onlyOnePage || (soloPage >= tp - 1);
  btnBottom.onclick = function() { soloScrollDir = 'up'; soloPage = tp - 1; buildRightPanel(); };
  nav.appendChild(btnBottom);

  wrapper.appendChild(nav);
  panel.appendChild(wrapper);

}

function openSoloPopup(songIdx, type) {
  var overlay = document.getElementById('solo-popup-overlay');
  var popup = document.getElementById('solo-popup');

  popup.className = 'solo-popup';
  popup.innerHTML = '';
  popup.style.position = 'relative';

  var closeBtn = document.createElement('button');
  closeBtn.className = 'popup-close-btn';
  closeBtn.innerHTML = '&#10005;';
  closeBtn.onclick = function(e) { e.stopPropagation(); closeSoloPopup(); };
  popup.appendChild(closeBtn);

  var title = document.createElement('div');
  title.className = 'solo-popup-title';
  title.textContent = type === 'instrument' ? 'Choose Instrument' : 'Choose Difficulty';
  popup.appendChild(title);

  var options = type === 'instrument' ? instruments : difficulties;
  for (var i = 0; i < options.length; i++) {
    var opt = options[i];
    var card = document.createElement('div');
    card.className = 'solo-popup-option';
    card.setAttribute('data-' + type, opt.id);
    card.style.background = opt.bg;
    card.innerHTML = '<div class="solo-popup-option-label">' + opt.label + '</div>' +
                     '<div class="solo-popup-option-desc">' + (opt.desc || '') + '</div>';
    card.onclick = (function(sIdx, t, optId) {
      return function() { selectSoloOption(sIdx, t, optId); };
    })(songIdx, type, opt.id);
    popup.appendChild(card);
  }

  overlay.className = 'solo-popup-overlay active';
}

function closeSoloPopup() {
  document.getElementById('solo-popup-overlay').className = 'solo-popup-overlay';
  document.getElementById('solo-popup').className = 'solo-popup';
}

function selectSoloOption(songIdx, type, optionId) {
  if (type === 'instrument') {
    songInstruments[songIdx] = optionId;
    sendToUnity('songInstrument', songIdx + ':' + optionId);
  } else {
    songDiffs[songIdx] = optionId;
    sendToUnity('songDifficulty', songIdx + ':' + optionId);
  }
  closeSoloPopup();
  buildRightPanel();
}

// ── Space Popup ────────────────────────────────────────
function getSpaceOptionLabel(catId, optId) {
  for (var c = 0; c < spaceCategories.length; c++) {
    if (spaceCategories[c].id === catId) {
      for (var o = 0; o < spaceCategories[c].options.length; o++) {
        if (spaceCategories[c].options[o].id === optId) return spaceCategories[c].options[o].label;
      }
    }
  }
  return '';
}

function openSpacePopup(songIdx) {
  var overlay = document.getElementById('solo-popup-overlay');
  var popup = document.getElementById('solo-popup');

  var spaceConf = songSpaces[songIdx] || {};

  popup.innerHTML = '';
  popup.style.position = 'relative';

  var closeBtn = document.createElement('button');
  closeBtn.className = 'popup-close-btn';
  closeBtn.innerHTML = '&#10005;';
  closeBtn.onclick = function(e) { e.stopPropagation(); closeSoloPopup(); };
  popup.appendChild(closeBtn);

  var title = document.createElement('div');
  title.className = 'space-popup-title';
  title.textContent = 'Customise Space';
  popup.appendChild(title);

  for (var c = 0; c < spaceCategories.length; c++) {
    var cat = spaceCategories[c];
    var section = document.createElement('div');
    section.className = 'space-popup-category';

    var catLabel = document.createElement('div');
    catLabel.className = 'space-popup-cat-label';
    catLabel.textContent = cat.label;
    section.appendChild(catLabel);

    var optGrid = document.createElement('div');
    optGrid.className = 'space-popup-cat-options';

    var currentSel = spaceConf[cat.id] || spaceDefaults[cat.id];
    for (var o = 0; o < cat.options.length; o++) {
      var opt = cat.options[o];
      var card = document.createElement('div');
      card.className = 'space-popup-opt' + (opt.id === currentSel ? ' selected' : '');
      card.style.background = opt.bg;
      card.innerHTML = '<div class="space-popup-opt-label">' + opt.label + '</div>' +
                       '<div class="space-popup-opt-desc">' + opt.desc + '</div>';
      card.onclick = (function(sIdx, catId, optId) {
        return function() { selectSpaceOption(sIdx, catId, optId); };
      })(songIdx, cat.id, opt.id);
      optGrid.appendChild(card);
    }
    section.appendChild(optGrid);
    popup.appendChild(section);
  }

  popup.className = 'space-popup';
  overlay.className = 'solo-popup-overlay active';
}

function selectSpaceOption(songIdx, catId, optId) {
  if (!songSpaces[songIdx]) songSpaces[songIdx] = {};
  songSpaces[songIdx][catId] = optId;
  sendToUnity('songSpace', songIdx + ':' + catId + ':' + optId);
  openSpacePopup(songIdx);
}

// ── Loadout Popup ──────────────────────────────────────
var songLoadouts = {};

var loadoutSkins = {
  guitar: [
    {id:'classic',  label:'Classic Strat',  desc:'The timeless original',       bg:'#b45309'},
    {id:'fire',     label:'Fire Burst',     desc:'Blazing sunburst finish',     bg:'#991b1b'},
    {id:'neon',     label:'Neon Pulse',     desc:'Glowing electric vibes',      bg:'#6b21a8'},
    {id:'ice',      label:'Ice Crystal',    desc:'Cool translucent body',       bg:'#0e7490'}
  ],
  bass: [
    {id:'classic',  label:'Jazz Bass',      desc:'Deep warm tone',              bg:'#0e7490'},
    {id:'thunder',  label:'Thunder',        desc:'Heavy rumbling power',        bg:'#991b1b'},
    {id:'midnight', label:'Midnight',       desc:'Sleek matte black',           bg:'#1a1a4e'},
    {id:'slap',     label:'Funk Slap',      desc:'Bright snappy punch',         bg:'#b45309'}
  ],
  keys: [
    {id:'grand',    label:'Grand Piano',    desc:'Concert hall classic',        bg:'#1a1a4e'},
    {id:'synth',    label:'Synth Board',    desc:'Retro analog waves',          bg:'#6b21a8'},
    {id:'organ',    label:'Retro Organ',    desc:'Warm vintage tones',          bg:'#b45309'},
    {id:'electric', label:'Electric Piano',  desc:'Smooth Rhodes sound',        bg:'#0e7490'}
  ],
  drums: [
    {id:'pearl',    label:'Pearl Kit',      desc:'Crisp acoustic shells',       bg:'#991b1b'},
    {id:'rock',     label:'Rock Kit',       desc:'Punchy stadium sound',        bg:'#b45309'},
    {id:'electric', label:'Electronic',     desc:'Synthetic drum machine',      bg:'#6b21a8'},
    {id:'jazz',     label:'Jazz Brushes',   desc:'Soft brush technique',        bg:'#1a1a4e'}
  ],
  vocals: [
    {id:'classic',  label:'Classic Mic',    desc:'Studio condenser',            bg:'#6b21a8'},
    {id:'gold',     label:'Gold Mic',       desc:'Premium vintage finish',      bg:'#b45309'},
    {id:'neon',     label:'Neon Mic',       desc:'Light-up stage mic',          bg:'#0e7490'},
    {id:'retro',    label:'50s Chrome',     desc:'Old school crooner style',    bg:'#991b1b'}
  ]
};

var loadoutHighways = [
  {id:'neon',     label:'Neon',       desc:'Glowing neon rails',      bg:'#6b21a8', symbol:'\u2261'},
  {id:'classic',  label:'Classic',    desc:'Clean standard lane',     bg:'#1a1a4e', symbol:'\u2503'},
  {id:'holo',     label:'Hologram',   desc:'Translucent light beams', bg:'#0e7490', symbol:'\u25C7'},
  {id:'minimal',  label:'Minimal',    desc:'Stripped back design',    bg:'#374151', symbol:'\u2500'}
];

var loadoutGems = [
  {id:'standard', label:'Standard',   desc:'Default gem shapes',      bg:'#0e7490', symbol:'\u25C6'},
  {id:'crystal',  label:'Crystal',    desc:'Faceted gem stones',      bg:'#6b21a8', symbol:'\u2666'},
  {id:'fire',     label:'Fire',       desc:'Burning ember notes',     bg:'#991b1b', symbol:'\u2738'},
  {id:'neon',     label:'Neon',       desc:'Bright glow orbs',        bg:'#b45309', symbol:'\u25CF'}
];

var loadoutEffects = [
  {id:'sparks',   label:'Sparks',     desc:'Electric spark bursts',   bg:'#b45309', symbol:'\u2607'},
  {id:'fireworks',label:'Fireworks',  desc:'Colourful explosions',    bg:'#991b1b', symbol:'\u2734'},
  {id:'shatter',  label:'Shatter',    desc:'Glass break particles',   bg:'#0e7490', symbol:'\u2756'},
  {id:'glow',     label:'Glow',       desc:'Soft radiant pulses',     bg:'#6b21a8', symbol:'\u2600'}
];

var loadoutDefaults = {skin:'classic', highway:'neon', gems:'standard', effects:'sparks'};
var currentLoadoutSongIdx = -1;

function openLoadoutPopup(songIdx) {
  currentLoadoutSongIdx = songIdx;
  var overlay = document.getElementById('loadout-overlay');
  var popup = document.getElementById('loadout-popup');
  popup.innerHTML = '';

  var instId = songInstruments[songIdx] || 'guitar';
  var instObj = null;
  for (var j = 0; j < instruments.length; j++) {
    if (instruments[j].id === instId) { instObj = instruments[j]; break; }
  }
  if (!instObj) instObj = instruments[0];

  var title = document.createElement('div');
  title.className = 'loadout-popup-title';
  title.textContent = instObj.label + ' Loadout';
  popup.appendChild(title);

  var loadout = songLoadouts[songIdx] || {};
  var skins = loadoutSkins[instId] || loadoutSkins.guitar;

  var categories = [
    {id:'skin',    label:'Instrument Skin', options: skins,            icon: instObj.icon},
    {id:'highway', label:'Highway',         options: loadoutHighways,  icon: null},
    {id:'gems',    label:'Gems',            options: loadoutGems,      icon: null},
    {id:'effects', label:'Hit Effects',     options: loadoutEffects,   icon: null}
  ];

  for (var c = 0; c < categories.length; c++) {
    var cat = categories[c];
    var section = document.createElement('div');
    section.className = 'loadout-category';

    var catLabel = document.createElement('div');
    catLabel.className = 'loadout-cat-label';
    catLabel.textContent = cat.label;
    section.appendChild(catLabel);

    var optGrid = document.createElement('div');
    optGrid.className = 'loadout-cat-options';

    var currentSel = loadout[cat.id] || loadoutDefaults[cat.id];
    for (var o = 0; o < cat.options.length; o++) {
      var opt = cat.options[o];
      var card = document.createElement('div');
      card.className = 'loadout-opt' + (opt.id === currentSel ? ' selected' : '');
      card.style.background = opt.bg;
      var graphicHtml = '';
      if (cat.icon) {
        graphicHtml = '<img class="loadout-opt-icon" src="' + cat.icon + '" alt="">';
      } else if (opt.symbol) {
        graphicHtml = '<span class="loadout-opt-symbol">' + opt.symbol + '</span>';
      }
      card.innerHTML = '<div class="loadout-opt-label">' + opt.label + '</div>' +
                       '<div class="loadout-opt-desc">' + opt.desc + '</div>' +
                       graphicHtml;
      card.onclick = (function(catId, optId) {
        return function() { selectLoadoutOption(catId, optId); };
      })(cat.id, opt.id);
      optGrid.appendChild(card);
    }
    section.appendChild(optGrid);
    popup.appendChild(section);
  }

  var closeBtn = document.createElement('button');
  closeBtn.className = 'loadout-close-btn';
  closeBtn.textContent = 'Done';
  closeBtn.onclick = closeLoadoutPopup;
  popup.appendChild(closeBtn);

  overlay.className = 'loadout-overlay active';
}

function selectLoadoutOption(catId, optId) {
  var idx = currentLoadoutSongIdx;
  if (!songLoadouts[idx]) songLoadouts[idx] = {};
  songLoadouts[idx][catId] = optId;
  sendToUnity('loadout', idx + ':' + catId + ':' + optId);
  openLoadoutPopup(idx);
}

function closeLoadoutPopup(e) {
  if (e && e.target && e.target === document.getElementById('loadout-popup')) return;
  document.getElementById('loadout-overlay').className = 'loadout-overlay';
}

// ── Co-op / Battle Panel ───────────────────────────────
function buildCoopPanel(panel) {
  // Instrument section
  var instHeader = document.createElement('div');
  instHeader.className = 'play-coop-section-header';
  instHeader.textContent = 'Instrument';
  panel.appendChild(instHeader);
  buildCoopOptionRow(panel, instruments, selectedInstrument, function(id) {
    selectedInstrument = id;
    buildRightPanel();
    sendToUnity('selectInstrument', id);
  });

  // Difficulty section
  var diffHeader = document.createElement('div');
  diffHeader.className = 'play-coop-section-header';
  diffHeader.textContent = 'Difficulty';
  panel.appendChild(diffHeader);
  buildCoopOptionRow(panel, difficulties, selectedDifficulty, function(id) {
    selectedDifficulty = id;
    buildRightPanel();
    sendToUnity('selectDifficulty', id);
  });

  // Players section
  var playersHeader = document.createElement('div');
  playersHeader.className = 'play-coop-section-header';
  playersHeader.textContent = 'Players';
  panel.appendChild(playersHeader);

  var grid = document.createElement('div');
  grid.className = 'play-players-grid';
  for (var i = 0; i < 9; i++) {
    var player = lobbyPlayers[i];
    if (player) {
      grid.appendChild(buildNameplate(player));
    }
  }
  panel.appendChild(grid);
}

function buildCoopOptionRow(container, options, selectedId, onSelect) {
  var row = document.createElement('div');
  row.className = 'play-coop-row';
  for (var i = 0; i < options.length; i++) {
    var o = options[i];
    var tile = document.createElement('div');
    tile.className = 'play-coop-tile' + (o.id === selectedId ? ' selected' : '');
    tile.style.background = o.bg;
    var iconHtml = o.icon ? '<img src="' + o.icon + '" style="' + (o.iconStyle || defaultIconStyle) + '">' : '';
    tile.innerHTML = '<span class="play-opt-label">' + o.label + '</span>' + iconHtml;
    tile.onclick = (function(opt) {
      return function() { onSelect(opt.id); };
    })(o);
    row.appendChild(tile);
  }
  container.appendChild(row);
}

function buildNameplate(player) {
  var plate = document.createElement('div');
  plate.className = 'play-nameplate';
  if (player.plateClass) {
    plate.classList.add(player.plateClass);
  } else if (player.plate) {
    plate.style.background = player.plate;
    if (player.plate.indexOf('url(') !== -1) plate.classList.add('plate-img');
  }

  var avatar = document.createElement('img');
  avatar.className = 'play-np-avatar';
  avatar.src = player.avatar;
  avatar.alt = '';
  plate.appendChild(avatar);

  var info = document.createElement('div');
  info.className = 'play-np-info';

  var name = document.createElement('div');
  name.className = 'play-np-name';
  name.textContent = player.name;
  info.appendChild(name);

  if (player.ready) {
    var badges = document.createElement('div');
    badges.className = 'play-np-badges';
    var instBadge = document.createElement('span');
    instBadge.className = 'play-np-badge';
    instBadge.textContent = (player.instrument || 'guitar').charAt(0).toUpperCase() + (player.instrument || 'guitar').slice(1, 3);
    badges.appendChild(instBadge);
    var diffBadge = document.createElement('span');
    diffBadge.className = 'play-np-badge';
    diffBadge.textContent = (player.difficulty || 'medium').charAt(0).toUpperCase();
    badges.appendChild(diffBadge);
    info.appendChild(badges);
  } else {
    var hg = document.createElement('div');
    hg.className = 'play-np-hourglass';
    hg.innerHTML = '&#9203;';
    info.appendChild(hg);
  }

  plate.appendChild(info);
  return plate;
}

var songDurations = {};

function getSongDuration(song) {
  if (!songDurations[song.title]) {
    songDurations[song.title] = 180 + Math.floor(Math.random() * 120);
  }
  return songDurations[song.title];
}

function updateDuration() {
  var total = 0;
  var count = 0;
  for (var i = 0; i < setlist.length; i++) {
    if (setlist[i]) {
      total += getSongDuration(setlist[i]);
      count++;
    }
  }
  var mins = Math.floor(total / 60);
  var secs = total % 60;
  document.getElementById('play-duration').textContent = mins + ':' + (secs < 10 ? '0' : '') + secs;
  document.getElementById('play-song-count').textContent = count + ' song' + (count !== 1 ? 's' : '');
}

function startGame() {
  sendToUnity('startGame', selectedInstrument);
}

// ── Save/Load Setlist ──────────────────────────────────
function openSaveSetlist() {
  var input = document.getElementById('save-setlist-input');
  input.value = 'My Playlist #' + setlistCounter;
  document.getElementById('save-overlay').className = 'save-overlay active';
}

function closeSaveOverlay(e) {
  if (e && e.target !== document.getElementById('save-overlay')) return;
  document.getElementById('save-overlay').className = 'save-overlay';
}

function confirmSaveSetlist() {
  var name = document.getElementById('save-setlist-input').value.trim();
  if (!name) name = 'My Playlist #' + setlistCounter;
  savedSetlists.push({
    name: name,
    songs: setlist.map(function(s) { return s ? {title: s.title, artist: s.artist, file: s.file, duration: s.duration} : null; }).filter(Boolean)
  });
  setlistCounter++;
  document.getElementById('save-overlay').className = 'save-overlay';
}

function openLoadSetlist() {
  buildLoadList();
  document.getElementById('load-overlay').className = 'load-overlay active';
}

function closeLoadOverlay(e) {
  if (e && e.target !== document.getElementById('load-overlay')) return;
  document.getElementById('load-overlay').className = 'load-overlay';
}

function buildLoadList() {
  var list = document.getElementById('load-list');
  list.innerHTML = '';
  if (savedSetlists.length === 0) {
    list.innerHTML = '<div class="load-empty">No saved setlists</div>';
    return;
  }
  for (var i = 0; i < savedSetlists.length; i++) {
    var sl = savedSetlists[i];
    var item = document.createElement('div');
    item.className = 'load-item';

    var grid = document.createElement('div');
    grid.className = 'load-art-grid';
    buildArtGrid(sl.songs, grid);
    item.appendChild(grid);

    var info = document.createElement('div');
    info.className = 'load-item-info';
    info.innerHTML = '<div class="load-item-name">' + sl.name + '</div>' +
      '<div class="load-item-count">' + sl.songs.length + ' song' + (sl.songs.length !== 1 ? 's' : '') + '</div>';
    item.appendChild(info);

    var loadBtn = document.createElement('button');
    loadBtn.className = 'load-item-btn load-item-btn-load';
    loadBtn.textContent = 'Load';
    (function(idx) { loadBtn.onclick = function() { loadSetlist(idx); }; })(i);
    item.appendChild(loadBtn);

    var delBtn = document.createElement('button');
    delBtn.className = 'load-item-btn load-item-btn-delete';
    delBtn.textContent = 'Delete';
    (function(idx) { delBtn.onclick = function() { deleteSetlist(idx); }; })(i);
    item.appendChild(delBtn);

    list.appendChild(item);
  }
}

function buildArtGrid(songs, container) {
  for (var i = 0; i < 4; i++) {
    if (songs[i] && songs[i].file) {
      var img = document.createElement('img');
      img.src = songs[i].file;
      img.alt = '';
      container.appendChild(img);
    } else {
      var empty = document.createElement('div');
      empty.className = 'art-empty';
      container.appendChild(empty);
    }
  }
}

function loadSetlist(idx) {
  var sl = savedSetlists[idx];
  setlist = [];
  songInstruments = {};
  songDiffs = {};
  songSpaces = {};
  for (var i = 0; i < sl.songs.length; i++) {
    var saved = sl.songs[i];
    var match = null;
    for (var j = 0; j < allSongs.length; j++) {
      if (allSongs[j].title === saved.title && allSongs[j].artist === saved.artist) {
        match = allSongs[j];
        break;
      }
    }
    if (match) {
      setlist.push(match);
      songInstruments[i] = selectedInstrument;
      songDiffs[i] = selectedDifficulty;
    }
  }
  document.getElementById('load-overlay').className = 'load-overlay';
  buildSongColumn();
  buildRightPanel();
  sendToUnity('setlistUpdated', setlist.length);
}

function deleteSetlist(idx) {
  savedSetlists.splice(idx, 1);
  buildLoadList();
}

function onScreenKey(char) {
  var input = document.getElementById('save-setlist-input');
  if (char === 'backspace') {
    input.value = input.value.slice(0, -1);
  } else if (char === 'clear') {
    input.value = '';
  } else if (char === ' ') {
    input.value += ' ';
  } else {
    input.value += char;
  }
}

function removeFromSetlist(idx) {
  setlist.splice(idx, 1);
  // Shift per-song instruments, difficulties and spaces
  var newInst = {};
  var newDiff = {};
  var newSpace = {};
  for (var i = 0; i < setlist.length + 1; i++) {
    if (i < idx) {
      newInst[i] = songInstruments[i];
      newDiff[i] = songDiffs[i];
      newSpace[i] = songSpaces[i];
    } else {
      newInst[i] = songInstruments[i + 1];
      newDiff[i] = songDiffs[i + 1];
      newSpace[i] = songSpaces[i + 1];
    }
  }
  songInstruments = newInst;
  songDiffs = newDiff;
  songSpaces = newSpace;
  buildSongColumn();
  buildRightPanel();
  sendToUnity('setlistUpdated', setlist.length);
}

function swapSetlistSong(idx) {
  swapTargetIdx = idx;
  showPlayPicker();
}

// ── Preview Audio ──────────────────────────────────────
var previewAudio = null;
var previewIdx = -1;

function togglePreview(idx) {
  if (previewIdx === idx && previewAudio && !previewAudio.paused) {
    previewAudio.pause();
    previewIdx = -1;
    buildRightPanel();
    return;
  }
  if (previewAudio) { previewAudio.pause(); }
  var song = setlist[idx];
  if (!song || !song.file) return;
  var audioSrc = song.file.replace(/\.[^.]+$/, '.mp3');
  previewAudio = new Audio(audioSrc);
  previewAudio.volume = 0.5;
  previewAudio.play().catch(function() {});
  previewIdx = idx;
  previewAudio.onended = function() { previewIdx = -1; buildRightPanel(); };
  buildRightPanel();
}

var lbTypes = [
  {label: 'Worldwide', icon: '\u{1F30D}'},
  {label: 'Local',     icon: '\u{1F4CD}'},
  {label: 'Friends',   icon: '\u{1F465}'}
];
var currentLbType = 0;

var pickerSelectedSong = null;

var lbNamePool = [
  'xShredMaster','BeatDropQueen','NeonRiff','AxelStorm','VoxHunter',
  'FretBoss','SynthWave99','PickSlinger','CrashKid','LoopMachine',
  'WahPedal','TrebleMaker','RiffRider','BassCanon','TempoTitan',
  'ChordCrusher','MelodyMaven','GrooveGuru','HarmonyHero','SonicBlaze',
  'VibeCheck','EchoStrike','PulseRider','WaveBreaker','ToneShifter',
  'AmpliFire','DropZone','MixMaster','ClefKing','OctaveOwl'
];
var lbPlatePool = [np.galaxy, np.bamboo, np.garden, np.flames, np.drums, np.microphone, np.kpop, np.sakura];
var lbPlateClasses = ['plate-holo', 'plate-radiate'];

function lbHash(str) {
  var h = 5381;
  for (var i = 0; i < str.length; i++) h = ((h << 5) + h + str.charCodeAt(i)) | 0;
  return Math.abs(h);
}

function generateLeaderboard(songTitle, instId, diffId, lbType) {
  var seed = lbHash(songTitle + '|' + instId + '|' + diffId + '|' + lbType);
  function rng() {
    seed = (seed * 1103515245 + 12345) & 0x7fffffff;
    return seed / 0x7fffffff;
  }
  var names = lbNamePool.slice();
  for (var i = names.length - 1; i > 0; i--) {
    var j = Math.floor(rng() * (i + 1));
    var tmp = names[i]; names[i] = names[j]; names[j] = tmp;
  }
  var entries = [];
  var baseScore = Math.floor(rng() * 200000) + 800000;
  for (var i = 0; i < 8; i++) {
    var score = baseScore - Math.floor(rng() * 12000 + 3000) * i;
    if (score < 100000) score = 100000 + Math.floor(rng() * 50000);
    var avatarNum = String(Math.floor(rng() * 40) + 1).padStart(3, '0');
    var entry = {
      pos: i + 1,
      name: names[i],
      score: score,
      avatar: 'art/' + avatarNum + '.jpg'
    };
    if (rng() > 0.7) {
      entry.plateClass = lbPlateClasses[Math.floor(rng() * lbPlateClasses.length)];
    } else {
      entry.plate = lbPlatePool[Math.floor(rng() * lbPlatePool.length)];
    }
    entries.push(entry);
  }
  entries.sort(function(a, b) { return b.score - a.score; });
  // Insert Jooleeno at a random position
  var jooleenoScore = entries.length > 0 ? entries[Math.floor(rng() * entries.length)].score + Math.floor(rng() * 5000) - 2500 : 500000;
  var jooleenoIdx = Math.floor(rng() * (entries.length + 1));
  entries.splice(jooleenoIdx, 0, {
    pos: 0,
    name: 'Jooleeno',
    score: jooleenoScore,
    avatar: 'julie.jpg'
  });
  // Insert A_Peach at a random position
  var peachScore = entries.length > 0 ? entries[Math.floor(rng() * entries.length)].score + Math.floor(rng() * 5000) - 2500 : 500000;
  var peachIdx = Math.floor(rng() * (entries.length + 1));
  entries.splice(peachIdx, 0, {
    pos: 0,
    name: 'A_Peach',
    score: peachScore,
    avatar: 'peach.png'
  });
  entries.sort(function(a, b) { return b.score - a.score; });
  if (lbType === 'Worldwide') {
    var startPos = Math.floor(rng() * 500) + 1;
    for (var i = 0; i < entries.length; i++) entries[i].pos = startPos + i;
  } else {
    for (var i = 0; i < entries.length; i++) entries[i].pos = i + 1;
  }
  return entries;
}

function rotateLbType() {
  currentLbType = (currentLbType + 1) % lbTypes.length;
  var t = lbTypes[currentLbType];
  document.getElementById('lb-type-btn').innerHTML = '<span>' + t.icon + '</span> ' + t.label;
  buildLeaderboard();
  sendToUnity('leaderboardType', t.label);
}

var pickerInstIdx = 0;
var pickerDiffIdx = 1; // default Medium

var instIcons = {guitar:'&#127928;', keys:'&#127929;', drums:'&#129345;', vocals:'&#127908;', bass:'&#127928;'};
var diffIcons = {easy:'&#127922;', medium:'&#127919;', hard:'&#128293;', expert:'&#128128;'};

function rotatePickerInstrument() {
  pickerInstIdx = (pickerInstIdx + 1) % instruments.length;
  var inst = instruments[pickerInstIdx];
  selectedInstrument = inst.id;
  document.getElementById('picker-inst-btn').innerHTML = (instIcons[inst.id] || '') + ' ' + inst.label;
  buildLeaderboard();
  sendToUnity('selectInstrument', inst.id);
}

function rotatePickerDifficulty() {
  pickerDiffIdx = (pickerDiffIdx + 1) % difficulties.length;
  var diff = difficulties[pickerDiffIdx];
  selectedDifficulty = diff.id;
  document.getElementById('picker-diff-btn').innerHTML = (diffIcons[diff.id] || '') + ' ' + diff.label;
  buildLeaderboard();
  sendToUnity('selectDifficulty', diff.id);
}

function shortPos(n) {
  if (n >= 1000000) return (n / 1000000).toFixed(1).replace('.0', '') + 'M';
  if (n >= 1000) return (n / 1000).toFixed(1).replace('.0', '') + 'K';
  return '' + n;
}

function buildLeaderboard() {
  var list = document.getElementById('play-lb-list');
  list.innerHTML = '';
  var typeName = lbTypes[currentLbType].label;
  var songTitle = pickerSelectedSong ? pickerSelectedSong.title : 'default';
  var instId = instruments[pickerInstIdx].id;
  var diffId = difficulties[pickerDiffIdx].id;
  var entries = generateLeaderboard(songTitle, instId, diffId, typeName);
  var starHtml = '<div class="play-lb-stars">&#9733;&#9733;&#9733;&#9733;&#9733;</div>';
  for (var i = 0; i < 8 && i < entries.length; i++) {
    var lb = entries[i];
    var row = document.createElement('div');
    row.className = 'play-lb-row';
    var tile = document.createElement('div');
    tile.className = 'play-lb-tile';
    row.innerHTML = '<span class="play-lb-pos">' + shortPos(lb.pos) + '</span>';
    tile.innerHTML =
      '<img class="play-lb-avatar" src="' + lb.avatar + '" alt="">' +
      '<div class="play-lb-info">' +
        starHtml +
        '<div class="play-lb-name">' + lb.name + '</div>' +
        '<div class="play-lb-score">' + lb.score.toLocaleString() + '</div>' +
      '</div>';
    row.appendChild(tile);
    list.appendChild(row);
  }
}

function selectPickerSong(song, tileEl) {
  pickerSelectedSong = song;
  var tiles = document.querySelectorAll('.song-tile');
  for (var i = 0; i < tiles.length; i++) tiles[i].classList.remove('active');
  if (tileEl) tileEl.classList.add('active');
  buildLeaderboard();
}

function addSongToSetlist(song) {
  if (swapTargetIdx >= 0) {
    setlist[swapTargetIdx] = song;
    swapTargetIdx = -1;
  } else {
    setlist.push(song);
  }
  buildSongColumn();
  buildRightPanel();
  buildPickerSetlist();
  sendToUnity('selectSong', song.title);
}

var PICKER_SETLIST_SLOTS = 6;
var pickerSetlistPage = 0;

function buildPickerSetlist() {
  var container = document.getElementById('picker-setlist-tiles');
  var nav = document.getElementById('picker-setlist-nav');
  if (!container) return;
  container.innerHTML = '';
  if (nav) nav.innerHTML = '';
  var total = setlist.length;
  var maxPage = Math.max(0, Math.ceil(total / PICKER_SETLIST_SLOTS) - 1);
  if (pickerSetlistPage > maxPage) pickerSetlistPage = maxPage;
  var startIdx = pickerSetlistPage * PICKER_SETLIST_SLOTS;
  var needsPaging = total > PICKER_SETLIST_SLOTS;

  for (var i = 0; i < PICKER_SETLIST_SLOTS; i++) {
    var songIdx = startIdx + i;
    var tile = document.createElement('div');
    if (songIdx < total) {
      tile.className = 'picker-setlist-tile';
      tile.innerHTML =
        '<img src="' + setlist[songIdx].file + '" alt="">' +
        '<div class="picker-setlist-remove">&#10005;</div>';
      (function(idx) {
        tile.querySelector('.picker-setlist-remove').onclick = function(e) {
          e.stopPropagation();
          removeFromSetlist(idx);
          buildPickerSetlist();
        };
      })(songIdx);
    } else {
      tile.className = 'picker-setlist-tile picker-setlist-empty';
    }
    container.appendChild(tile);
  }

  // Pagination arrows below tiles
  if (needsPaging && nav) {
    var left = document.createElement('button');
    left.className = 'picker-setlist-arrow';
    left.innerHTML = '&#9664;';
    left.disabled = pickerSetlistPage === 0;
    left.onclick = function() { pickerSetlistPage--; buildPickerSetlist(); };
    nav.appendChild(left);

    var right = document.createElement('button');
    right.className = 'picker-setlist-arrow';
    right.innerHTML = '&#9654;';
    right.disabled = pickerSetlistPage >= maxPage;
    right.onclick = function() { pickerSetlistPage++; buildPickerSetlist(); };
    nav.appendChild(right);
  }
}

function constrainGridNav() {
  var tile = document.querySelector('.song-tile');
  var navEl = document.getElementById('grid-nav-right');
  if (tile && navEl) {
    var tileH = tile.offsetHeight;
    var page = document.querySelector('.grid-page');
    var gap = page ? parseFloat(getComputedStyle(page).gap) || 10 : 10;
    var contentH = Math.ceil(4 * tileH + 3 * gap);
    navEl.style.maxHeight = contentH + 'px';
  }
}

function showPlayPicker() {
  document.getElementById('play-main-layout').style.display = 'none';
  document.getElementById('play-picker').className = 'play-picker active';
  // Reset filters
  document.getElementById('filter-genre').value = '';
  document.getElementById('filter-decade').value = '';
  document.getElementById('filter-duration').value = '';
  document.getElementById('filter-sort').value = 'rank';
  pickerSetlistPage = 0;
  // Rebuild grid with all songs
  buildGrid(allSongs);
  // Measure page height now that picker is visible
  var vp = document.querySelector('.grid-viewport');
  if (vp) {
    pageHeight = vp.clientHeight;
    var gridPages = document.querySelectorAll('.grid-page');
    for (var i = 0; i < gridPages.length; i++) {
      gridPages[i].style.height = pageHeight + 'px';
    }
  }
  constrainGridNav();
  currentPage = 0;
  goToPage(0);
  if (totalPages > 0) {
    buildNavButtons(document.getElementById('grid-nav-right'), 'right');
    updateNavState();
  }
  var gridNavs = document.querySelectorAll('.grid-nav');
  for (var i = 0; i < gridNavs.length; i++) gridNavs[i].style.display = 'flex';
  // Auto-select first song tile
  pickerSelectedSong = null;
  var firstTile = document.querySelector('.song-tile');
  if (firstTile) firstTile.click();
  buildPickerSetlist();
}

function hidePlayPicker() {
  document.getElementById('play-main-layout').style.display = 'flex';
  document.getElementById('play-picker').className = 'play-picker';
  swapTargetIdx = -1;
  pickerSelectedSong = null;
  var gridNavs = document.querySelectorAll('.grid-nav');
  for (var i = 0; i < gridNavs.length; i++) gridNavs[i].style.display = 'none';
}

function resetPlayPicker() {
  var picker = document.getElementById('play-picker');
  if (picker) picker.className = 'play-picker';
  var layout = document.getElementById('play-main-layout');
  if (layout) layout.style.display = 'flex';
  swapTargetIdx = -1;
  pickerSelectedSong = null;
  var gridNavs = document.querySelectorAll('.grid-nav');
  for (var i = 0; i < gridNavs.length; i++) gridNavs[i].style.display = 'none';
}

function initLobbyPlates() {
  lobbyPlayers[0].plate = np.flames;
  lobbyPlayers[2].plate = np.galaxy;
  lobbyPlayers[3].plate = np.kpop;
  lobbyPlayers[4].plate = np.bamboo;
  lobbyPlayers[6].plate = np.microphone;
  lobbyPlayers[7].plate = np.garden;
  lobbyPlayers[8].plate = np.drums;
}

var songGenres = ['Pop','Hip-Hop','Rock','R&B','Country','Electronic','Latin','Indie'];
var songDecades = ['2020s','2010s','2000s','90s','80s','Classic'];


function applyPickerFilters() {
  var genre = document.getElementById('filter-genre').value;
  var decade = document.getElementById('filter-decade').value;
  var dur = document.getElementById('filter-duration').value;
  var sort = document.getElementById('filter-sort').value;
  var filtered = allSongs.filter(function(s) {
    if (genre && s.genre !== genre) return false;
    if (decade && s.decade !== decade) return false;
    if (dur === 'short' && s.duration >= 180) return false;
    if (dur === 'medium' && (s.duration < 180 || s.duration > 240)) return false;
    if (dur === 'long' && s.duration <= 240) return false;
    return true;
  });
  if (sort === 'title') {
    filtered.sort(function(a, b) { return a.title.localeCompare(b.title); });
  } else if (sort === 'artist') {
    filtered.sort(function(a, b) { return a.artist.localeCompare(b.artist); });
  } else if (sort === 'duration') {
    filtered.sort(function(a, b) { return a.duration - b.duration; });
  } else if (sort === 'recent') {
    filtered.sort(function(a, b) { return b.dateAdded - a.dateAdded; });
  } else {
    filtered.sort(function(a, b) { return a.rank - b.rank; });
  }
  buildGrid(filtered);
  // Re-measure page heights and reset
  var vp = document.querySelector('.grid-viewport');
  if (vp) {
    pageHeight = vp.clientHeight;
    var gridPages = document.querySelectorAll('.grid-page');
    for (var i = 0; i < gridPages.length; i++) gridPages[i].style.height = pageHeight + 'px';
  }
  constrainGridNav();
  currentPage = 0;
  goToPage(0);
  updateNavState();
  // Auto-select first tile
  pickerSelectedSong = null;
  var firstTile = document.querySelector('.song-tile');
  if (firstTile) firstTile.click();
}

function buildPlayPanel(songs) {
  allSongs = songs;
  setlist = [songs[Math.floor(Math.random() * songs.length)]];
  generateDefaultSetlists();
  initLobbyPlates();
  buildModeTabs();
  buildSongColumn();
  buildRightPanel();
  buildLeaderboard();
}

function generateDefaultSetlists() {
  var names = ['Rock Classics', 'Chill Vibes', 'Party Mix', 'Throwbacks', 'Hot Hits'];
  var shuffled = allSongs.slice();
  for (var n = 0; n < 5; n++) {
    // Shuffle
    for (var i = shuffled.length - 1; i > 0; i--) {
      var j = Math.floor(Math.random() * (i + 1));
      var tmp = shuffled[i]; shuffled[i] = shuffled[j]; shuffled[j] = tmp;
    }
    var count = 3 + Math.floor(Math.random() * 4); // 3-6 songs
    var picked = shuffled.slice(0, count).map(function(s) {
      return {title: s.title, artist: s.artist, file: s.file, duration: s.duration};
    });
    savedSetlists.push({name: names[n], songs: picked});
  }
  setlistCounter = 6;
}

// ── Vault Grid ──────────────────────────────────────────
var vaultItems = [
  {name:'Neon Arena',      cat:'Spaces',      file:'vault/001.jpg'},
  {name:'Desert Stage',    cat:'Spaces',      file:'vault/002.jpg'},
  {name:'Club Basement',   cat:'Spaces',      file:'vault/003.jpg'},
  {name:'Beach Party',     cat:'Spaces',      file:'vault/004.jpg'},
  {name:'Crystal Platform',cat:'Stages',      file:'vault/005.jpg'},
  {name:'Fire Stage',      cat:'Stages',      file:'vault/006.jpg'},
  {name:'Ice Rink',        cat:'Stages',      file:'vault/007.jpg'},
  {name:'Cloud Stage',     cat:'Stages',      file:'vault/008.jpg'},
  {name:'Avatar',          cat:'Avatar',      file:'vault/009.jpg'},
  {name:'Electric Guitar', cat:'Instruments', file:'vault/010.jpg'},
  {name:'Synthesizer',     cat:'Instruments', file:'vault/011.jpg'},
  {name:'Drum Kit',        cat:'Instruments', file:'vault/012.jpg'},
  {name:'Gold Mic',        cat:'Instruments', file:'vault/013.jpg'},
  {name:'Ruby',            cat:'Gem',         file:'vault/014.jpg'},
  {name:'Sapphire',        cat:'Gem',         file:'vault/015.jpg'},
  {name:'Emerald',         cat:'Gem',         file:'vault/016.jpg'},
  {name:'Diamond',         cat:'Gem',         file:'vault/017.jpg'},
  {name:'Neon Highway',    cat:'Highway',     file:'vault/018.jpg'},
  {name:'Rainbow Road',    cat:'Highway',     file:'vault/019.jpg'},
  {name:'Dark Highway',    cat:'Highway',     file:'vault/020.jpg'},
  {name:'Lava Highway',    cat:'Highway',     file:'vault/021.jpg'},
  {name:'Sunset',          cat:'Skybox',      file:'vault/022.jpg'},
  {name:'Galaxy',          cat:'Skybox',      file:'vault/023.jpg'},
  {name:'Northern Lights', cat:'Skybox',      file:'vault/024.jpg'},
  {name:'Storm',           cat:'Skybox',      file:'vault/025.jpg'}
];

function buildVaultGrid() {
  var grid = document.getElementById('vault-grid');
  grid.innerHTML = '';
  for (var i = 0; i < vaultItems.length; i++) {
    var v = vaultItems[i];
    var tile = document.createElement('div');
    tile.className = 'vault-tile';
    tile.onclick = (function(item) {
      return function() { sendToUnity('selectVaultItem', {name: item.name, cat: item.cat}); };
    })(v);
    tile.innerHTML =
      '<img src="' + v.file + '" alt="" loading="lazy">' +
      '<div class="tile-info">' +
        '<div class="tile-cat">' + v.cat + '</div>' +
        '<div class="tile-title">' + v.name + '</div>' +
      '</div>';
    grid.appendChild(tile);
  }
}

// ── Themes ──────────────────────────────────────────────
var themes = [
  { id: 'wireframe-light', name: 'Wireframe Light', bg: '#ffffff', panel: '#fafafa', tile: '#ebebeb', tileHover: '#e0e0e0', accent: '#000000', cssClass: 'theme-wireframe' },
  { id: 'wireframe-dark',  name: 'Wireframe Dark',  bg: '#000000', panel: '#0a0a0a', tile: '#141414', tileHover: '#1e1e1e', accent: '#ffffff', cssClass: 'theme-wireframe' },
  { id: 'neon-pink',    name: 'Neon Pink',    bg: '#0d0d1a', panel: '#1a1a2e', tile: '#222238', tileHover: '#2c2c44', accent: '#db2777' },
  { id: 'cyber-cyan',   name: 'Cyber Cyan',   bg: '#051a1f', panel: '#0a2a32', tile: '#10343e', tileHover: '#18404c', accent: '#0891b2' },
  { id: 'sunset-blaze', name: 'Sunset Blaze', bg: '#1a0d08', panel: '#2e1a10', tile: '#3a2218', tileHover: '#482c20', accent: '#ea580c' },
  { id: 'light-mode',   name: 'Light Mode',   bg: '#e8e8f0', panel: '#f8f8fc', tile: '#eeeef4', tileHover: '#e2e2ec', accent: '#c0206a' },
  { id: 'rainforest',   name: 'Rainforest',   bg: '#e8e8f0', panel: '#f8f8fc', tile: '#eeeef4', tileHover: '#e2e2ec', accent: '#16a368', bgImage: 'https://images.unsplash.com/photo-1448375240586-882707db888b?w=1920&q=80' },
  { id: 'dracula',      name: 'Dracula',      bg: '#1e1f29', panel: '#282a36', tile: '#2e3040', tileHover: '#363848', accent: '#ff79c6', locked: true, price: 1000 },
  { id: 'nord',         name: 'Nord',         bg: '#2e3440', panel: '#3b4252', tile: '#434c5e', tileHover: '#4c566a', accent: '#88c0d0', locked: true, price: 1000 },
  { id: 'monokai',      name: 'Monokai',      bg: '#1e1f1c', panel: '#272822', tile: '#30302a', tileHover: '#3a3a32', accent: '#f92672', locked: true, price: 1000 },
  { id: 'gruvbox',      name: 'Gruvbox',      bg: '#1d2021', panel: '#282828', tile: '#323232', tileHover: '#3c3c3c', accent: '#fb4934', locked: true, price: 1000 },
  { id: 'solarized',    name: 'Solarized',    bg: '#002b36', panel: '#073642', tile: '#0e404e', tileHover: '#164a58', accent: '#2aa198', locked: true, price: 1000 },
  { id: 'tokyo-night',  name: 'Tokyo Night',  bg: '#16161e', panel: '#1a1b26', tile: '#222330', tileHover: '#2a2b3a', accent: '#f7768e', locked: true, price: 1000 },
  { id: 'catppuccin',   name: 'Catppuccin',   bg: '#1e1e2e', panel: '#24243e', tile: '#2e2e4a', tileHover: '#383856', accent: '#cba6f7', locked: true, price: 1000 },
  { id: 'rose-pine',    name: 'Rose Pine',    bg: '#191724', panel: '#1f1d2e', tile: '#28263a', tileHover: '#322f46', accent: '#eb6f92', locked: true, price: 1000 },
  { id: 'neon-arcade',  name: 'Neon Arcade',  bg: '#0a0a1a', panel: '#12122a', tile: '#1a1a3e', tileHover: '#242454', accent: '#ff2d78', cssClass: 'theme-arcade' },
  { id: 'hunter',       name: 'Hunter',       bg: '#ede5f5', panel: '#f5f0fc', tile: '#e8dff4', tileHover: '#ddd2ee', accent: '#d946a8', cssClass: 'theme-hunter' },
  { id: 'nebula',       name: 'Nebula',       bg: '#080c1a', panel: '#0e1528', tile: '#162040', tileHover: '#1e2c52', accent: '#7c5bf5', cssClass: 'theme-nebula' },
  { id: 'liquid-glass', name: 'Liquid Glass', bg: '#ffffff', panel: '#f0edf6', tile: '#e8e4f0', tileHover: '#ddd8ea', accent: '#c83868', cssClass: 'theme-liquid' }
];

var currentTheme = 'wireframe-light';
var userCoins = 5000;
var allTilings = [];
var currentLayout = 0;
var unlockedThemes = ['wireframe-light', 'wireframe-dark', 'neon-pink', 'cyber-cyan', 'sunset-blaze', 'light-mode', 'rainforest', 'neon-arcade', 'hunter', 'nebula', 'liquid-glass'];
var pendingPurchaseId = null;

var banners = [
  { id: 'space1', name: 'Space 1', file: 'banners/Space 1.png' },
  { id: 'daisies', name: 'Daisies', file: 'banners/Daisies.png' },
  { id: 'space2', name: 'Space 2', file: 'banners/Space 2.png', locked: true, price: 500 },
  { id: 'gothic1', name: 'Gothic 1', file: 'banners/Gothic 1.png', locked: true, price: 750 },
  { id: 'sully', name: 'Sully', file: 'banners/Sully.png', locked: true, price: 1000 },
  { id: 'cracked-desert', name: 'Cracked Desert', file: 'banners/Cracked Desert.png' },
  { id: 'butterfly', name: 'Butterfly', file: 'banners/Butterfly.png' },
  { id: 'comic', name: 'Comic', file: 'banners/Comic.png', locked: true, price: 500 },
  { id: 'gothic2', name: 'Gothic 2', file: 'banners/Gothic 2.png', locked: true, price: 750 },
  { id: 'swirls', name: 'Swirls', file: 'banners/Swirls.png', locked: true, price: 1000 },
  { id: 'magic', name: 'Magic', file: 'banners/Magic.png', locked: true, price: 1000 }
];
var currentBanner = null;
var unlockedBanners = ['space1', 'daisies', 'cracked-desert', 'butterfly'];
var pendingBannerPurchaseId = null;

var frames = [
  { id: 'none', name: 'None', color1: 'transparent', color2: 'transparent' },
  { id: 'pink-purple', name: 'Pink Purple', color1: '#db2777', color2: '#a855f7' },
  { id: 'cyan-blue', name: 'Cyan Blue', color1: '#06b6d4', color2: '#3b82f6' },
  { id: 'gold-orange', name: 'Gold Orange', color1: '#f59e0b', color2: '#f97316', locked: true, price: 500 },
  { id: 'green-teal', name: 'Green Teal', color1: '#10b981', color2: '#14b8a6', locked: true, price: 500 },
  { id: 'red-pink', name: 'Red Pink', color1: '#ef4444', color2: '#ec4899', locked: true, price: 750 },
  { id: 'purple-blue', name: 'Purple Blue', color1: '#8b5cf6', color2: '#6366f1', locked: true, price: 750 },
  { id: 'rainbow', name: 'Rainbow', color1: '#ff0080', color2: '#00d4ff', locked: true, price: 1000 },
  { id: 'fire', name: 'Fire', color1: '#ff4500', color2: '#ffd700', locked: true, price: 1000 }
];
var currentFrame = 'pink-purple';
var unlockedFrames = ['none', 'pink-purple', 'cyan-blue'];
var pendingFramePurchaseId = null;

function isThemeUnlocked(id) {
  return unlockedThemes.indexOf(id) >= 0;
}

function isBannerUnlocked(id) {
  return unlockedBanners.indexOf(id) >= 0;
}

function isFrameUnlocked(id) {
  return unlockedFrames.indexOf(id) >= 0;
}

function applyFrame(frameId) {
  var frame = null;
  for (var i = 0; i < frames.length; i++) {
    if (frames[i].id === frameId) { frame = frames[i]; break; }
  }
  if (!frame) return;
  if (frame.locked && !isFrameUnlocked(frameId)) {
    openFramePurchasePopup(frameId);
    return;
  }
  currentFrame = frameId;
  var root = document.documentElement;
  root.style.setProperty('--frame-color-1', frame.color1);
  root.style.setProperty('--frame-color-2', frame.color2);
  buildFrameGrid();
  sendToUnity('frameChanged', frameId);
}

function applyBanner(bannerId) {
  var banner = null;
  for (var i = 0; i < banners.length; i++) {
    if (banners[i].id === bannerId) { banner = banners[i]; break; }
  }
  if (!banner) return;
  if (banner.locked && !isBannerUnlocked(bannerId)) {
    openBannerPurchasePopup(bannerId);
    return;
  }
  currentBanner = bannerId;

  // Create a style rule for the banner that targets ::before
  var styleId = 'banner-style';
  var existingStyle = document.getElementById(styleId);
  if (existingStyle) existingStyle.parentNode.removeChild(existingStyle);

  var style = document.createElement('style');
  style.id = styleId;
  style.textContent = '.topbar::before { background-image: url(' + banner.file + ') !important; }';
  document.head.appendChild(style);

  // Apply same banner to navbar and content
  var navBanner = document.getElementById('navbar-banner');
  if (navBanner) {
    navBanner.style.backgroundImage = 'url(' + banner.file + ')';
  }
  var contentBanner = document.getElementById('content-banner');
  if (contentBanner) {
    contentBanner.style.backgroundImage = 'url(' + banner.file + ')';
  }

  buildBannerGrid();
  sendToUnity('bannerChanged', bannerId);
}

function hexLum(hex) {
  hex = hex.replace('#', '');
  var r = parseInt(hex.substring(0, 2), 16);
  var g = parseInt(hex.substring(2, 4), 16);
  var b = parseInt(hex.substring(4, 6), 16);
  return (0.299 * r + 0.587 * g + 0.114 * b) / 255;
}

function themeSwatches(t) {
  return [t.accent, t.tileHover, t.tile, t.panel, t.bg];
}

function applyTheme(themeId) {
  var theme = null;
  for (var i = 0; i < themes.length; i++) {
    if (themes[i].id === themeId) { theme = themes[i]; break; }
  }
  if (!theme) return;
  if (theme.locked && !isThemeUnlocked(themeId)) {
    openPurchasePopup(themeId);
    return;
  }
  currentTheme = themeId;
  var root = document.documentElement;
  var light = hexLum(theme.bg) > 0.4;

  root.style.setProperty('--bg-body', theme.bg);
  root.style.setProperty('--bg-panel', theme.panel);
  root.style.setProperty('--bg-surface', theme.tile);
  root.style.setProperty('--bg-surface-hover', theme.tileHover);
  root.style.setProperty('--pink', theme.accent);

  if (theme.bgImage) {
    root.style.setProperty('--bg-image', 'url(' + theme.bgImage + ')');
    root.style.setProperty('--bg-image-opacity', '0.5');
  } else {
    root.style.setProperty('--bg-image', 'none');
    root.style.setProperty('--bg-image-opacity', '0');
  }

  root.style.setProperty('--cyan', light ? '#067a96' : '#0891b2');
  root.style.setProperty('--gold', light ? '#d48c10' : '#f5a623');
  root.style.setProperty('--orange', light ? '#c94a08' : '#ea580c');
  root.style.setProperty('--mint', light ? '#16a368' : '#34d399');
  root.style.setProperty('--purple', light ? '#6535a0' : '#7b44bc');

  root.style.setProperty('--text-primary', light ? '#1a1a2e' : '#f8f8fc');
  root.style.setProperty('--text-secondary', light ? 'rgba(26,26,46,0.5)' : 'rgba(248,248,252,0.5)');
  root.style.setProperty('--text-muted', light ? 'rgba(0,0,0,0.45)' : 'rgba(255,255,255,0.55)');
  root.style.setProperty('--border-strong', light ? 'rgba(0,0,0,0.12)' : 'rgba(255,255,255,0.1)');
  root.style.setProperty('--border-subtle', light ? 'rgba(0,0,0,0.06)' : 'rgba(255,255,255,0.06)');
  root.style.setProperty('--overlay-light', light ? 'rgba(0,0,0,0.05)' : 'rgba(255,255,255,0.08)');
  root.style.setProperty('--overlay-swap', light ? 'rgba(0,0,0,0.12)' : 'rgba(255,255,255,0.2)');
  root.style.setProperty('--scrollbar-color', light ? 'rgba(0,0,0,0.15)' : 'rgba(255,255,255,0.15)');

  // cssClass theme handling: remove old, add new
  var vp = document.querySelector('.viewport');
  for (var j = 0; j < themes.length; j++) {
    if (themes[j].cssClass) vp.classList.remove(themes[j].cssClass);
  }
  if (theme.cssClass) {
    vp.classList.add(theme.cssClass);
  }
  document.body.style.fontFamily = "";

  // Wireframe light: force pure black text & icons
  if (themeId === 'wireframe-light') {
    root.style.setProperty('--text-primary', '#000000');
    root.style.setProperty('--text-secondary', '#000000');
    root.style.setProperty('--text-muted', '#000000');
  }

  buildThemeGrid();
  sendToUnity('themeChanged', themeId);

  // Liquid glass: clean up and re-init specular elements
  if (typeof liquidActiveEl !== 'undefined' && liquidActiveEl) {
    liquidActiveEl.classList.remove('liquid-hover');
    liquidActiveEl.style.transform = '';
    liquidActiveEl = null;
  }
  initLiquidSpecular();
}

// ── Liquid Glass: Specular Highlight Injection ─────────
var liquidSpecularEls = [];

function initLiquidSpecular() {
  // Clean up existing specular elements
  for (var i = 0; i < liquidSpecularEls.length; i++) {
    if (liquidSpecularEls[i].parentNode) {
      liquidSpecularEls[i].parentNode.removeChild(liquidSpecularEls[i]);
    }
  }
  liquidSpecularEls = [];

  // Only inject when liquid theme is active
  var vp = document.querySelector('.viewport');
  if (!vp || !vp.classList.contains('theme-liquid')) return;

  // Tier 1 + Tier 2 elements get specular highlights
  var selectors = [
    '.nav-item', '.play-go-btn', '.play-mode-tab',
    '.solo-popup-option', '.space-popup-opt', '.loadout-opt',
    '.play-coop-tile', '.song-tile', '.space-tile',
    '.vault-tile', '.settings-tile', '.theme-card:not(.locked)',
    '.play-solo-btn', '.play-bar-btn', '.back-btn',
    '.purchase-btn', '.lb-type-btn', '.picker-filter',
    '.setlist-btn', '.key', '.key-wide', '.season-tile',
    '.play-tile', '.play-solo-cover-add', '.play-solo-add'
  ];

  for (var s = 0; s < selectors.length; s++) {
    var els = document.querySelectorAll(selectors[s]);
    for (var e = 0; e < els.length; e++) {
      // Ensure position:relative for absolute children
      var pos = window.getComputedStyle(els[e]).position;
      if (pos === 'static') els[e].style.position = 'relative';

      // Skip if already has a specular child
      if (els[e].querySelector('.liquid-specular')) continue;

      var spec = document.createElement('div');
      spec.className = 'liquid-specular';
      var inner = document.createElement('div');
      inner.className = 'liquid-specular-inner';
      spec.appendChild(inner);
      els[e].appendChild(spec);
      liquidSpecularEls.push(spec);
    }
  }
}

// ── Liquid Glass: Pointer Tracking ─────────────────────
var liquidLastTime = 0;
var LIQUID_THROTTLE_MS = 33; // ~30fps
var liquidActiveEl = null;

var LIQUID_TIER1_SEL = '.nav-item, .play-go-btn, .play-mode-tab, .solo-popup-option, .space-popup-opt, .loadout-opt';
var LIQUID_ALL_SEL = '.nav-item, .play-go-btn, .play-mode-tab, .solo-popup-option, .space-popup-opt, .loadout-opt, .play-coop-tile, .song-tile, .space-tile, .vault-tile, .settings-tile, .theme-card, .play-solo-btn, .play-bar-btn, .back-btn, .purchase-btn, .lb-type-btn, .picker-filter, .setlist-btn, .key, .key-wide, .season-tile, .play-tile, .play-solo-cover-add, .play-solo-add';

function findLiquidTarget(el, selector) {
  var node = el;
  for (var d = 0; d < 5; d++) {
    if (!node || node === document) return null;
    if (node.matches && node.matches(selector)) return node;
    node = node.parentNode;
  }
  return null;
}

function handleLiquidPointerMove(evt) {
  var now = Date.now();
  if (now - liquidLastTime < LIQUID_THROTTLE_MS) return;
  liquidLastTime = now;

  var vp = document.querySelector('.viewport');
  if (!vp || !vp.classList.contains('theme-liquid')) return;

  var target = findLiquidTarget(evt.target, LIQUID_ALL_SEL);
  if (!target) {
    if (liquidActiveEl) {
      liquidActiveEl.classList.remove('liquid-hover');
      liquidActiveEl.style.transform = '';
      liquidActiveEl = null;
    }
    return;
  }

  // New target — clean up old one
  if (liquidActiveEl && liquidActiveEl !== target) {
    liquidActiveEl.classList.remove('liquid-hover');
    liquidActiveEl.style.transform = '';
  }
  liquidActiveEl = target;
  target.classList.add('liquid-hover');

  var rect = target.getBoundingClientRect();
  if (rect.width === 0 || rect.height === 0) return;
  var relX = evt.clientX - rect.left;
  var relY = evt.clientY - rect.top;
  var normX = relX / rect.width;
  var normY = relY / rect.height;

  // Update specular highlight position
  var specInner = target.querySelector('.liquid-specular-inner');
  if (specInner) {
    specInner.style.left = relX + 'px';
    specInner.style.top = relY + 'px';
  }

  // Elastic deformation (Tier 1 only)
  var isTier1 = findLiquidTarget(target, LIQUID_TIER1_SEL);
  if (isTier1) {
    var baseScale = 1.05;
    var dx = (normX - 0.5) * 6;
    var dy = (normY - 0.5) * 4;
    var sx = baseScale + (0.5 - Math.abs(normX - 0.5)) * 0.02;
    var sy = baseScale + (0.5 - Math.abs(normY - 0.5)) * 0.02;
    isTier1.style.transform = 'translate(' + dx.toFixed(1) + 'px, ' + dy.toFixed(1) + 'px) scaleX(' + sx.toFixed(3) + ') scaleY(' + sy.toFixed(3) + ')';
  }
}

function handleLiquidPointerLeave() {
  if (liquidActiveEl) {
    liquidActiveEl.classList.remove('liquid-hover');
    liquidActiveEl.style.transform = '';
    liquidActiveEl = null;
  }
}

function initLiquidPointerTracking() {
  var vp = document.querySelector('.viewport');
  if (!vp) return;

  // Event delegation on viewport
  vp.addEventListener('mousemove', handleLiquidPointerMove, false);
  vp.addEventListener('mouseleave', handleLiquidPointerLeave, false);

  // Touch support for VR pointer
  vp.addEventListener('touchmove', function(evt) {
    if (evt.touches && evt.touches.length > 0) {
      var touch = evt.touches[0];
      var el = document.elementFromPoint(touch.clientX, touch.clientY);
      if (el) {
        handleLiquidPointerMove({
          clientX: touch.clientX,
          clientY: touch.clientY,
          target: el
        });
      }
    }
  }, false);
  vp.addEventListener('touchend', handleLiquidPointerLeave, false);
}

function resetPurchasePreview() {
  var p = document.getElementById('purchase-preview');
  if (!p) return;
  p.style.background = '';
  p.style.backgroundImage = '';
  p.style.backgroundSize = '';
  p.style.backgroundPosition = '';
  p.style.border = '';
  p.style.borderRadius = '';
  p.style.animation = '';
  p.style.removeProperty('--frame-color-1');
  p.style.removeProperty('--frame-color-2');
}

function openPurchasePopup(themeId) {
  resetPurchasePreview();
  var theme = null;
  for (var i = 0; i < themes.length; i++) {
    if (themes[i].id === themeId) { theme = themes[i]; break; }
  }
  if (!theme) return;
  pendingPurchaseId = themeId;
  document.getElementById('purchase-preview').style.background = buildSlantedGradient(themeSwatches(theme));
  document.getElementById('purchase-title').textContent = theme.name;
  document.getElementById('purchase-cost').textContent = theme.price.toLocaleString() + ' Coins';
  var balEl = document.getElementById('purchase-balance');
  balEl.textContent = 'Your balance: ' + userCoins.toLocaleString() + ' Coins';
  var canAfford = userCoins >= theme.price;
  balEl.className = 'purchase-balance' + (canAfford ? '' : ' insufficient');
  var btn = document.getElementById('purchase-confirm-btn');
  btn.disabled = !canAfford;
  btn.textContent = canAfford ? 'Unlock' : 'Not enough coins';
  document.getElementById('purchase-overlay').className = 'purchase-overlay active';
}

function closePurchasePopup(e) {
  if (e && e.target !== document.getElementById('purchase-overlay')) return;
  document.getElementById('purchase-overlay').className = 'purchase-overlay';
  pendingPurchaseId = null;
  pendingBannerPurchaseId = null;
  pendingFramePurchaseId = null;
}

function confirmPurchase() {
  if (!pendingPurchaseId) return;
  if (pendingBannerPurchaseId) {
    confirmBannerPurchase();
    return;
  }
  if (pendingFramePurchaseId) {
    confirmFramePurchase();
    return;
  }
  var theme = null;
  for (var i = 0; i < themes.length; i++) {
    if (themes[i].id === pendingPurchaseId) { theme = themes[i]; break; }
  }
  if (!theme || userCoins < theme.price) return;
  userCoins -= theme.price;
  unlockedThemes.push(pendingPurchaseId);
  closePurchasePopup();
  applyTheme(pendingPurchaseId);
  buildThemeGrid();
  sendToUnity('themePurchased', pendingPurchaseId);
}

function openBannerPurchasePopup(bannerId) {
  resetPurchasePreview();
  var banner = null;
  for (var i = 0; i < banners.length; i++) {
    if (banners[i].id === bannerId) { banner = banners[i]; break; }
  }
  if (!banner) return;
  pendingBannerPurchaseId = bannerId;
  pendingPurchaseId = bannerId;
  var preview = document.getElementById('purchase-preview');
  preview.style.background = '';
  preview.style.backgroundImage = 'url(' + banner.file + ')';
  preview.style.backgroundSize = 'cover';
  preview.style.backgroundPosition = 'center';
  document.getElementById('purchase-title').textContent = banner.name;
  document.getElementById('purchase-cost').textContent = banner.price.toLocaleString() + ' Coins';
  var balEl = document.getElementById('purchase-balance');
  balEl.textContent = 'Your balance: ' + userCoins.toLocaleString() + ' Coins';
  var canAfford = userCoins >= banner.price;
  balEl.className = 'purchase-balance' + (canAfford ? '' : ' insufficient');
  var btn = document.getElementById('purchase-confirm-btn');
  btn.disabled = !canAfford;
  btn.textContent = canAfford ? 'Unlock' : 'Not enough coins';
  document.getElementById('purchase-overlay').className = 'purchase-overlay active';
}

function confirmBannerPurchase() {
  if (!pendingBannerPurchaseId) return;
  var banner = null;
  for (var i = 0; i < banners.length; i++) {
    if (banners[i].id === pendingBannerPurchaseId) { banner = banners[i]; break; }
  }
  if (!banner || userCoins < banner.price) return;
  userCoins -= banner.price;
  unlockedBanners.push(pendingBannerPurchaseId);
  var bannerId = pendingBannerPurchaseId;
  pendingBannerPurchaseId = null;
  pendingPurchaseId = null;
  closePurchasePopup();
  applyBanner(bannerId);
  buildBannerGrid();
  sendToUnity('bannerPurchased', bannerId);
}

function openFramePurchasePopup(frameId) {
  resetPurchasePreview();
  var frame = null;
  for (var i = 0; i < frames.length; i++) {
    if (frames[i].id === frameId) { frame = frames[i]; break; }
  }
  if (!frame) return;
  pendingFramePurchaseId = frameId;
  pendingPurchaseId = frameId;
  var preview = document.getElementById('purchase-preview');
  preview.style.background = '';
  preview.style.backgroundImage = 'none';
  preview.style.border = '8px solid ' + frame.color1;
  preview.style.borderRadius = '50%';
  preview.style.animation = 'frameGlow 3s ease-in-out infinite';
  preview.style.setProperty('--frame-color-1', frame.color1);
  preview.style.setProperty('--frame-color-2', frame.color2);
  document.getElementById('purchase-title').textContent = frame.name;
  document.getElementById('purchase-cost').textContent = frame.price.toLocaleString() + ' Coins';
  var balEl = document.getElementById('purchase-balance');
  balEl.textContent = 'Your balance: ' + userCoins.toLocaleString() + ' Coins';
  var canAfford = userCoins >= frame.price;
  balEl.className = 'purchase-balance' + (canAfford ? '' : ' insufficient');
  var btn = document.getElementById('purchase-confirm-btn');
  btn.disabled = !canAfford;
  btn.textContent = canAfford ? 'Unlock' : 'Not enough coins';
  document.getElementById('purchase-overlay').className = 'purchase-overlay active';
}

function confirmFramePurchase() {
  if (!pendingFramePurchaseId) return;
  var frame = null;
  for (var i = 0; i < frames.length; i++) {
    if (frames[i].id === pendingFramePurchaseId) { frame = frames[i]; break; }
  }
  if (!frame || userCoins < frame.price) return;
  userCoins -= frame.price;
  unlockedFrames.push(pendingFramePurchaseId);
  var frameId = pendingFramePurchaseId;
  pendingFramePurchaseId = null;
  pendingPurchaseId = null;
  closePurchasePopup();
  applyFrame(frameId);
  buildFrameGrid();
  sendToUnity('framePurchased', frameId);
}

function buildSlantedGradient(swatches) {
  var bandWidth = 100 / swatches.length;
  var stops = [];
  for (var i = 0; i < swatches.length; i++) {
    stops.push(swatches[i] + ' ' + (i * bandWidth) + '%');
    stops.push(swatches[i] + ' ' + ((i + 1) * bandWidth) + '%');
  }
  return 'linear-gradient(135deg, ' + stops.join(', ') + ')';
}

function buildThemeGrid() {
  var grid = document.getElementById('theme-grid');
  grid.innerHTML = '';
  for (var i = 0; i < themes.length; i++) {
    var t = themes[i];
    var isLocked = t.locked && !isThemeUnlocked(t.id);
    var card = document.createElement('div');
    card.className = 'theme-card' + (t.id === currentTheme ? ' selected' : '') + (isLocked ? ' locked' : '');
    card.setAttribute('data-theme', t.id);
    card.onclick = (function(id) { return function() { applyTheme(id); }; })(t.id);
    card.style.background = buildSlantedGradient(themeSwatches(t));
    var html = '<div class="tile-info"><div class="tile-title">' + t.name + '</div></div>';
    if (isLocked) {
      html += '<div class="theme-lock-banner">&#128274; Unlock for ' + t.price.toLocaleString() + ' Coins</div>';
    }
    card.innerHTML = html;
    grid.appendChild(card);
  }
  // Also set the Themes settings tile background
  var themesTile = document.getElementById('themes-tile');
  if (themesTile) {
    var active = null;
    for (var j = 0; j < themes.length; j++) {
      if (themes[j].id === currentTheme) { active = themes[j]; break; }
    }
    if (active) themesTile.style.background = buildSlantedGradient(themeSwatches(active));
  }
  // Re-inject liquid specular elements on rebuilt theme cards
  if (typeof initLiquidSpecular === 'function') initLiquidSpecular();
}

function buildBannerGrid() {
  var grid = document.getElementById('banner-grid');
  grid.innerHTML = '';
  for (var i = 0; i < banners.length; i++) {
    var b = banners[i];
    var isLocked = b.locked && !isBannerUnlocked(b.id);
    var card = document.createElement('div');
    card.className = 'banner-card' + (b.id === currentBanner ? ' selected' : '') + (isLocked ? ' locked' : '');
    card.setAttribute('data-banner', b.id);
    card.onclick = (function(id) { return function() { applyBanner(id); }; })(b.id);
    card.style.backgroundImage = 'url(' + b.file + ')';
    var html = '<div class="tile-info"><div class="tile-title">' + b.name + '</div></div>';
    if (isLocked) {
      html += '<div class="theme-lock-banner">&#128274; Unlock for ' + b.price.toLocaleString() + ' Coins</div>';
    }
    card.innerHTML = html;
    grid.appendChild(card);
  }
  // Also set the Banners settings tile background
  var bannersTile = document.getElementById('banners-tile');
  if (bannersTile && currentBanner) {
    var active = null;
    for (var j = 0; j < banners.length; j++) {
      if (banners[j].id === currentBanner) { active = banners[j]; break; }
    }
    if (active) {
      bannersTile.style.backgroundImage = 'url(' + active.file + ')';
      bannersTile.style.backgroundSize = 'cover';
      bannersTile.style.backgroundPosition = 'center';
    }
  }
  // Re-inject liquid specular elements on rebuilt banner cards
  if (typeof initLiquidSpecular === 'function') initLiquidSpecular();
}

function buildFrameGrid() {
  var grid = document.getElementById('frame-grid');
  grid.innerHTML = '';
  for (var i = 0; i < frames.length; i++) {
    var f = frames[i];
    var isLocked = f.locked && !isFrameUnlocked(f.id);
    var card = document.createElement('div');
    card.className = 'frame-card' + (f.id === currentFrame ? ' selected' : '') + (isLocked ? ' locked' : '');
    card.setAttribute('data-frame', f.id);
    card.onclick = (function(id) { return function() { applyFrame(id); }; })(f.id);
    card.style.borderColor = f.color1;
    card.style.setProperty('--frame-color-1', f.color1);
    card.style.setProperty('--frame-color-2', f.color2);
    card.style.boxShadow = '0 0 20px ' + f.color1 + ', 0 0 40px ' + f.color2;
    var html = '<div class="tile-title">' + f.name + '</div>';
    if (isLocked) {
      html += '<div class="theme-lock-banner">&#128274; ' + f.price.toLocaleString() + '</div>';
    }
    card.innerHTML = html;
    grid.appendChild(card);
  }
  // Re-inject liquid specular elements on rebuilt frame cards
  if (typeof initLiquidSpecular === 'function') initLiquidSpecular();
}

var activeLegalEl = null;

function hideSettingsSub() {
  document.getElementById('settings-main').style.display = 'flex';
  document.getElementById('theme-section').className = 'theme-section';
  document.getElementById('banner-section').className = 'banner-section';
  document.getElementById('frame-section').className = 'frame-section';
  document.getElementById('tos-section').className = 'legal-section';
  document.getElementById('pp-section').className = 'legal-section';
  activeLegalEl = null;
  var gridNavs = document.querySelectorAll('.grid-nav');
  for (var i = 0; i < gridNavs.length; i++) gridNavs[i].style.display = 'none';
}

function showThemes() {
  document.getElementById('settings-main').style.display = 'none';
  document.getElementById('theme-section').className = 'theme-section active';
}

function showBanners() {
  document.getElementById('settings-main').style.display = 'none';
  document.getElementById('banner-section').className = 'banner-section active';
  buildBannerGrid();
}

function showFrames() {
  document.getElementById('settings-main').style.display = 'none';
  document.getElementById('frame-section').className = 'frame-section active';
  buildFrameGrid();
}

function showTos() {
  document.getElementById('settings-main').style.display = 'none';
  document.getElementById('tos-section').className = 'legal-section active';
  activeLegalEl = document.getElementById('tos-content');
  activeLegalEl.scrollTop = 0;
  buildScrollNav();
}

function showPrivacy() {
  document.getElementById('settings-main').style.display = 'none';
  document.getElementById('pp-section').className = 'legal-section active';
  activeLegalEl = document.getElementById('pp-content');
  activeLegalEl.scrollTop = 0;
  buildScrollNav();
}

/* ── Profile Switcher ─────────────────────────────── */
var profiles = [
  { id: 'rael', name: 'Rael', avatar: 'rael_new.png', level: 24, xp: 6500, xpMax: 10000, coins: 5000 },
  { id: 'jooleeno', name: 'Jooleeno', avatar: 'jooleeno.jpg', level: 12, xp: 2100, xpMax: 5000, coins: 3200 },
  { id: 'ted', name: 'Ted', avatar: 'ted.png', level: 37, xp: 8200, xpMax: 12000, coins: 7800 },
  { id: 'abbie', name: 'Abbie', avatar: 'abbie.png', level: 19, xp: 3400, xpMax: 7000, coins: 4500 },
  { id: 'arthen', name: 'Arthen', avatar: 'arthen.jpg', level: 42, xp: 9800, xpMax: 15000, coins: 12400 }
];
var activeProfileId = 'rael';

function showProfilesPanel() {
  document.getElementById('career-main').style.display = 'none';
  document.getElementById('profile-section-career').className = 'profile-section active';
  buildProfileGrid();
}

function hideProfilePanel() {
  document.getElementById('career-main').style.display = 'flex';
  document.getElementById('profile-section-career').className = 'profile-section';
}

function buildProfileGrid() {
  var grid = document.getElementById('profile-grid-career');
  grid.innerHTML = '';
  for (var i = 0; i < profiles.length; i++) {
    var p = profiles[i];
    var card = document.createElement('div');
    card.className = 'profile-card' + (p.id === activeProfileId ? ' active' : '');
    card.setAttribute('data-profile', p.id);
    card.onclick = (function(pid) { return function() { switchProfile(pid); }; })(p.id);
    var img = document.createElement('img');
    img.className = 'profile-card-avatar';
    img.src = p.avatar;
    img.alt = p.name;
    var info = document.createElement('div');
    info.className = 'profile-card-info';
    var name = document.createElement('div');
    name.className = 'profile-card-name';
    name.textContent = p.name;
    var level = document.createElement('div');
    level.className = 'profile-card-level';
    level.textContent = 'Level ' + p.level;
    info.appendChild(name);
    info.appendChild(level);
    card.appendChild(img);
    card.appendChild(info);
    grid.appendChild(card);
  }
  // Add profile tile
  var addCard = document.createElement('div');
  addCard.className = 'profile-card-add';
  addCard.innerHTML = '<div class="profile-card-add-silhouette"><svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="36" r="18" fill="#fff"/><ellipse cx="50" cy="82" rx="30" ry="22" fill="#fff"/></svg></div>' +
    '<div class="profile-card-add-info">' +
    '<div class="profile-card-add-label">New Profile</div>' +
    '<div class="profile-card-add-cost">100 Coins</div>' +
    '</div>';
  grid.appendChild(addCard);
}

function switchProfile(profileId) {
  var profile = null;
  for (var i = 0; i < profiles.length; i++) {
    if (profiles[i].id === profileId) { profile = profiles[i]; break; }
  }
  if (!profile) return;
  activeProfileId = profileId;
  userCoins = profile.coins;

  // Update topbar
  document.querySelector('.profile-name').textContent = profile.name;
  var avatarImg = document.querySelector('.profile-avatar img');
  avatarImg.src = profile.avatar;
  avatarImg.alt = profile.name;
  var fill = Math.round((profile.xp / profile.xpMax) * 100);
  document.querySelector('.xp-bar-fill').style.width = fill + '%';

  // Rebuild ticker with new profile data
  var ticker = document.getElementById('stat-ticker');
  ticker.innerHTML = '';
  var stats = [
    'Level ' + profile.level,
    profile.xp.toLocaleString() + ' / ' + profile.xpMax.toLocaleString() + ' XP',
    profile.coins.toLocaleString() + ' Jamsesh Coins',
    getSeasonPercent() + '% Season Complete'
  ];
  for (var s = 0; s < stats.length; s++) {
    var el = document.createElement('div');
    el.className = 'xp-text' + (s === 0 ? ' ticker-active' : '');
    el.textContent = stats[s];
    ticker.appendChild(el);
  }

  // Update active card
  buildProfileGrid();
}

function buildScrollNav() {
  var nav = document.getElementById('grid-nav-right');
  nav.innerHTML = '';
  var up = document.createElement('button');
  up.className = 'grid-nav-btn';
  up.id = 'scroll-up';
  up.innerHTML = '&#9650;';
  up.onclick = function() { scrollLegal(-1); };
  nav.appendChild(up);

  var down = document.createElement('button');
  down.className = 'grid-nav-btn';
  down.id = 'scroll-down';
  down.innerHTML = '&#9660;';
  down.onclick = function() { scrollLegal(1); };
  nav.appendChild(down);

  nav.style.display = 'flex';
  updateScrollNavState();
  if (activeLegalEl) {
    activeLegalEl.onscroll = updateScrollNavState;
  }
}

function scrollLegal(dir) {
  if (!activeLegalEl) return;
  var amount = activeLegalEl.clientHeight * 0.8;
  activeLegalEl.scrollBy({top: dir * amount, behavior: 'smooth'});
}

function updateScrollNavState() {
  if (!activeLegalEl) return;
  var up = document.getElementById('scroll-up');
  var down = document.getElementById('scroll-down');
  if (up) up.disabled = (activeLegalEl.scrollTop <= 0);
  if (down) down.disabled = (activeLegalEl.scrollTop + activeLegalEl.clientHeight >= activeLegalEl.scrollHeight - 5);
}

// ── Init ───────────────────────────────────────────────
// ── Season Grid ──────────────────────────────────────────
var seasonData = [
  {label: 'Solo', rewards: [
    {icon: '\uD83C\uDFB8', name: 'Flame Guitar',   xp: 500,  xpEarned: 500,  reward: 'cosmetic', unlocked: true},
    {icon: '\uD83E\uDE99', name: '200 Coins',       xp: 1200, xpEarned: 1200, reward: 'coins',    unlocked: true},
    {icon: '\uD83C\uDFB5', name: 'Neon Strings',    xp: 2000, xpEarned: 1650, reward: 'cosmetic', unlocked: false},
    {icon: '\uD83D\uDC8E', name: 'Crystal Pick',    xp: 3500, xpEarned: 0,    reward: 'cosmetic', unlocked: false},
    {icon: '\uD83E\uDE99', name: '500 Coins',       xp: 5000, xpEarned: 0,    reward: 'coins',    unlocked: false}
  ]},
  {label: 'Band', rewards: [
    {icon: '\uD83E\uDE99', name: '150 Coins',       xp: 800,  xpEarned: 800,  reward: 'coins',    unlocked: true},
    {icon: '\uD83C\uDFB6', name: 'Gold Stage',      xp: 1500, xpEarned: 1500, reward: 'cosmetic', unlocked: true},
    {icon: '\uD83C\uDFC6', name: 'Band Trophy',     xp: 2500, xpEarned: 2500, reward: 'cosmetic', unlocked: true},
    {icon: '\uD83E\uDE99', name: '400 Coins',       xp: 4000, xpEarned: 2800, reward: 'coins',    unlocked: false},
    {icon: '\uD83C\uDF1F', name: 'Star Highway',    xp: 6000, xpEarned: 0,    reward: 'cosmetic', unlocked: false}
  ]},
  {label: 'Guitar', rewards: [
    {icon: '\uD83D\uDD25', name: 'Fire Fretboard',  xp: 600,  xpEarned: 600,  reward: 'cosmetic', unlocked: true},
    {icon: '\uD83E\uDE99', name: '250 Coins',       xp: 1400, xpEarned: 1400, reward: 'coins',    unlocked: true},
    {icon: '\u26A1',       name: 'Lightning Riff',  xp: 2200, xpEarned: 1900, reward: 'cosmetic', unlocked: false},
    {icon: '\uD83C\uDFB8', name: 'Holo Guitar',     xp: 3800, xpEarned: 0,    reward: 'cosmetic', unlocked: false},
    {icon: '\uD83E\uDE99', name: '600 Coins',       xp: 5500, xpEarned: 0,    reward: 'coins',    unlocked: false}
  ]},
  {label: 'Drums', rewards: [
    {icon: '\uD83E\uDD41', name: 'Chrome Sticks',   xp: 700,  xpEarned: 700,  reward: 'cosmetic', unlocked: true},
    {icon: '\uD83E\uDE99', name: '200 Coins',       xp: 1300, xpEarned: 1300, reward: 'coins',    unlocked: true},
    {icon: '\uD83E\uDE99', name: '350 Coins',       xp: 2400, xpEarned: 0,    reward: 'coins',    unlocked: false},
    {icon: '\uD83D\uDCA5', name: 'Shockwave Kit',   xp: 3600, xpEarned: 0,    reward: 'cosmetic', unlocked: false},
    {icon: '\uD83C\uDF1F', name: 'Platinum Drums',  xp: 5200, xpEarned: 0,    reward: 'cosmetic', unlocked: false}
  ]},
  {label: 'Keys', rewards: [
    {icon: '\uD83C\uDFB9', name: 'Synth Wave',      xp: 500,  xpEarned: 500,  reward: 'cosmetic', unlocked: true},
    {icon: '\uD83E\uDE99', name: '300 Coins',       xp: 1100, xpEarned: 900,  reward: 'coins',    unlocked: false},
    {icon: '\uD83C\uDF0C', name: 'Galaxy Keys',     xp: 2100, xpEarned: 0,    reward: 'cosmetic', unlocked: false},
    {icon: '\uD83E\uDE99', name: '450 Coins',       xp: 3400, xpEarned: 0,    reward: 'coins',    unlocked: false},
    {icon: '\uD83C\uDFB9', name: 'Crystal Piano',   xp: 5000, xpEarned: 0,    reward: 'cosmetic', unlocked: false}
  ]},
  {label: 'Vocals', rewards: [
    {icon: '\uD83C\uDFA4', name: 'Retro Mic',       xp: 600,  xpEarned: 600,  reward: 'cosmetic', unlocked: true},
    {icon: '\uD83E\uDE99', name: '200 Coins',       xp: 1200, xpEarned: 1200, reward: 'coins',    unlocked: true},
    {icon: '\uD83C\uDFA4', name: 'Neon Mic',        xp: 2300, xpEarned: 1800, reward: 'cosmetic', unlocked: false},
    {icon: '\uD83D\uDC8E', name: 'Diamond Mic',     xp: 3700, xpEarned: 0,    reward: 'cosmetic', unlocked: false},
    {icon: '\uD83E\uDE99', name: '700 Coins',       xp: 5500, xpEarned: 0,    reward: 'coins',    unlocked: false}
  ]}
];

function buildSeasonGrid() {
  var container = document.getElementById('season-grid');
  container.innerHTML = '';
  for (var c = 0; c < seasonData.length; c++) {
    var cat = seasonData[c];
    var section = document.createElement('div');
    section.className = 'season-category';

    var label = document.createElement('div');
    label.className = 'season-label';
    label.textContent = cat.label;
    section.appendChild(label);

    var row = document.createElement('div');
    row.className = 'season-row';
    for (var i = 0; i < cat.rewards.length; i++) {
      var r = cat.rewards[i];
      var tile = document.createElement('div');
      tile.className = 'season-tile' + (r.unlocked ? ' unlocked' : ' locked');

      var progress = r.xpEarned > 0 && !r.unlocked ? Math.min(r.xpEarned / r.xp * 100, 100) : (r.unlocked ? 100 : 0);

      tile.innerHTML =
        '<div class="season-reward">' + r.icon + '</div>' +
        '<div class="season-reward-name">' + r.name + '</div>' +
        '<div class="season-xp">' + r.xp.toLocaleString() + ' XP</div>' +
        '<div class="season-xp-bar"><div class="season-xp-fill" style="width:' + progress + '%"></div></div>';
      row.appendChild(tile);
    }
    section.appendChild(row);
    container.appendChild(section);
  }
}

// ── Home Grid Layout System ──────────────────────────────────────
function generateAllTilings() {
  var results = [];
  var grid = [
    [0, 0, 0],
    [0, 0, 0],
    [0, 0, 0]
  ];

  function findEmpty() {
    for (var r = 0; r < 3; r++) {
      for (var c = 0; c < 3; c++) {
        if (grid[r][c] === 0) return { r: r, c: c };
      }
    }
    return null;
  }

  function canPlace(r, c, w, h) {
    if (r + h > 3 || c + w > 3) return false;
    for (var dr = 0; dr < h; dr++) {
      for (var dc = 0; dc < w; dc++) {
        if (grid[r + dr][c + dc] !== 0) return false;
      }
    }
    return true;
  }

  function place(r, c, w, h, val) {
    for (var dr = 0; dr < h; dr++) {
      for (var dc = 0; dc < w; dc++) {
        grid[r + dr][c + dc] = val;
      }
    }
  }

  function solve(tiles) {
    var cell = findEmpty();
    if (!cell) {
      results.push(tiles.slice());
      return;
    }
    var r = cell.r, c = cell.c;
    for (var w = 1; w <= 3 - c; w++) {
      for (var h = 1; h <= 3 - r; h++) {
        if (canPlace(r, c, w, h)) {
          place(r, c, w, h, 1);
          tiles.push({ r: r, c: c, w: w, h: h });
          solve(tiles);
          tiles.pop();
          place(r, c, w, h, 0);
        }
      }
    }
  }

  solve([]);
  return results;
}

function buildHomeGrid(layoutIndex) {
  var container = document.getElementById('home-grid');
  container.innerHTML = '';
  var tiling = allTilings[layoutIndex];
  for (var i = 0; i < tiling.length; i++) {
    var t = tiling[i];
    var tile = document.createElement('div');
    tile.className = 'home-tile';
    tile.style.gridColumn = (t.c + 1) + ' / span ' + t.w;
    tile.style.gridRow = (t.r + 1) + ' / span ' + t.h;
    container.appendChild(tile);
  }
}

function buildLayoutBrowser() {
  var browser = document.getElementById('layout-browser');
  browser.innerHTML = '';
  document.getElementById('layout-count').textContent = allTilings.length + ' layouts';
  for (var i = 0; i < allTilings.length; i++) {
    var wrap = document.createElement('div');
    wrap.className = 'layout-thumb-wrap';
    var thumb = document.createElement('div');
    thumb.className = 'layout-thumb' + (i === currentLayout ? ' selected' : '');
    thumb.setAttribute('data-layout-index', i);
    thumb.onclick = (function(idx) {
      return function() { selectLayout(idx); };
    })(i);

    var tiling = allTilings[i];
    for (var j = 0; j < tiling.length; j++) {
      var t = tiling[j];
      var cell = document.createElement('div');
      cell.className = 'layout-thumb-tile';
      cell.style.gridColumn = (t.c + 1) + ' / span ' + t.w;
      cell.style.gridRow = (t.r + 1) + ' / span ' + t.h;
      thumb.appendChild(cell);
    }

    wrap.appendChild(thumb);
    browser.appendChild(wrap);
  }
}

function selectLayout(index) {
  currentLayout = index;
  buildHomeGrid(index);
  var thumbs = document.querySelectorAll('.layout-thumb');
  for (var i = 0; i < thumbs.length; i++) {
    var idx = parseInt(thumbs[i].getAttribute('data-layout-index'), 10);
    if (idx === index) {
      thumbs[i].className = 'layout-thumb selected';
    } else {
      thumbs[i].className = 'layout-thumb';
    }
  }
}

function openLayoutPicker() {
  buildLayoutBrowser();
  document.getElementById('layout-overlay').className = 'layout-overlay active';
}

function closeLayoutPicker(e) {
  if (e && e.target !== document.getElementById('layout-overlay')) return;
  document.getElementById('layout-overlay').className = 'layout-overlay';
}

function init() {
  // Hide grid nav on start (home is blank, picker shows it when needed)
  var gridNavs = document.querySelectorAll('.grid-nav');
  for (var i = 0; i < gridNavs.length; i++) gridNavs[i].style.display = 'none';

  var xhr = new XMLHttpRequest();
  xhr.open('GET', 'songs.json', true);
  xhr.onload = function() {
    if (xhr.status === 200) {
      var songs = JSON.parse(xhr.responseText);
      buildGrid(songs);
      buildPlayPanel(songs);
    }
  };
  xhr.send();
  buildSpacesGrid();
  buildVaultGrid();
  buildSeasonGrid();
  allTilings = generateAllTilings();
  buildHomeGrid(currentLayout);
  applyTheme(currentTheme);

  // Initialize random unlocked banner (skip for wireframe themes)
  if (currentTheme.indexOf('wireframe') === -1) {
    var availableBanners = [];
    for (var b = 0; b < banners.length; b++) {
      if (!banners[b].locked || isBannerUnlocked(banners[b].id)) {
        availableBanners.push(banners[b].id);
      }
    }
    if (availableBanners.length > 0) {
      var randomIdx = Math.floor(Math.random() * availableBanners.length);
      applyBanner(availableBanners[randomIdx]);
    }
  }

  // Initialize default frame
  applyFrame(currentFrame);

  initVuplexListener();
  initStatTicker();
  initLiquidPointerTracking();
}

/* ── Stat Ticker ──────────────────────────────────── */
function getSeasonPercent() {
  var total = 0;
  var unlocked = 0;
  for (var c = 0; c < seasonData.length; c++) {
    var rewards = seasonData[c].rewards;
    for (var r = 0; r < rewards.length; r++) {
      total++;
      if (rewards[r].unlocked) unlocked++;
    }
  }
  return total > 0 ? Math.round((unlocked / total) * 100) : 0;
}

function getActiveProfile() {
  for (var i = 0; i < profiles.length; i++) {
    if (profiles[i].id === activeProfileId) return profiles[i];
  }
  return profiles[0];
}

function initStatTicker() {
  var ticker = document.getElementById('stat-ticker');
  var p = getActiveProfile();
  var stats = [
    'Level ' + p.level,
    p.xp.toLocaleString() + ' / ' + p.xpMax.toLocaleString() + ' XP',
    p.coins.toLocaleString() + ' Jamsesh Coins',
    getSeasonPercent() + '% Season Complete'
  ];
  var idx = 0;

  for (var i = 0; i < stats.length; i++) {
    var el = document.createElement('div');
    el.className = 'xp-text' + (i === 0 ? ' ticker-active' : '');
    el.textContent = stats[i];
    ticker.appendChild(el);
  }

  var coinBody = document.querySelector('.coin-body');
  setInterval(function() {
    var lines = ticker.querySelectorAll('.xp-text');
    if (lines.length === 0) return;
    var curr = idx;
    var next = (idx + 1) % lines.length;

    lines[curr].className = 'xp-text ticker-exit';
    lines[next].className = 'xp-text ticker-active';

    // Spin coin once per ticker rotation
    if (coinBody) {
      coinBody.className = 'coin-body';
      void coinBody.offsetWidth; // force reflow to restart animation
      coinBody.className = 'coin-body spinning';
    }

    idx = next;
  }, 5000);
}

init();
</script>

</body>
</html>
